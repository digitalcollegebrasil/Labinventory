{
  "App.tsx": "import React, { useState, useMemo } from 'react';\r\nimport {\r\n  LayoutDashboard,\r\n  Monitor,\r\n  Settings,\r\n  QrCode,\r\n  AlertTriangle,\r\n  CheckCircle,\r\n  Search,\r\n  Filter,\r\n  BarChart3,\r\n  FileText,\r\n  BrainCircuit,\r\n  Wrench,\r\n  LogOut,\r\n  Plus,\r\n  Download,\r\n  RefreshCw,\r\n  ChevronDown,\r\n  ChevronLeft,\r\n  ChevronRight,\r\n  Moon,\r\n  Sun,\r\n  Users,\r\n  Trash2,\r\n  Clock,\r\n  AlertCircle,\r\n  X,\r\n  Star,\r\n  Camera,\r\n  User as UserIcon,\r\n  Circle\r\n} from 'lucide-react';\r\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell, PieChart, Pie } from 'recharts';\r\nimport { Device, DeviceStatus, CheckRecord, Lab } from './types';\r\nimport { api } from './services/api';\r\nimport { StatCard } from './components/StatCard';\r\nimport { Dashboard } from './components/Dashboard';\r\nimport { AIModal } from './components/AIModal';\r\nimport { analyzeMaintenanceIssue } from './services/geminiService';\r\nimport { AuthProvider, useAuth } from './contexts/AuthContext';\r\nimport { ThemeProvider, useTheme } from './contexts/ThemeContext';\r\nimport { LoginPage } from './components/LoginPage';\r\nimport { MobileNav } from './components/MobileNav';\r\nimport { SettingsLayout } from './components/SettingsLayout';\r\nimport { ErrorBoundary } from './components/ErrorBoundary';\r\nimport { DataManagement } from './components/DataManagement';\r\nimport { DeviceDetailsModal } from './components/DeviceDetailsModal';\r\nimport { UserStatusSidebar } from './components/UserStatusSidebar';\r\nimport { TaskManagement } from './components/TaskManagement';\r\nimport { ChatWindow } from './components/ChatWindow';\r\nimport { ScannerModal } from './components/ScannerModal';\r\n\r\nconst COLORS = ['#10B981', '#F59E0B', '#EF4444', '#6B7280']; // Operational, Maint, Broken, Missing\r\n\r\nfunction AppContent() {\r\n  const { user, logout, updateUser, isLoading: isAuthLoading } = useAuth();\r\n  const { theme, toggleTheme } = useTheme();\r\n\r\n  // HOOKS MUST BE AT THE TOP LEVEL - BEFORE ANY RETURNS\r\n  const [activeTab, setActiveTab] = useState<'dashboard' | 'inventory' | 'settings' | 'tasks'>('dashboard');\r\n\r\n  // Actually, let's fix the type.\r\n  const [chatUser, setChatUser] = useState<any>(null); // Using any to avoid import issues for now, or I should import User.\r\n\r\n  const [devices, setDevices] = useState<Device[]>([]);\r\n  const [labs, setLabs] = useState<Lab[]>([]);\r\n\r\n  const fetchData = async () => {\r\n    try {\r\n      const [devicesData, labsData] = await Promise.all([\r\n        api.getDevices(),\r\n        api.getLabs()\r\n      ]);\r\n      setDevices(devicesData);\r\n      setLabs(labsData);\r\n    } catch (error) {\r\n      console.error(\"Failed to fetch data\", error);\r\n    }\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    if (activeTab === 'inventory' || activeTab === 'dashboard') {\r\n      fetchData();\r\n    }\r\n  }, [activeTab]);\r\n\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [labFilter, setLabFilter] = useState<string>('All');\r\n  const [statusFilter, setStatusFilter] = useState<string>('All');\r\n\r\n  // AI Modal State\r\n  const [aiModalOpen, setAiModalOpen] = useState(false);\r\n  const [aiAnalysisContent, setAiAnalysisContent] = useState('');\r\n  const [isAiLoading, setIsAiLoading] = useState(false);\r\n  const [selectedDeviceName, setSelectedDeviceName] = useState('');\r\n\r\n  // QR Code Simulator State (Scan)\r\n  const [scanInput, setScanInput] = useState('');\r\n  const [showScanner, setShowScanner] = useState(false);\r\n\r\n  // New Features State\r\n  const [showAddModal, setShowAddModal] = useState(false);\r\n  const [showChecklistModal, setShowChecklistModal] = useState(false);\r\n  const [showQRModal, setShowQRModal] = useState(false);\r\n  const [showDetailsModal, setShowDetailsModal] = useState(false);\r\n  const [selectedDevice, setSelectedDevice] = useState<Device | null>(null);\r\n\r\n  const [newDevice, setNewDevice] = useState({\r\n    id: '',\r\n    lab: '',\r\n    brand: '',\r\n    model: '',\r\n    processor: '',\r\n    ram: '',\r\n    storage: '',\r\n    status: DeviceStatus.OPERATIONAL\r\n  });\r\n\r\n  const [checklistData, setChecklistData] = useState({\r\n    teclado: true,\r\n    mouse: true,\r\n    monitor: true,\r\n    cabos: true,\r\n    software: true,\r\n    observacoes: ''\r\n  });\r\n\r\n  // User Profile State\r\n  const [showUserMenu, setShowUserMenu] = useState(false);\r\n  const [showAccountModal, setShowAccountModal] = useState(false);\r\n  const [accountData, setAccountData] = useState({\r\n    name: user?.name || '',\r\n    avatar: user?.avatar || '',\r\n    currentPassword: '',\r\n    newPassword: ''\r\n  });\r\n\r\n  // Derived Stats\r\n  const stats = useMemo(() => {\r\n    return {\r\n      total: devices.length,\r\n      operational: devices.filter(d => d.status === DeviceStatus.OPERATIONAL).length,\r\n      maintenance: devices.filter(d => d.status === DeviceStatus.MAINTENANCE).length,\r\n      broken: devices.filter(d => d.status === DeviceStatus.BROKEN).length,\r\n      missing: devices.filter(d => d.status === DeviceStatus.MISSING).length,\r\n    };\r\n  }, [devices]);\r\n\r\n  // Handlers\r\n  const formatDate = (dateString: string) => {\r\n    if (!dateString) return '-';\r\n    const [year, month, day] = dateString.split('-');\r\n    return `${day}/${month}/${year}`;\r\n  };\r\n\r\n  const handleAIAnalysis = async (device: Device) => {\r\n    if (device.logs.length === 0) {\r\n      alert(\"Este equipamento não possui logs de erro para analisar.\");\r\n      return;\r\n    }\r\n\r\n    setSelectedDeviceName(`${device.name} (${device.id})`);\r\n    setAiAnalysisContent('');\r\n    setAiModalOpen(true);\r\n    setIsAiLoading(true);\r\n\r\n    const latestIssue = device.logs[0].description;\r\n    const result = await analyzeMaintenanceIssue(latestIssue, device.name);\r\n\r\n    setAiAnalysisContent(result);\r\n    setIsAiLoading(false);\r\n  };\r\n\r\n  const simulateScan = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!scanInput) return;\r\n\r\n    setSearchTerm(scanInput);\r\n    setActiveTab('inventory');\r\n    setShowScanner(false);\r\n    setScanInput('');\r\n  };\r\n\r\n  const handleAddDevice = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n\r\n    if (!newDevice.id || !newDevice.lab || !newDevice.brand || !newDevice.model) {\r\n      alert(\"Preencha os campos obrigatórios.\");\r\n      return;\r\n    }\r\n\r\n    // Encontrar labId baseado no nome escolhido\r\n    const selectedLab = labs.find(l => l.name === newDevice.lab);\r\n    if (!selectedLab) {\r\n      alert(\"Laboratório inválido.\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await api.addComputador({\r\n        id: newDevice.id,\r\n        brand: newDevice.brand,\r\n        model: newDevice.model,\r\n        processor: newDevice.processor,\r\n        ram: newDevice.ram,\r\n        storage: newDevice.storage,\r\n        status: newDevice.status,\r\n        labId: selectedLab.id\r\n      });\r\n\r\n      fetchData();\r\n      setShowAddModal(false);\r\n\r\n      setNewDevice({\r\n        id: \"\",\r\n        lab: \"\",\r\n        brand: \"\",\r\n        model: \"\",\r\n        processor: \"\",\r\n        ram: \"\",\r\n        storage: \"\",\r\n        status: DeviceStatus.OPERATIONAL\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error(error);\r\n      alert(\"Erro ao adicionar computador.\");\r\n    }\r\n  };\r\n\r\n  const handleDeleteDevice = async (id: string) => {\r\n    if (confirm(`Tem certeza que deseja excluir o equipamento ${id}?`)) {\r\n      await api.deleteDevice(id);\r\n      fetchData();\r\n    }\r\n  };\r\n\r\n  const handleChecklistSubmit = async () => {\r\n    if (!selectedDevice) return;\r\n\r\n    const checkRecord: CheckRecord = {\r\n      date: new Date().toISOString().split('T')[0],\r\n      time: new Date().toLocaleTimeString('pt-BR'),\r\n      userId: user?.id?.toString(),\r\n      userName: user?.name,\r\n      ...checklistData\r\n    };\r\n\r\n    const allOk = checklistData.teclado && checklistData.mouse &&\r\n      checklistData.monitor && checklistData.cabos && checklistData.software;\r\n\r\n    const newStatus = allOk ? DeviceStatus.OPERATIONAL : DeviceStatus.MAINTENANCE;\r\n\r\n    await api.updateDevice(selectedDevice.id, {\r\n      status: newStatus,\r\n      lastCheck: checkRecord.date,\r\n      checkHistory: [...(selectedDevice.checkHistory || []), checkRecord]\r\n    });\r\n    fetchData();\r\n\r\n    setShowChecklistModal(false);\r\n    setChecklistData({\r\n      teclado: true,\r\n      mouse: true,\r\n      monitor: true,\r\n      cabos: true,\r\n      software: true,\r\n      observacoes: ''\r\n    });\r\n  };\r\n\r\n  const generateQRCode = (device: Device) => {\r\n    setSelectedDevice(device);\r\n    setShowQRModal(true);\r\n  };\r\n\r\n\r\n\r\n  const getStatusColor = (status: DeviceStatus) => {\r\n    switch (status) {\r\n      case DeviceStatus.OPERATIONAL: return 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200';\r\n      case DeviceStatus.MAINTENANCE: return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200';\r\n      case DeviceStatus.BROKEN: return 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200';\r\n      case DeviceStatus.MISSING: return 'bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-300';\r\n      default: return 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300';\r\n    }\r\n  };\r\n\r\n  const handleUpdateUserStatus = async (status: 'online' | 'busy' | 'offline') => {\r\n    if (!user?.id) return;\r\n    await api.updateUser(Number(user.id), { status });\r\n    window.location.reload();\r\n  };\r\n\r\n  const handleUpdateAccount = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    console.log(\"handleUpdateAccount called\", user);\r\n    if (!user?.id) {\r\n      alert(\"Erro: ID do usuário não encontrado. Tente fazer login novamente.\");\r\n      return;\r\n    }\r\n\r\n    const updates: any = {\r\n      name: accountData.name,\r\n      avatar: accountData.avatar\r\n    };\r\n\r\n    if (accountData.newPassword) {\r\n      updates.password = accountData.newPassword;\r\n    }\r\n\r\n    try {\r\n      await api.updateUser(Number(user.id), updates);\r\n      updateUser(updates);\r\n      alert('Perfil atualizado com sucesso!');\r\n      setShowAccountModal(false);\r\n    } catch (error: any) {\r\n      console.error(\"Failed to update account\", error);\r\n      alert(`Erro ao atualizar perfil: ${error.message || 'Erro desconhecido'}`);\r\n    }\r\n  };\r\n\r\n  // CONDITIONAL RENDERING AFTER HOOKS\r\n  if (isAuthLoading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!user) {\r\n    return <LoginPage />;\r\n  }\r\n\r\n  // Filtering\r\n  const filteredDevices = devices.filter(device => {\r\n    const matchesSearch = device.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n      device.id.toLowerCase().includes(searchTerm.toLowerCase());\r\n    const matchesLab = labFilter === 'All' || device.lab === labFilter;\r\n    const matchesStatus = statusFilter === 'All' || device.status === statusFilter;\r\n    return matchesSearch && matchesLab && matchesStatus;\r\n  });\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex bg-[#F3F4F6] dark:bg-gray-900 text-gray-900 dark:text-gray-100 pb-16 md:pb-0 font-sans transition-colors duration-200\">\r\n\r\n      {/* Sidebar */}\r\n      <aside className=\"w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 fixed h-full z-10 hidden md:flex flex-col transition-colors duration-200\">\r\n        <div className=\"p-6 border-b border-gray-100 dark:border-gray-700\">\r\n          <div className=\"flex items-center space-x-2 text-indigo-600 dark:text-indigo-400\">\r\n            <img src=\"/logo.png\" alt=\"Logo\" className=\"w-8 h-8 rounded-lg\" />\r\n            <span className=\"text-xl font-bold tracking-tight\">LabManager</span>\r\n          </div>\r\n        </div>\r\n\r\n        <nav className=\"flex-1 p-4 space-y-1 overflow-y-auto\">\r\n          <button\r\n            onClick={() => setActiveTab('dashboard')}\r\n            className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium transition ${activeTab === 'dashboard' ? 'bg-indigo-50 text-indigo-700 dark:bg-indigo-900/50 dark:text-indigo-300' : 'text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700'}`}\r\n          >\r\n            <LayoutDashboard className=\"w-5 h-5\" />\r\n            <span>Dashboard</span>\r\n          </button>\r\n\r\n          <button\r\n            onClick={() => setActiveTab('inventory')}\r\n            className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium transition ${activeTab === 'inventory' ? 'bg-indigo-50 text-indigo-700 dark:bg-indigo-900/50 dark:text-indigo-300' : 'text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700'}`}\r\n          >\r\n            <Monitor className=\"w-5 h-5\" />\r\n            <span>Inventário</span>\r\n          </button>\r\n\r\n          <button\r\n            onClick={() => setActiveTab('tasks')}\r\n            className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium transition ${activeTab === 'tasks' ? 'bg-indigo-50 text-indigo-700 dark:bg-indigo-900/50 dark:text-indigo-300' : 'text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700'}`}\r\n          >\r\n            <span>Tarefas</span>\r\n          </button>\r\n\r\n          <button\r\n            onClick={() => setActiveTab('settings')}\r\n            className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium transition ${activeTab === 'settings' ? 'bg-indigo-50 text-indigo-700 dark:bg-indigo-900/50 dark:text-indigo-300' : 'text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700'}`}\r\n          >\r\n            <Settings className=\"w-5 h-5\" />\r\n            <span>Configurações</span>\r\n          </button>\r\n        </nav>\r\n\r\n        <UserStatusSidebar onUserClick={setChatUser} />\r\n\r\n        <div className=\"p-4 border-t border-gray-100 dark:border-gray-700 relative\">\r\n          <button\r\n            onClick={() => setShowUserMenu(!showUserMenu)}\r\n            className=\"w-full flex items-center justify-between px-4 py-2 text-sm text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition\"\r\n          >\r\n            <div className=\"flex items-center space-x-3\">\r\n              <div className=\"relative\">\r\n                <div className=\"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center overflow-hidden\">\r\n                  {user.avatar ? (\r\n                    <img src={user.avatar} alt={user.name} className=\"w-full h-full object-cover\" />\r\n                  ) : (\r\n                    <span className=\"font-bold text-gray-600 dark:text-gray-300\">{user.name.charAt(0)}</span>\r\n                  )}\r\n                </div>\r\n                <div className={`absolute bottom-0 right-0 w-2.5 h-2.5 rounded-full border-2 border-white dark:border-gray-800 ${user.status === 'busy' ? 'bg-red-500' :\r\n                  user.status === 'offline' ? 'bg-gray-500' :\r\n                    'bg-green-500'\r\n                  }`}></div>\r\n              </div>\r\n              <div className=\"text-left\">\r\n                <p className=\"font-medium text-gray-700 dark:text-gray-200 truncate w-24\">{user.name}</p>\r\n                <p className=\"text-xs text-gray-400 capitalize\">{user.status || 'online'}</p>\r\n              </div>\r\n            </div>\r\n            <ChevronDown className=\"w-4 h-4\" />\r\n          </button>\r\n\r\n          {showUserMenu && (\r\n            <div className=\"absolute bottom-full left-4 right-4 mb-2 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 py-1 z-50 animate-in slide-in-from-bottom-2\">\r\n              <div className=\"px-4 py-2 border-b border-gray-100 dark:border-gray-700\">\r\n                <p className=\"text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2\">Status</p>\r\n                <div className=\"space-y-1\">\r\n                  <button onClick={() => handleUpdateUserStatus('online')} className=\"w-full flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400\">\r\n                    <div className=\"w-2 h-2 rounded-full bg-green-500\"></div>\r\n                    <span>Online</span>\r\n                  </button>\r\n                  <button onClick={() => handleUpdateUserStatus('busy')} className=\"w-full flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400\">\r\n                    <div className=\"w-2 h-2 rounded-full bg-red-500\"></div>\r\n                    <span>Ausente</span>\r\n                  </button>\r\n                  <button onClick={() => handleUpdateUserStatus('offline')} className=\"w-full flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400\">\r\n                    <div className=\"w-2 h-2 rounded-full bg-gray-500\"></div>\r\n                    <span>Offline</span>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n              <button\r\n                onClick={() => {\r\n                  setAccountData({\r\n                    name: user.name,\r\n                    avatar: user.avatar || '',\r\n                    currentPassword: '',\r\n                    newPassword: ''\r\n                  });\r\n                  setShowAccountModal(true);\r\n                  setShowUserMenu(false);\r\n                }}\r\n                className=\"w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-2\"\r\n              >\r\n                <Settings className=\"w-4 h-4\" />\r\n                Configurações de Conta\r\n              </button>\r\n              <button onClick={logout} className=\"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center gap-2\">\r\n                <LogOut className=\"w-4 h-4\" />\r\n                Sair\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </aside>\r\n\r\n      {/* Main Content */}\r\n      <main className=\"flex-1 md:ml-64 p-4 md:p-8 overflow-y-auto h-screen\">\r\n\r\n        {/* Mobile Header */}\r\n        <div className=\"md:hidden flex justify-between items-center mb-6 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm\">\r\n          <div className=\"flex items-center space-x-2 text-indigo-600 dark:text-indigo-400\">\r\n            <img src=\"/logo.png\" alt=\"Logo\" className=\"w-6 h-6 rounded-lg\" />\r\n            <span className=\"font-bold\">LabManager</span>\r\n          </div>\r\n          <div className=\"flex items-center space-x-3\">\r\n            <div className=\"w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center overflow-hidden\">\r\n              {user.avatar ? (\r\n                <img src={user.avatar} alt={user.name} className=\"w-full h-full object-cover\" />\r\n              ) : (\r\n                <span className=\"font-bold text-gray-600 dark:text-gray-300 text-xs\">{user.name.charAt(0)}</span>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"max-w-7xl mx-auto space-y-6\">\r\n\r\n          {/* Header & Actions - Only for Inventory */}\r\n          {activeTab === 'inventory' && (\r\n            <div className=\"bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-sm flex flex-col md:flex-row justify-between items-center gap-4 transition-colors duration-200\">\r\n              <div className=\"flex items-center space-x-3\">\r\n                <div className=\"p-2 bg-indigo-50 dark:bg-indigo-900/30 rounded-lg text-indigo-600 dark:text-indigo-400\">\r\n                  <Monitor className=\"w-6 h-6\" />\r\n                </div>\r\n                <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white\">Sistema de Inventário</h1>\r\n              </div>\r\n\r\n              <div className=\"flex items-center space-x-3 w-full md:w-auto\">\r\n                <button\r\n                  onClick={toggleTheme}\r\n                  className=\"p-2 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition\"\r\n                >\r\n                  {theme === 'dark' ? <Sun className=\"w-4 h-4\" /> : <Moon className=\"w-4 h-4\" />}\r\n                </button>\r\n                <button\r\n                  onClick={() => window.location.reload()}\r\n                  className=\"flex items-center space-x-2 px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition text-sm font-medium\"\r\n                >\r\n                  <RefreshCw className=\"w-4 h-4\" />\r\n                  <span>Atualizar</span>\r\n                </button>\r\n                <DataManagement devices={filteredDevices} labs={labs} onImportSuccess={fetchData} />\r\n\r\n                <button\r\n                  onClick={() => setShowScanner(true)}\r\n                  className=\"flex items-center space-x-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition text-sm font-medium shadow-sm\"\r\n                >\r\n                  <QrCode className=\"w-4 h-4\" />\r\n                  <span>Fazer Checklist</span>\r\n                </button>\r\n\r\n                <button\r\n                  onClick={() => setShowAddModal(true)}\r\n                  className=\"flex items-center space-x-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition text-sm font-medium shadow-sm\"\r\n                >\r\n                  <Plus className=\"w-4 h-4\" />\r\n                  <span>Adicionar</span>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {activeTab === 'settings' ? (\r\n            <SettingsLayout onLogout={logout} />\r\n          ) : activeTab === 'tasks' ? (\r\n            <TaskManagement />\r\n          ) : (\r\n            <>\r\n              {/* Dashboard View */}\r\n              {activeTab === 'dashboard' && (\r\n                <div className=\"space-y-6\">\r\n                  <Dashboard />\r\n                </div>\r\n              )}\r\n\r\n              {/* Inventory View */}\r\n              {activeTab === 'inventory' && (\r\n                <>\r\n                  {/* Stats Cards (Optional in Inventory, but keeping for context if needed, or removing if user wants strict separation. User said \"Dashboard copies inventory\", implying they want them separate. I will remove stats from Inventory view based on request to \"fix dashboard\") */}\r\n\r\n                  {/* Filters Bar */}\r\n                  <div className=\"bg-white dark:bg-gray-800 p-4 rounded-2xl shadow-sm flex flex-col md:flex-row gap-4 items-center transition-colors duration-200\">\r\n                    <div className=\"relative flex-1 w-full\">\r\n                      <Search className=\"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\r\n                      <input\r\n                        type=\"text\"\r\n                        placeholder=\"Buscar por patrimônio, marca ou modelo...\"\r\n                        className=\"w-full pl-12 pr-4 py-3 bg-gray-50 dark:bg-gray-700 border-none rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none text-gray-700 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500\"\r\n                        value={searchTerm}\r\n                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                      />\r\n                    </div>\r\n\r\n                    <div className=\"flex flex-col md:flex-row gap-4 w-full md:w-auto\">\r\n                      <div className=\"relative w-full md:w-64\">\r\n                        <select\r\n                          className=\"w-full appearance-none bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl px-4 py-3 pr-10 focus:ring-2 focus:ring-indigo-500 outline-none text-gray-700 dark:text-gray-200 cursor-pointer\"\r\n                          value={labFilter}\r\n                          onChange={(e) => setLabFilter(e.target.value)}\r\n                        >\r\n                          <option value=\"All\">Todos os Laboratórios</option>\r\n                          {labs.map(lab => (\r\n                            <option key={lab.id} value={lab.name}>{lab.name}</option>\r\n                          ))}\r\n                        </select>\r\n                        <ChevronDown className=\"absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4 pointer-events-none\" />\r\n                      </div>\r\n\r\n                      <div className=\"relative w-full md:w-48\">\r\n                        <select\r\n                          className=\"w-full appearance-none bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl px-4 py-3 pr-10 focus:ring-2 focus:ring-indigo-500 outline-none text-gray-700 dark:text-gray-200 cursor-pointer\"\r\n                          value={statusFilter}\r\n                          onChange={(e) => setStatusFilter(e.target.value)}\r\n                        >\r\n                          <option value=\"All\">Todos os Status</option>\r\n                          {Object.values(DeviceStatus).map(status => (\r\n                            <option key={status} value={status}>{status}</option>\r\n                          ))}\r\n                        </select>\r\n                        <ChevronDown className=\"absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4 pointer-events-none\" />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Mobile Card View */}\r\n                  <div className=\"md:hidden space-y-4\">\r\n                    {filteredDevices.map(device => (\r\n                      <div key={device.id} className=\"bg-white dark:bg-gray-800 p-4 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700\">\r\n                        <div className=\"flex justify-between items-start mb-3\">\r\n                          <div>\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <span className=\"font-bold text-gray-900 dark:text-white\">{device.name}</span>\r\n                              <span className={`px-2 py-0.5 rounded-full text-[10px] font-medium ${getStatusColor(device.status)}`}>\r\n                                {device.status}\r\n                              </span>\r\n                            </div>\r\n                            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">{device.brand} {device.model} • {device.lab}</p>\r\n                          </div>\r\n                          <button\r\n                            onClick={() => {\r\n                              setSelectedDevice(device);\r\n                              setShowDetailsModal(true);\r\n                            }}\r\n                            className=\"text-indigo-600 dark:text-indigo-400\"\r\n                          >\r\n                            <Search className=\"w-5 h-5\" />\r\n                          </button>\r\n                        </div>\r\n\r\n                        <div className=\"mt-3 bg-gray-50 dark:bg-gray-700/50 p-3 rounded-lg space-y-2\">\r\n                          <p className=\"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2\">Especificações</p>\r\n                          <div className=\"grid grid-cols-2 gap-x-4 gap-y-2 text-xs\">\r\n                            <div>\r\n                              <span className=\"block text-gray-400 dark:text-gray-500 text-[10px]\">Processador</span>\r\n                              <span className=\"font-medium text-gray-700 dark:text-gray-300 truncate block\" title={device.processor}>{device.processor || '-'}</span>\r\n                            </div>\r\n                            <div>\r\n                              <span className=\"block text-gray-400 dark:text-gray-500 text-[10px]\">RAM</span>\r\n                              <span className=\"font-medium text-gray-700 dark:text-gray-300 truncate block\">{device.ram || '-'}</span>\r\n                            </div>\r\n                            <div className=\"col-span-2\">\r\n                              <span className=\"block text-gray-400 dark:text-gray-500 text-[10px]\">Armazenamento</span>\r\n                              <span className=\"font-medium text-gray-700 dark:text-gray-300 truncate block\">{device.storage || '-'}</span>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-2 gap-2 text-xs text-gray-500 dark:text-gray-400 my-3\">\r\n                          <div className=\"bg-gray-50 dark:bg-gray-700/50 p-2 rounded-lg\">\r\n                            <span className=\"block font-medium text-gray-700 dark:text-gray-300\">Patrimônio</span>\r\n                            {device.id}\r\n                          </div>\r\n                          <div className=\"bg-gray-50 dark:bg-gray-700/50 p-2 rounded-lg\">\r\n                            <span className=\"block font-medium text-gray-700 dark:text-gray-300\">Última Check</span>\r\n                            {formatDate(device.lastCheck)}\r\n                          </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex justify-between items-center pt-3 border-t border-gray-100 dark:border-gray-700\">\r\n                          <div className=\"flex gap-2\">\r\n                            <button\r\n                              onClick={() => {\r\n                                setSelectedDevice(device);\r\n                                setShowChecklistModal(true);\r\n                              }}\r\n                              className=\"px-3 py-1.5 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-lg text-xs font-medium\"\r\n                            >\r\n                              Checklist\r\n                            </button>\r\n                            <button\r\n                              onClick={() => handleAIAnalysis(device)}\r\n                              disabled={device.status === DeviceStatus.OPERATIONAL}\r\n                              className={`p-1.5 rounded-lg ${device.status === DeviceStatus.OPERATIONAL ? 'text-gray-300 dark:text-gray-600' : 'bg-purple-50 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400'}`}\r\n                            >\r\n                              <BrainCircuit className=\"w-4 h-4\" />\r\n                            </button>\r\n                          </div>\r\n                          <div className=\"flex gap-2\">\r\n                            <button\r\n                              onClick={() => generateQRCode(device)}\r\n                              className=\"p-1.5 bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-lg\"\r\n                            >\r\n                              <QrCode className=\"w-4 h-4\" />\r\n                            </button>\r\n                            <button\r\n                              onClick={() => handleDeleteDevice(device.id)}\r\n                              className=\"p-1.5 bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-lg\"\r\n                            >\r\n                              <Trash2 className=\"w-4 h-4\" />\r\n                            </button>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                    {filteredDevices.length === 0 && (\r\n                      <div className=\"text-center py-8 text-gray-400 dark:text-gray-500\">\r\n                        Nenhum equipamento encontrado.\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Desktop Table View */}\r\n                  <div className=\"hidden md:block bg-white dark:bg-gray-800 rounded-2xl shadow-sm overflow-hidden transition-colors duration-200\">\r\n                    <div className=\"overflow-x-auto\">\r\n                      <table className=\"w-full text-left border-collapse\">\r\n                        <thead>\r\n                          <tr className=\"border-b border-gray-100 dark:border-gray-700\">\r\n                            <th className=\"px-6 py-5 text-xs font-bold text-gray-400 uppercase tracking-wider\">Patrimônio</th>\r\n                            <th className=\"px-6 py-5 text-xs font-bold text-gray-400 uppercase tracking-wider\">Laboratório</th>\r\n                            <th className=\"px-6 py-5 text-xs font-bold text-gray-400 uppercase tracking-wider\">Equipamento</th>\r\n                            <th className=\"px-6 py-5 text-xs font-bold text-gray-400 uppercase tracking-wider\">Specs</th>\r\n                            <th className=\"px-6 py-5 text-xs font-bold text-gray-400 uppercase tracking-wider\">Status</th>\r\n                            <th className=\"px-6 py-5 text-xs font-bold text-gray-400 uppercase tracking-wider\">Última Check</th>\r\n                            <th className=\"px-6 py-5 text-xs font-bold text-gray-400 uppercase tracking-wider text-right\">Ações</th>\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-gray-50 dark:divide-gray-700\">\r\n                          {filteredDevices.map(device => (\r\n                            <tr key={device.id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors group\">\r\n                              <td className=\"px-6 py-4 font-bold text-gray-900 dark:text-white\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                  <button\r\n                                    onClick={() => {\r\n                                      setSelectedDevice(device);\r\n                                      setShowDetailsModal(true);\r\n                                    }}\r\n                                    className=\"flex items-center gap-2 hover:text-indigo-600 transition-colors text-left\"\r\n                                  >\r\n                                    {device.id}\r\n                                  </button>\r\n                                </div>\r\n                              </td>\r\n\r\n                              <td className=\"px-6 py-4 text-gray-600 dark:text-gray-300\">{device.lab}</td>\r\n                              <td className=\"px-6 py-4\">\r\n                                <button\r\n                                  onClick={() => {\r\n                                    setSelectedDevice(device);\r\n                                    setShowDetailsModal(true);\r\n                                  }}\r\n                                  className=\"text-left group/btn\"\r\n                                >\r\n                                  <p className=\"font-bold text-gray-900 dark:text-white uppercase group-hover/btn:text-indigo-600 dark:group-hover/btn:text-indigo-400 transition-colors\">{device.name}</p>\r\n                                  <p className=\"text-xs text-gray-500 dark:text-gray-400\">{device.brand} {device.model}</p>\r\n                                </button>\r\n                              </td>\r\n                              <td className=\"px-6 py-4 text-sm text-gray-500 dark:text-gray-400 max-w-xs truncate\">{device.specs}</td>\r\n                              <td className=\"px-6 py-4\">\r\n                                <div className=\"relative group/status\">\r\n                                  <select\r\n                                    value={device.status}\r\n                                    onChange={async (e) => {\r\n                                      await api.updateDevice(device.id, { status: e.target.value as DeviceStatus });\r\n                                      fetchData();\r\n                                    }}\r\n                                    className={`appearance-none pl-3 pr-8 py-1 rounded-full text-xs font-medium cursor-pointer focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-indigo-500 ${getStatusColor(device.status)} bg-opacity-10 border-none`}\r\n                                  >\r\n                                    {Object.values(DeviceStatus).map(status => (\r\n                                      <option key={status} value={status} className=\"text-gray-900 bg-white\">\r\n                                        {status}\r\n                                      </option>\r\n                                    ))}\r\n                                  </select>\r\n                                  <ChevronDown className=\"absolute right-2 top-1/2 transform -translate-y-1/2 w-3 h-3 pointer-events-none opacity-50\" />\r\n                                </div>\r\n                              </td>\r\n                              <td className=\"px-6 py-4 text-gray-500 dark:text-gray-400\">{formatDate(device.lastCheck)}</td>\r\n                              <td className=\"px-6 py-4 text-right\">\r\n                                <div className=\"flex justify-end space-x-2\">\r\n                                  <button\r\n                                    onClick={() => {\r\n                                      setSelectedDevice(device);\r\n                                      setShowChecklistModal(true);\r\n                                    }}\r\n                                    className=\"px-3 py-1.5 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-lg text-sm font-medium hover:bg-indigo-100 dark:hover:bg-indigo-900/50 transition\"\r\n                                  >\r\n                                    Checklist\r\n                                  </button>\r\n                                  <button\r\n                                    onClick={() => handleAIAnalysis(device)}\r\n                                    disabled={device.status === DeviceStatus.OPERATIONAL}\r\n                                    className={`p-1.5 rounded-lg transition ${device.status === DeviceStatus.OPERATIONAL ? 'text-gray-300 dark:text-gray-600 cursor-not-allowed' : 'bg-purple-50 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 hover:bg-purple-100 dark:hover:bg-purple-900/50'}`}\r\n                                    title=\"Diagnóstico IA\"\r\n                                  >\r\n                                    <BrainCircuit className=\"w-5 h-5\" />\r\n                                  </button>\r\n                                  <button\r\n                                    onClick={() => generateQRCode(device)}\r\n                                    className=\"p-1.5 bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition\"\r\n                                    title=\"QR Code\"\r\n                                  >\r\n                                    <QrCode className=\"w-5 h-5\" />\r\n                                  </button>\r\n                                  <button\r\n                                    onClick={() => {\r\n                                      setSelectedDevice(device);\r\n                                      setShowDetailsModal(true);\r\n                                    }}\r\n                                    className=\"p-1.5 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/50 transition\"\r\n                                    title=\"Detalhes\"\r\n                                  >\r\n                                    <Search className=\"w-5 h-5\" />\r\n                                  </button>\r\n                                  <button\r\n                                    onClick={() => handleDeleteDevice(device.id)}\r\n                                    className=\"p-1.5 bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/50 transition\"\r\n                                    title=\"Excluir\"\r\n                                  >\r\n                                    <Trash2 className=\"w-5 h-5\" />\r\n                                  </button>\r\n                                </div>\r\n                              </td>\r\n                            </tr>\r\n                          ))}\r\n                          {filteredDevices.length === 0 && (\r\n                            <tr>\r\n                              <td colSpan={7} className=\"px-6 py-12 text-center text-gray-400 dark:text-gray-500\">\r\n                                Nenhum equipamento encontrado com os filtros atuais.\r\n                              </td>\r\n                            </tr>\r\n                          )}\r\n                        </tbody>\r\n                      </table>\r\n                    </div>\r\n\r\n                    {/* Pagination Mock */}\r\n                    <div className=\"px-6 py-4 border-t border-gray-100 dark:border-gray-700 flex items-center justify-between\">\r\n                      <span className=\"text-sm text-gray-500 dark:text-gray-400\">Mostrando {filteredDevices.length} resultados</span>\r\n                      <div className=\"flex space-x-2\">\r\n                        <button className=\"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 disabled:opacity-50\">\r\n                          <ChevronLeft className=\"w-5 h-5\" />\r\n                        </button>\r\n                        <button className=\"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\">\r\n                          <ChevronRight className=\"w-5 h-5\" />\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </>\r\n              )}\r\n            </>\r\n          )}\r\n        </div>\r\n      </main>\r\n\r\n      {/* Mobile Navigation */}\r\n      <MobileNav\r\n        activeTab={activeTab}\r\n        setActiveTab={setActiveTab}\r\n        onScanClick={() => setShowScanner(true)}\r\n        onLogout={logout}\r\n      />\r\n\r\n      {/* Scanner Modal */}\r\n\r\n\r\n      {/* Add Device Modal */}\r\n      {\r\n        showAddModal && (\r\n          <div className=\"fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4 backdrop-blur-sm\">\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-[95%] md:w-full max-w-2xl max-h-[90vh] overflow-y-auto p-6 relative\">\r\n              <button\r\n                onClick={() => setShowAddModal(false)}\r\n                className=\"absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\r\n              >\r\n                <X className=\"w-6 h-6\" />\r\n              </button>\r\n              <h2 className=\"text-2xl font-bold mb-6 text-gray-900 dark:text-white\">Adicionar Equipamento</h2>\r\n              <form onSubmit={handleAddDevice} className=\"space-y-4\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Patrimônio</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      required\r\n                      className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                      value={newDevice.id}\r\n                      onChange={e => setNewDevice({ ...newDevice, id: e.target.value })}\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Laboratório</label>\r\n                    <select\r\n                      required\r\n                      className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                      value={newDevice.lab}\r\n                      onChange={e => setNewDevice({ ...newDevice, lab: e.target.value })}\r\n                    >\r\n                      <option value=\"\">Selecione...</option>\r\n                      {labs.map(lab => (\r\n                        <option key={lab.id} value={lab.name}>{lab.name}</option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n                </div>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Marca</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      required\r\n                      className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                      value={newDevice.brand}\r\n                      onChange={e => setNewDevice({ ...newDevice, brand: e.target.value })}\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Modelo</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      required\r\n                      className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                      value={newDevice.model}\r\n                      onChange={e => setNewDevice({ ...newDevice, model: e.target.value })}\r\n                    />\r\n                  </div>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Processador</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                    value={newDevice.processor}\r\n                    onChange={e => setNewDevice({ ...newDevice, processor: e.target.value })}\r\n                  />\r\n                </div>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">RAM</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                      value={newDevice.ram}\r\n                      onChange={e => setNewDevice({ ...newDevice, ram: e.target.value })}\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Armazenamento</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                      value={newDevice.storage}\r\n                      onChange={e => setNewDevice({ ...newDevice, storage: e.target.value })}\r\n                    />\r\n                  </div>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Status</label>\r\n                  <select\r\n                    className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                    value={newDevice.status}\r\n                    onChange={e => setNewDevice({ ...newDevice, status: e.target.value as DeviceStatus })}\r\n                  >\r\n                    {Object.values(DeviceStatus).map(status => (\r\n                      <option key={status} value={status}>{status}</option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n                <div className=\"flex justify-end space-x-3 mt-6\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setShowAddModal(false)}\r\n                    className=\"px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg\"\r\n                  >\r\n                    Cancelar\r\n                  </button>\r\n                  <button\r\n                    type=\"submit\"\r\n                    className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700\"\r\n                  >\r\n                    Adicionar\r\n                  </button>\r\n                </div>\r\n              </form>\r\n            </div>\r\n          </div>\r\n        )\r\n      }\r\n\r\n      {/* Checklist Modal */}\r\n      {\r\n        showChecklistModal && selectedDevice && (\r\n          <div className=\"fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4 backdrop-blur-sm\">\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-[95%] md:w-full max-w-lg max-h-[90vh] overflow-y-auto p-6 relative\">\r\n              <button\r\n                onClick={() => setShowChecklistModal(false)}\r\n                className=\"absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\r\n              >\r\n                <X className=\"w-6 h-6\" />\r\n              </button>\r\n              <h2 className=\"text-2xl font-bold mb-2 text-gray-900 dark:text-white\">Checklist de Verificação</h2>\r\n              <p className=\"text-gray-600 dark:text-gray-400 mb-6\">{selectedDevice.id} - {selectedDevice.lab}</p>\r\n\r\n              <div className=\"space-y-3\">\r\n                {[\r\n                  { key: 'teclado', label: 'Teclado funcionando' },\r\n                  { key: 'mouse', label: 'Mouse funcionando' },\r\n                  { key: 'monitor', label: 'Monitor funcionando' },\r\n                  { key: 'cabos', label: 'Cabos em bom estado' },\r\n                  { key: 'software', label: 'Software atualizado' }\r\n                ].map(item => (\r\n                  <label key={item.key} className=\"flex items-center gap-3 p-3 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer transition-colors\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={(checklistData as any)[item.key]}\r\n                      onChange={(e) => setChecklistData({ ...checklistData, [item.key]: e.target.checked })}\r\n                      className=\"w-5 h-5 text-indigo-600 rounded focus:ring-2 focus:ring-indigo-500\"\r\n                    />\r\n                    <span className=\"flex-1 text-gray-700 dark:text-gray-200\">{item.label}</span>\r\n                  </label>\r\n                ))}\r\n\r\n                <textarea\r\n                  placeholder=\"Observações adicionais...\"\r\n                  value={checklistData.observacoes}\r\n                  onChange={(e) => setChecklistData({ ...checklistData, observacoes: e.target.value })}\r\n                  className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white mt-4\"\r\n                  rows={3}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"flex justify-end space-x-3 mt-6\">\r\n                <button\r\n                  onClick={() => setShowChecklistModal(false)}\r\n                  className=\"px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg\"\r\n                >\r\n                  Cancelar\r\n                </button>\r\n                <button\r\n                  onClick={handleChecklistSubmit}\r\n                  className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700\"\r\n                >\r\n                  Salvar Checklist\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )\r\n      }\r\n\r\n      {/* QR Code Modal */}\r\n      {\r\n        showQRModal && selectedDevice && (\r\n          <div className=\"fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4 backdrop-blur-sm\">\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-[95%] md:w-full max-w-sm max-h-[90vh] overflow-y-auto p-6 relative\">\r\n              <button\r\n                onClick={() => setShowQRModal(false)}\r\n                className=\"absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\r\n              >\r\n                <X className=\"w-6 h-6\" />\r\n              </button>\r\n              <h2 className=\"text-2xl font-bold mb-4 text-center text-gray-900 dark:text-white\">QR Code</h2>\r\n              <div className=\"bg-gray-100 dark:bg-gray-700 p-6 rounded-lg mb-4\">\r\n                <div className=\"text-center mb-4\">\r\n                  <div className=\"text-lg font-semibold text-gray-900 dark:text-white\">{selectedDevice.id}</div>\r\n                  <div className=\"text-sm text-gray-600 dark:text-gray-400\">{selectedDevice.lab}</div>\r\n                </div>\r\n                <div className=\"bg-white p-4 rounded-lg flex items-center justify-center\">\r\n                  <div className=\"text-center\">\r\n                    <QrCode className=\"w-32 h-32 mx-auto text-gray-900\" />\r\n                    <p className=\"text-xs text-gray-500 mt-2\">Código QR para {selectedDevice.id}</p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <button\r\n                onClick={() => setShowQRModal(false)}\r\n                className=\"w-full px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700\"\r\n              >\r\n                Fechar\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )\r\n      }\r\n\r\n      {/* Account Settings Modal */}\r\n      {showAccountModal && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4 backdrop-blur-sm\">\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-[95%] md:w-full max-w-md max-h-[90vh] overflow-y-auto p-6 relative\">\r\n            <button\r\n              onClick={() => setShowAccountModal(false)}\r\n              className=\"absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\r\n            >\r\n              <X className=\"w-6 h-6\" />\r\n            </button>\r\n            <h2 className=\"text-2xl font-bold mb-6 text-gray-900 dark:text-white\">Configurações de Conta</h2>\r\n\r\n            <form onSubmit={handleUpdateAccount} className=\"space-y-4\">\r\n              <div className=\"flex justify-center mb-6\">\r\n                <div className=\"relative\">\r\n                  <div className=\"w-24 h-24 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center overflow-hidden border-4 border-white dark:border-gray-600 shadow-lg\">\r\n                    {accountData.avatar ? (\r\n                      <img src={accountData.avatar} alt=\"Avatar\" className=\"w-full h-full object-cover\" />\r\n                    ) : (\r\n                      <UserIcon className=\"w-12 h-12 text-gray-400\" />\r\n                    )}\r\n                  </div>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => document.getElementById('avatar-upload')?.click()}\r\n                    className=\"absolute bottom-0 right-0 p-2 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 shadow-md\"\r\n                  >\r\n                    <Camera className=\"w-4 h-4\" />\r\n                  </button>\r\n                  <input\r\n                    id=\"avatar-upload\"\r\n                    type=\"file\"\r\n                    accept=\"image/*\"\r\n                    className=\"hidden\"\r\n                    onChange={(e) => {\r\n                      const file = e.target.files?.[0];\r\n                      if (file) {\r\n                        const reader = new FileReader();\r\n                        reader.onloadend = () => {\r\n                          setAccountData({ ...accountData, avatar: reader.result as string });\r\n                        };\r\n                        reader.readAsDataURL(file);\r\n                      }\r\n                    }}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Nome</label>\r\n                <input\r\n                  type=\"text\"\r\n                  required\r\n                  className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                  value={accountData.name}\r\n                  onChange={e => setAccountData({ ...accountData, name: e.target.value })}\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Nova Senha (Opcional)</label>\r\n                <input\r\n                  type=\"password\"\r\n                  className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                  value={accountData.newPassword}\r\n                  onChange={e => setAccountData({ ...accountData, newPassword: e.target.value })}\r\n                  placeholder=\"Deixe em branco para manter\"\r\n                />\r\n              </div>\r\n\r\n              <div className=\"flex justify-end space-x-3 mt-6\">\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setShowAccountModal(false)}\r\n                  className=\"px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg\"\r\n                >\r\n                  Cancelar\r\n                </button>\r\n                <button\r\n                  type=\"submit\"\r\n                  className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700\"\r\n                >\r\n                  Salvar Alterações\r\n                </button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Scanner Modal */}\r\n      {showScanner && (\r\n        <ScannerModal\r\n          onClose={() => setShowScanner(false)}\r\n          onScan={(deviceId) => {\r\n            setShowScanner(false);\r\n            const device = devices.find(d => d.id === deviceId);\r\n            if (device) {\r\n              setSelectedDevice(device);\r\n              setShowChecklistModal(true);\r\n            } else {\r\n              alert('Dispositivo não encontrado!');\r\n            }\r\n          }}\r\n        />\r\n      )}\r\n\r\n      {/* Device Details Modal */}\r\n      {\r\n        showDetailsModal && selectedDevice && (\r\n          <DeviceDetailsModal\r\n            device={selectedDevice}\r\n            onClose={() => setShowDetailsModal(false)}\r\n          />\r\n        )\r\n      }\r\n\r\n      {/* AI Analysis Modal */}\r\n      <AIModal\r\n        isOpen={aiModalOpen}\r\n        onClose={() => setAiModalOpen(false)}\r\n        title={`Diagnóstico Técnico: ${selectedDeviceName}`}\r\n        content={aiAnalysisContent}\r\n        isLoading={isAiLoading}\r\n      />\r\n\r\n      {/* Helper icon for Lucide imports that aren't used in main render but imported */}\r\n      <div className=\"hidden\">\r\n        <BarChart3 />\r\n        <Settings />\r\n      </div>\r\n\r\n      {chatUser && (\r\n        <ChatWindow\r\n          targetUser={chatUser}\r\n          onClose={() => setChatUser(null)}\r\n        />\r\n      )}\r\n\r\n    </div >\r\n  );\r\n}\r\n\r\nexport default function App() {\r\n  return (\r\n    <ErrorBoundary>\r\n      <AuthProvider>\r\n        <ThemeProvider>\r\n          <AppContent />\r\n        </ThemeProvider>\r\n      </AuthProvider>\r\n    </ErrorBoundary>\r\n  );\r\n}\r\n",
  "components/AIModal.tsx": "import React from 'react';\r\nimport { X, Sparkles } from 'lucide-react';\r\n\r\ninterface AIModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  title: string;\r\n  content: string;\r\n  isLoading: boolean;\r\n}\r\n\r\nexport const AIModal: React.FC<AIModalProps> = ({ isOpen, onClose, title, content, isLoading }) => {\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4\">\r\n      <div className=\"bg-white rounded-2xl shadow-xl w-[95%] md:w-full max-w-lg max-h-[90vh] overflow-y-auto animate-fade-in-up\">\r\n        <div className=\"bg-gradient-to-r from-indigo-600 to-blue-600 p-4 flex justify-between items-center text-white\">\r\n          <div className=\"flex items-center space-x-2\">\r\n            <Sparkles className=\"w-5 h-5\" />\r\n            <h3 className=\"font-bold text-lg\">Análise IA Gemini</h3>\r\n          </div>\r\n          <button onClick={onClose} className=\"hover:bg-white/20 p-1 rounded-full transition\">\r\n            <X className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"p-6\">\r\n          <h4 className=\"font-semibold text-gray-800 mb-3 border-b pb-2\">{title}</h4>\r\n\r\n          {isLoading ? (\r\n            <div className=\"flex flex-col items-center justify-center py-8 space-y-3\">\r\n              <div className=\"w-8 h-8 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin\"></div>\r\n              <p className=\"text-gray-500 text-sm animate-pulse\">Consultando especialista técnico...</p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"prose prose-sm text-gray-700 bg-gray-50 p-4 rounded-lg border border-gray-200 whitespace-pre-wrap\">\r\n              {content}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"bg-gray-50 px-6 py-3 border-t flex justify-end\">\r\n          <button\r\n            onClick={onClose}\r\n            className=\"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg text-sm font-medium transition\"\r\n          >\r\n            Fechar\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n",
  "components/ChatWindow.tsx": "import React, { useState, useEffect, useRef } from 'react';\r\nimport { api } from '../services/api';\r\nimport { User, Message } from '../types';\r\nimport { X, Send, User as UserIcon } from 'lucide-react';\r\nimport { useAuth } from '../contexts/AuthContext';\r\n\r\ninterface ChatWindowProps {\r\n    targetUser: User;\r\n    onClose: () => void;\r\n}\r\n\r\nexport function ChatWindow({ targetUser, onClose }: ChatWindowProps) {\r\n    const { user: currentUser } = useAuth();\r\n    const [newMessage, setNewMessage] = useState('');\r\n    const messagesEndRef = useRef<HTMLDivElement>(null);\r\n\r\n    const [messages, setMessages] = useState<Message[]>([]);\r\n\r\n    const fetchMessages = async () => {\r\n        if (!currentUser?.id || !targetUser.id) return;\r\n        try {\r\n            const allMessages = await api.getMessages();\r\n            const filtered = allMessages.filter(m =>\r\n                (m.senderId === currentUser.id.toString() && m.receiverId === targetUser.id.toString()) ||\r\n                (m.senderId === targetUser.id.toString() && m.receiverId === currentUser.id.toString())\r\n            );\r\n            const sorted = filtered.sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());\r\n            setMessages(sorted);\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch messages\", error);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchMessages();\r\n        const interval = setInterval(fetchMessages, 3000); // Poll every 3 seconds\r\n        return () => clearInterval(interval);\r\n    }, [currentUser?.id, targetUser.id]);\r\n\r\n    const scrollToBottom = () => {\r\n        messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n    };\r\n\r\n    useEffect(() => {\r\n        scrollToBottom();\r\n    }, [messages]);\r\n\r\n    const handleSendMessage = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!newMessage.trim() || !currentUser?.id) return;\r\n\r\n        await api.createMessage({\r\n            senderId: currentUser.id.toString(),\r\n            receiverId: targetUser.id.toString(),\r\n            content: newMessage,\r\n            timestamp: new Date().toISOString(),\r\n            read: false\r\n        });\r\n        fetchMessages();\r\n\r\n        setNewMessage('');\r\n    };\r\n\r\n    if (!currentUser) return null;\r\n\r\n    return (\r\n        <div className=\"fixed bottom-4 right-4 w-80 md:w-96 bg-white dark:bg-gray-800 rounded-t-xl shadow-2xl border border-gray-200 dark:border-gray-700 flex flex-col z-50 animate-in slide-in-from-bottom-5 h-[500px]\">\r\n            {/* Header */}\r\n            <div className=\"p-3 bg-indigo-600 text-white rounded-t-xl flex justify-between items-center shadow-sm\">\r\n                <div className=\"flex items-center gap-3\">\r\n                    <div className=\"relative\">\r\n                        <div className=\"w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center overflow-hidden border border-indigo-400\">\r\n                            {targetUser.avatar ? (\r\n                                <img src={targetUser.avatar} alt={targetUser.name} className=\"w-full h-full object-cover\" />\r\n                            ) : (\r\n                                <span className=\"font-bold text-xs\">{targetUser.name.charAt(0)}</span>\r\n                            )}\r\n                        </div>\r\n                        <div className={`absolute bottom-0 right-0 w-2.5 h-2.5 rounded-full border-2 border-indigo-600 ${targetUser.status === 'busy' ? 'bg-red-400' :\r\n                            targetUser.status === 'offline' ? 'bg-gray-400' :\r\n                                'bg-green-400'\r\n                            }`}></div>\r\n                    </div>\r\n                    <div>\r\n                        <h3 className=\"font-semibold text-sm\">{targetUser.name}</h3>\r\n                        <p className=\"text-xs text-indigo-200 capitalize\">{targetUser.status || 'Offline'}</p>\r\n                    </div>\r\n                </div>\r\n                <button\r\n                    onClick={onClose}\r\n                    className=\"p-1 hover:bg-indigo-700 rounded-full transition-colors\"\r\n                >\r\n                    <X className=\"w-5 h-5\" />\r\n                </button>\r\n            </div>\r\n\r\n            {/* Messages Area */}\r\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50 dark:bg-gray-900/50\">\r\n                {messages?.map((msg) => {\r\n                    const isMe = msg.senderId === currentUser.id.toString();\r\n                    return (\r\n                        <div key={msg.id} className={`flex ${isMe ? 'justify-end' : 'justify-start'}`}>\r\n                            <div className={`max-w-[80%] rounded-2xl px-4 py-2 text-sm shadow-sm ${isMe\r\n                                ? 'bg-indigo-600 text-white rounded-br-none'\r\n                                : 'bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-bl-none border border-gray-100 dark:border-gray-600'\r\n                                }`}>\r\n                                <p>{msg.content}</p>\r\n                                <p className={`text-[10px] mt-1 text-right ${isMe ? 'text-indigo-200' : 'text-gray-400'}`}>\r\n                                    {new Date(msg.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                })}\r\n                <div ref={messagesEndRef} />\r\n            </div>\r\n\r\n            {/* Input Area */}\r\n            <form onSubmit={handleSendMessage} className=\"p-3 bg-white dark:bg-gray-800 border-t border-gray-100 dark:border-gray-700 flex gap-2\">\r\n                <input\r\n                    type=\"text\"\r\n                    value={newMessage}\r\n                    onChange={(e) => setNewMessage(e.target.value)}\r\n                    placeholder=\"Digite sua mensagem...\"\r\n                    className=\"flex-1 px-4 py-2 bg-gray-100 dark:bg-gray-700 border-none rounded-full focus:ring-2 focus:ring-indigo-500 outline-none text-sm text-gray-900 dark:text-white\"\r\n                />\r\n                <button\r\n                    type=\"submit\"\r\n                    disabled={!newMessage.trim()}\r\n                    className=\"p-2 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm\"\r\n                >\r\n                    <Send className=\"w-5 h-5\" />\r\n                </button>\r\n            </form>\r\n        </div>\r\n    );\r\n}\r\n",
  "components/Dashboard.tsx": "import React, { useMemo, useState, useEffect } from 'react';\r\nimport { api } from '../services/api';\r\nimport { Device, DeviceStatus } from '../types';\r\nimport { StatCard } from './StatCard';\r\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell, PieChart, Pie, Legend } from 'recharts';\r\nimport { Monitor, AlertTriangle, CheckCircle, Clock, Layout, HardDrive, Cpu } from 'lucide-react';\r\n\r\nconst COLORS = ['#10B981', '#F59E0B', '#EF4444', '#6B7280']; // Operational, Maint, Broken, Missing\r\n\r\nexport function Dashboard() {\r\n    const [devices, setDevices] = useState<Device[]>([]);\r\n\r\n    useEffect(() => {\r\n        api.getDevices().then(setDevices).catch(console.error);\r\n    }, []);\r\n\r\n    const stats = useMemo(() => {\r\n        return {\r\n            total: devices.length,\r\n            operational: devices.filter(d => d.status === DeviceStatus.OPERATIONAL).length,\r\n            maintenance: devices.filter(d => d.status === DeviceStatus.MAINTENANCE).length,\r\n            broken: devices.filter(d => d.status === DeviceStatus.BROKEN).length,\r\n            missing: devices.filter(d => d.status === DeviceStatus.MISSING).length,\r\n        };\r\n    }, [devices]);\r\n\r\n    const statusData = [\r\n        { name: 'Operacional', value: stats.operational },\r\n        { name: 'Manutenção', value: stats.maintenance },\r\n        { name: 'Quebrado', value: stats.broken },\r\n        { name: 'Desaparecido', value: stats.missing },\r\n    ];\r\n\r\n    // Mock Software/OS Data (In a real app, this would come from device specs or logs)\r\n    const osData = [\r\n        { name: 'Windows 11', value: Math.round(devices.length * 0.6) },\r\n        { name: 'Windows 10', value: Math.round(devices.length * 0.3) },\r\n        { name: 'Linux (Ubuntu)', value: Math.round(devices.length * 0.1) },\r\n    ];\r\n\r\n    const softwareData = [\r\n        { name: 'Office 365', count: Math.round(devices.length * 0.9) },\r\n        { name: 'VS Code', count: Math.round(devices.length * 0.5) },\r\n        { name: 'Chrome', count: devices.length },\r\n        { name: 'Adobe Reader', count: Math.round(devices.length * 0.8) },\r\n    ];\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">Visão Geral do Sistema</h2>\r\n\r\n            {/* Stats Cards */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n                <StatCard\r\n                    title=\"Total de Equipamentos\"\r\n                    value={stats.total}\r\n                    icon={Monitor}\r\n                    color=\"bg-blue-500\"\r\n                    textColor=\"text-white\"\r\n                />\r\n                <StatCard\r\n                    title=\"Operacionais\"\r\n                    value={stats.operational}\r\n                    icon={CheckCircle}\r\n                    color=\"bg-green-500\"\r\n                    textColor=\"text-white\"\r\n                />\r\n                <StatCard\r\n                    title=\"Em Manutenção\"\r\n                    value={stats.maintenance}\r\n                    icon={Clock}\r\n                    color=\"bg-yellow-500\"\r\n                    textColor=\"text-white\"\r\n                />\r\n                <StatCard\r\n                    title=\"Críticos/Quebrados\"\r\n                    value={stats.broken + stats.missing}\r\n                    icon={AlertTriangle}\r\n                    color=\"bg-red-500\"\r\n                    textColor=\"text-white\"\r\n                />\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                {/* Status Chart */}\r\n                <div className=\"bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700\">\r\n                    <h3 className=\"text-lg font-bold text-gray-900 dark:text-white mb-6\">Status dos Equipamentos</h3>\r\n                    <div className=\"h-64 w-full\">\r\n                        {statusData.length > 0 ? (\r\n                            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                <PieChart>\r\n                                    <Pie\r\n                                        data={statusData}\r\n                                        cx=\"50%\"\r\n                                        cy=\"50%\"\r\n                                        innerRadius={60}\r\n                                        outerRadius={80}\r\n                                        paddingAngle={5}\r\n                                        dataKey=\"value\"\r\n                                    >\r\n                                        {statusData.map((entry, index) => (\r\n                                            <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\r\n                                        ))}\r\n                                    </Pie>\r\n                                    <Tooltip\r\n                                        contentStyle={{ backgroundColor: '#1F2937', border: 'none', borderRadius: '8px', color: '#fff' }}\r\n                                    />\r\n                                    <Legend />\r\n                                </PieChart>\r\n                            </ResponsiveContainer>\r\n                        ) : (\r\n                            <div className=\"flex items-center justify-center h-full text-gray-500\">\r\n                                Carregando dados...\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* OS Distribution */}\r\n                <div className=\"bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700\">\r\n                    <h3 className=\"text-lg font-bold text-gray-900 dark:text-white mb-6\">Distribuição de Sistema Operacional</h3>\r\n                    <div className=\"h-64 w-full\">\r\n                        <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                            <BarChart data={osData} layout=\"vertical\">\r\n                                <CartesianGrid strokeDasharray=\"3 3\" horizontal={false} stroke=\"#374151\" opacity={0.1} />\r\n                                <XAxis type=\"number\" hide />\r\n                                <YAxis dataKey=\"name\" type=\"category\" width={100} tick={{ fill: '#6B7280' }} />\r\n                                <Tooltip\r\n                                    cursor={{ fill: 'transparent' }}\r\n                                    contentStyle={{ backgroundColor: '#1F2937', border: 'none', borderRadius: '8px', color: '#fff' }}\r\n                                />\r\n                                <Bar dataKey=\"value\" fill=\"#6366f1\" radius={[0, 4, 4, 0]} barSize={20} />\r\n                            </BarChart>\r\n                        </ResponsiveContainer>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Software Stats */}\r\n            <div className=\"bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700\">\r\n                <div className=\"flex items-center gap-2 mb-6\">\r\n                    <Layout className=\"w-5 h-5 text-indigo-500\" />\r\n                    <h3 className=\"text-lg font-bold text-gray-900 dark:text-white\">Softwares Mais Comuns</h3>\r\n                </div>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n                    {softwareData.map((sw, idx) => (\r\n                        <div key={idx} className=\"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl\">\r\n                            <div className=\"flex justify-between items-start mb-2\">\r\n                                <span className=\"font-medium text-gray-900 dark:text-white\">{sw.name}</span>\r\n                                <span className=\"text-xs bg-indigo-100 dark:bg-indigo-900/50 text-indigo-600 dark:text-indigo-400 px-2 py-1 rounded-full\">\r\n                                    {Math.round((sw.count / devices.length) * 100)}%\r\n                                </span>\r\n                            </div>\r\n                            <div className=\"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-1.5\">\r\n                                <div\r\n                                    className=\"bg-indigo-500 h-1.5 rounded-full\"\r\n                                    style={{ width: `${(sw.count / devices.length) * 100}%` }}\r\n                                ></div>\r\n                            </div>\r\n                            <p className=\"text-xs text-gray-500 mt-2\">{sw.count} instalações detectadas</p>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n",
  "components/DataManagement.tsx": "import React, { useState, useRef } from 'react';\r\nimport { Download, Upload, FileSpreadsheet, FileText, ChevronDown } from 'lucide-react';\r\nimport * as XLSX from 'xlsx';\r\nimport { api } from '../services/api';\r\nimport { Device, DeviceStatus, Lab } from '../types';\r\n\r\ninterface DataManagementProps {\r\n    devices: Device[];\r\n    labs: Lab[];\r\n    onImportSuccess?: () => void;\r\n}\r\n\r\nexport function DataManagement({ devices, labs, onImportSuccess }: DataManagementProps) {\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n    const dropdownRef = useRef<HTMLDivElement>(null);\r\n\r\n    // Close dropdown when clicking outside\r\n    React.useEffect(() => {\r\n        function handleClickOutside(event: MouseEvent) {\r\n            if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\r\n                setIsOpen(false);\r\n            }\r\n        }\r\n        document.addEventListener(\"mousedown\", handleClickOutside);\r\n        return () => {\r\n            document.removeEventListener(\"mousedown\", handleClickOutside);\r\n        };\r\n    }, []);\r\n\r\n    const downloadTemplate = () => {\r\n        const headers = ['Patrimônio', 'Laboratório', 'Marca', 'Modelo', 'Processador', 'RAM', 'Armazenamento', 'Status'];\r\n        const csv = headers.join(',');\r\n        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\r\n        const url = window.URL.createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.href = url;\r\n        a.download = 'modelo_importacao.csv';\r\n        a.click();\r\n        setIsOpen(false);\r\n    };\r\n\r\n    const exportToCSV = () => {\r\n        const headers = ['Patrimônio', 'Laboratório', 'Marca', 'Modelo', 'Processador', 'RAM', 'Armazenamento', 'Status', 'Última Verificação'];\r\n        const rows = devices.map(c => [\r\n            c.id,\r\n            c.lab,\r\n            c.brand || '',\r\n            c.model || '',\r\n            c.processor || '',\r\n            c.ram || '',\r\n            c.storage || '',\r\n            c.status,\r\n            c.lastCheck\r\n        ]);\r\n\r\n        const csv = [headers, ...rows].map(row => row.join(',')).join('\\n');\r\n        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\r\n        const url = window.URL.createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.href = url;\r\n        a.download = `inventario_${new Date().toISOString().split('T')[0]}.csv`;\r\n        a.click();\r\n        setIsOpen(false);\r\n    };\r\n\r\n    const exportToExcel = () => {\r\n        const data = devices.map(device => ({\r\n            'Patrimônio': device.id,\r\n            'Laboratório': device.lab,\r\n            'Marca': device.brand,\r\n            'Modelo': device.model,\r\n            'Processador': device.processor,\r\n            'RAM': device.ram,\r\n            'Armazenamento': device.storage,\r\n            'Status': device.status,\r\n            'Última Verificação': device.lastCheck\r\n        }));\r\n\r\n        const ws = XLSX.utils.json_to_sheet(data);\r\n        const wb = XLSX.utils.book_new();\r\n        XLSX.utils.book_append_sheet(wb, ws, \"Inventário\");\r\n        XLSX.writeFile(wb, `inventario_${new Date().toISOString().split('T')[0]}.xlsx`);\r\n        setIsOpen(false);\r\n    };\r\n\r\n    const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        const reader = new FileReader();\r\n        reader.onload = async (evt) => {\r\n            try {\r\n                const bstr = evt.target?.result;\r\n                const wb = XLSX.read(bstr, { type: 'binary' });\r\n                const wsname = wb.SheetNames[0];\r\n                const ws = wb.Sheets[wsname];\r\n                const data = XLSX.utils.sheet_to_json(ws);\r\n\r\n                let importedCount = 0;\r\n                let errorCount = 0;\r\n\r\n                for (const row of data as any[]) {\r\n                    // Normalize keys to lowercase for easier matching\r\n                    const normalizedRow: any = {};\r\n                    Object.keys(row).forEach(key => {\r\n                        normalizedRow[key.toLowerCase().trim()] = row[key];\r\n                    });\r\n\r\n                    // Flexible column matching\r\n                    const id = normalizedRow['patrimônio'] || normalizedRow['patrimonio'] || normalizedRow['id'] || normalizedRow['serial'];\r\n                    const lab = normalizedRow['laboratório'] || normalizedRow['laboratorio'] || normalizedRow['lab'] || normalizedRow['local'];\r\n\r\n                    if (!id || !lab) {\r\n                        console.warn(\"Skipping row due to missing ID or Lab:\", row);\r\n                        errorCount++;\r\n                        continue;\r\n                    }\r\n\r\n                    // Find labId\r\n                    const selectedLab = labs.find(l => l.name.toLowerCase() === String(lab).toLowerCase());\r\n\r\n                    if (!selectedLab) {\r\n                        console.warn(\"Skipping row due to invalid Lab:\", lab);\r\n                        errorCount++;\r\n                        continue;\r\n                    }\r\n\r\n                    const deviceData = {\r\n                        id: String(id),\r\n                        lab: String(lab),\r\n                        brand: normalizedRow['marca'] || normalizedRow['brand'] || '',\r\n                        model: normalizedRow['modelo'] || normalizedRow['model'] || '',\r\n                        processor: normalizedRow['processador'] || normalizedRow['processor'] || normalizedRow['cpu'] || '',\r\n                        ram: normalizedRow['ram'] || normalizedRow['memory'] || '',\r\n                        storage: normalizedRow['armazenamento'] || normalizedRow['storage'] || normalizedRow['hd'] || normalizedRow['ssd'] || '',\r\n                        status: (Object.values(DeviceStatus).includes(normalizedRow['status']) ? normalizedRow['status'] : DeviceStatus.OPERATIONAL) as DeviceStatus,\r\n                        labId: selectedLab.id\r\n                    };\r\n\r\n                    try {\r\n                        // Try to create\r\n                        try {\r\n                            await api.addComputador(deviceData);\r\n                            importedCount++;\r\n                        } catch (createError) {\r\n                            // If create failed, maybe it exists. Try update.\r\n                            try {\r\n                                await api.updateDevice(deviceData.id, deviceData);\r\n                                importedCount++;\r\n                            } catch (updateError) {\r\n                                console.error(\"Error importing device (create & update failed):\", deviceData, createError, updateError);\r\n                                errorCount++;\r\n                            }\r\n                        }\r\n                    } catch (err) {\r\n                        console.error(\"Error importing device:\", deviceData, err);\r\n                        errorCount++;\r\n                    }\r\n                }\r\n\r\n                alert(`Importação concluída!\\nImportados/Atualizados: ${importedCount}\\nErros/Ignorados: ${errorCount}`);\r\n                if (onImportSuccess) onImportSuccess();\r\n\r\n            } catch (error) {\r\n                console.error(\"Error parsing file:\", error);\r\n                alert(\"Erro ao processar o arquivo. Verifique o formato.\");\r\n            } finally {\r\n                if (fileInputRef.current) fileInputRef.current.value = ''; // Reset input\r\n                setIsOpen(false);\r\n            }\r\n        };\r\n        reader.readAsBinaryString(file);\r\n    };\r\n\r\n    const triggerImport = () => {\r\n        fileInputRef.current?.click();\r\n    };\r\n\r\n    return (\r\n        <div className=\"relative\" ref={dropdownRef}>\r\n            <button\r\n                onClick={() => setIsOpen(!isOpen)}\r\n                className=\"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition text-sm font-medium shadow-sm\"\r\n            >\r\n                <Download className=\"w-4 h-4\" />\r\n                <span>Dados</span>\r\n                <ChevronDown className={`w-4 h-4 transition-transform ${isOpen ? 'rotate-180' : ''}`} />\r\n            </button>\r\n\r\n            {isOpen && (\r\n                <div className=\"absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 py-1 z-50 animate-in fade-in zoom-in-95 duration-200\">\r\n                    <button\r\n                        onClick={downloadTemplate}\r\n                        className=\"w-full text-left px-4 py-2.5 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-2\"\r\n                    >\r\n                        <FileText className=\"w-4 h-4 text-gray-500\" />\r\n                        Baixar Modelo CSV\r\n                    </button>\r\n                    <div className=\"h-px bg-gray-100 dark:bg-gray-700 my-1\" />\r\n                    <button\r\n                        onClick={exportToCSV}\r\n                        className=\"w-full text-left px-4 py-2.5 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-2\"\r\n                    >\r\n                        <FileText className=\"w-4 h-4 text-green-600\" />\r\n                        Exportar CSV\r\n                    </button>\r\n                    <button\r\n                        onClick={exportToExcel}\r\n                        className=\"w-full text-left px-4 py-2.5 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-2\"\r\n                    >\r\n                        <FileSpreadsheet className=\"w-4 h-4 text-green-600\" />\r\n                        Exportar Excel\r\n                    </button>\r\n                    <div className=\"h-px bg-gray-100 dark:bg-gray-700 my-1\" />\r\n                    <button\r\n                        onClick={triggerImport}\r\n                        className=\"w-full text-left px-4 py-2.5 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-2\"\r\n                    >\r\n                        <Upload className=\"w-4 h-4 text-blue-600\" />\r\n                        Importar Dados\r\n                    </button>\r\n                </div>\r\n            )}\r\n\r\n            <input\r\n                type=\"file\"\r\n                ref={fileInputRef}\r\n                onChange={handleFileUpload}\r\n                accept=\".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel\"\r\n                className=\"hidden\"\r\n            />\r\n        </div>\r\n    );\r\n}\r\n",
  "components/DeviceDetailsModal.tsx": "import React, { useState } from 'react';\r\nimport { X, Calendar, User, AlertTriangle, Search, CheckCircle, Clock, Plus, Save } from 'lucide-react';\r\nimport { Device, CheckRecord, Log } from '../types';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { api } from '../services/api';\r\n\r\ninterface DeviceDetailsModalProps {\r\n    device: Device;\r\n    onClose: () => void;\r\n}\r\n\r\nexport function DeviceDetailsModal({ device, onClose }: DeviceDetailsModalProps) {\r\n    const { user } = useAuth();\r\n    const [activeTab, setActiveTab] = useState<'info' | 'history' | 'logs'>('info');\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [dateFilter, setDateFilter] = useState('');\r\n\r\n    // Manual Log State\r\n    const [showAddLog, setShowAddLog] = useState(false);\r\n    const [newLogContent, setNewLogContent] = useState('');\r\n    const [newLogDate, setNewLogDate] = useState(new Date().toISOString().split('T')[0]);\r\n\r\n    // Checklist State\r\n    const [showAddChecklist, setShowAddChecklist] = useState(false);\r\n    const [newChecklist, setNewChecklist] = useState({\r\n        teclado: false,\r\n        mouse: false,\r\n        monitor: false,\r\n        cabos: false,\r\n        software: false,\r\n        observacoes: ''\r\n    });\r\n\r\n    const handleAddChecklist = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!user) return;\r\n\r\n        const record: CheckRecord = {\r\n            date: new Date().toISOString().split('T')[0],\r\n            time: new Date().toLocaleTimeString(),\r\n            teclado: newChecklist.teclado,\r\n            mouse: newChecklist.mouse,\r\n            monitor: newChecklist.monitor,\r\n            cabos: newChecklist.cabos,\r\n            software: newChecklist.software,\r\n            observacoes: newChecklist.observacoes,\r\n            userId: user.id.toString(),\r\n            userName: user.name\r\n        };\r\n\r\n        const updatedHistory = [...(device.checkHistory || []), record];\r\n        await api.updateDevice(device.id, {\r\n            checkHistory: updatedHistory,\r\n            lastCheck: record.date\r\n        });\r\n\r\n        setShowAddChecklist(false);\r\n        setNewChecklist({\r\n            teclado: false,\r\n            mouse: false,\r\n            monitor: false,\r\n            cabos: false,\r\n            software: false,\r\n            observacoes: ''\r\n        });\r\n    };\r\n\r\n    const formatDate = (dateString: string) => {\r\n        if (!dateString) return '-';\r\n        const [year, month, day] = dateString.split('-');\r\n        return `${day}/${month}/${year}`;\r\n    };\r\n\r\n    const filterByDateAndSearch = (items: (CheckRecord | Log)[]) => {\r\n        return items.filter(item => {\r\n            const matchesSearch = JSON.stringify(item).toLowerCase().includes(searchTerm.toLowerCase());\r\n            const matchesDate = !dateFilter || item.date === dateFilter;\r\n            return matchesSearch && matchesDate;\r\n        });\r\n    };\r\n\r\n    const handleAddLog = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!newLogContent.trim() || !user) return;\r\n\r\n        const newLog: Log = {\r\n            id: Date.now(), // Simple ID generation\r\n            date: newLogDate,\r\n            description: newLogContent,\r\n            type: 'info', // Default type for manual entry\r\n            userId: user.id.toString(),\r\n            userName: user.name\r\n        };\r\n\r\n        const updatedLogs = [...(device.logs || []), newLog];\r\n\r\n        await api.updateDevice(device.id, {\r\n            logs: updatedLogs\r\n        });\r\n\r\n        setNewLogContent('');\r\n        setShowAddLog(false);\r\n    };\r\n\r\n    const sortedHistory = [...(device.checkHistory || [])].sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\r\n    const sortedLogs = [...(device.logs || [])].sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\r\n\r\n    const filteredHistory = filterByDateAndSearch(sortedHistory) as CheckRecord[];\r\n    const filteredLogs = filterByDateAndSearch(sortedLogs) as Log[];\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4 backdrop-blur-sm\">\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-[95%] md:w-full max-w-4xl overflow-hidden flex flex-col max-h-[90vh]\">\r\n                {/* Header */}\r\n                <div className=\"p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-start\">\r\n                    <div>\r\n                        <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2\">\r\n                            {device.name}\r\n                            <span className={`text-xs px-2 py-1 rounded-full ${device.status === 'Operacional' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}`}>\r\n                                {device.status}\r\n                            </span>\r\n                        </h2>\r\n                        <p className=\"text-gray-500 dark:text-gray-400 mt-1\">ID: {device.id} • {device.lab}</p>\r\n                    </div>\r\n                    <button onClick={onClose} className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\">\r\n                        <X className=\"w-6 h-6\" />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Tabs */}\r\n                <div className=\"flex border-b border-gray-200 dark:border-gray-700 px-6\">\r\n                    <button\r\n                        onClick={() => setActiveTab('info')}\r\n                        className={`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${activeTab === 'info' ? 'border-indigo-600 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700'}`}\r\n                    >\r\n                        Informações\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setActiveTab('history')}\r\n                        className={`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${activeTab === 'history' ? 'border-indigo-600 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700'}`}\r\n                    >\r\n                        Histórico de Checklists\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setActiveTab('logs')}\r\n                        className={`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${activeTab === 'logs' ? 'border-indigo-600 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700'}`}\r\n                    >\r\n                        Login de atividade\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div className=\"p-6 overflow-y-auto flex-1 bg-gray-50 dark:bg-gray-900/50\">\r\n                    {activeTab === 'info' && (\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                            <div className=\"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm\">\r\n                                <h3 className=\"font-bold text-gray-900 dark:text-white mb-4\">Especificações Técnicas</h3>\r\n                                <div className=\"space-y-3 text-sm\">\r\n                                    <div className=\"flex justify-between border-b border-gray-100 dark:border-gray-700 pb-2\">\r\n                                        <span className=\"text-gray-500\">Marca</span>\r\n                                        <span className=\"font-medium text-gray-900 dark:text-white\">{device.brand}</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between border-b border-gray-100 dark:border-gray-700 pb-2\">\r\n                                        <span className=\"text-gray-500\">Modelo</span>\r\n                                        <span className=\"font-medium text-gray-900 dark:text-white\">{device.model}</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between border-b border-gray-100 dark:border-gray-700 pb-2\">\r\n                                        <span className=\"text-gray-500\">Processador</span>\r\n                                        <span className=\"font-medium text-gray-900 dark:text-white\">{device.processor}</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between border-b border-gray-100 dark:border-gray-700 pb-2\">\r\n                                        <span className=\"text-gray-500\">RAM</span>\r\n                                        <span className=\"font-medium text-gray-900 dark:text-white\">{device.ram}</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between border-b border-gray-100 dark:border-gray-700 pb-2\">\r\n                                        <span className=\"text-gray-500\">Armazenamento</span>\r\n                                        <span className=\"font-medium text-gray-900 dark:text-white\">{device.storage}</span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm\">\r\n                                <h3 className=\"font-bold text-gray-900 dark:text-white mb-4\">Status Atual</h3>\r\n                                <div className=\"space-y-4\">\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className={`w-3 h-3 rounded-full ${device.status === 'Operacional' ? 'bg-green-500' : 'bg-yellow-500'}`}></div>\r\n                                        <span className=\"text-gray-700 dark:text-gray-300\">{device.status}</span>\r\n                                    </div>\r\n                                    <div className=\"text-sm text-gray-500\">\r\n                                        Última verificação: {formatDate(device.lastCheck)}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {(activeTab === 'history' || activeTab === 'logs') && (\r\n                        <div className=\"space-y-4\">\r\n                            {/* Filters & Actions */}\r\n                            <div className=\"flex flex-col md:flex-row gap-4 mb-4 justify-between\">\r\n                                <div className=\"flex gap-4 flex-1\">\r\n                                    <div className=\"flex-1 relative\">\r\n                                        <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            placeholder=\"Pesquisar...\"\r\n                                            value={searchTerm}\r\n                                            onChange={(e) => setSearchTerm(e.target.value)}\r\n                                            className=\"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                                        />\r\n                                    </div>\r\n                                    <input\r\n                                        type=\"date\"\r\n                                        value={dateFilter}\r\n                                        onChange={(e) => setDateFilter(e.target.value)}\r\n                                        className=\"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                                    />\r\n                                </div>\r\n                                {activeTab === 'logs' && (\r\n                                    <button\r\n                                        onClick={() => setShowAddLog(!showAddLog)}\r\n                                        className=\"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition text-sm font-medium\"\r\n                                    >\r\n                                        <Plus className=\"w-4 h-4\" />\r\n                                        Adicionar Registro\r\n                                    </button>\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Add Log Form */}\r\n                            {activeTab === 'logs' && showAddLog && (\r\n                                <div className=\"bg-white dark:bg-gray-800 p-4 rounded-lg border border-indigo-100 dark:border-indigo-900/50 mb-4 animate-in fade-in slide-in-from-top-2\">\r\n                                    <form onSubmit={handleAddLog} className=\"space-y-3\">\r\n                                        <div>\r\n                                            <label className=\"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1\">Conteúdo</label>\r\n                                            <textarea\r\n                                                value={newLogContent}\r\n                                                onChange={(e) => setNewLogContent(e.target.value)}\r\n                                                className=\"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 outline-none resize-none h-20\"\r\n                                                placeholder=\"Descreva a atividade...\"\r\n                                                required\r\n                                            />\r\n                                        </div>\r\n                                        <div className=\"flex justify-between items-center\">\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <label className=\"text-xs font-medium text-gray-700 dark:text-gray-300\">Data:</label>\r\n                                                <input\r\n                                                    type=\"date\"\r\n                                                    value={newLogDate}\r\n                                                    onChange={(e) => setNewLogDate(e.target.value)}\r\n                                                    className=\"p-1 border border-gray-300 dark:border-gray-600 rounded text-xs bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                                                    required\r\n                                                />\r\n                                            </div>\r\n                                            <div className=\"flex gap-2\">\r\n                                                <button\r\n                                                    type=\"button\"\r\n                                                    onClick={() => setShowAddLog(false)}\r\n                                                    className=\"px-3 py-1.5 text-xs font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg\"\r\n                                                >\r\n                                                    Cancelar\r\n                                                </button>\r\n                                                <button\r\n                                                    type=\"submit\"\r\n                                                    className=\"flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-xs font-medium\"\r\n                                                >\r\n                                                    <Save className=\"w-3 h-3\" />\r\n                                                    Salvar\r\n                                                </button>\r\n                                            </div>\r\n                                        </div>\r\n                                    </form>\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* List */}\r\n                            <div className=\"space-y-3\">\r\n                                {activeTab === 'history' ? (\r\n                                    <>\r\n                                        <div className=\"flex justify-end mb-4\">\r\n                                            <button\r\n                                                onClick={() => setShowAddChecklist(!showAddChecklist)}\r\n                                                className=\"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition text-sm font-medium\"\r\n                                            >\r\n                                                <CheckCircle className=\"w-4 h-4\" />\r\n                                                Realizar Checklist\r\n                                            </button>\r\n                                        </div>\r\n\r\n                                        {showAddChecklist && (\r\n                                            <div className=\"bg-white dark:bg-gray-800 p-4 rounded-lg border border-indigo-100 dark:border-indigo-900/50 mb-4 animate-in fade-in slide-in-from-top-2\">\r\n                                                <form onSubmit={handleAddChecklist} className=\"space-y-4\">\r\n                                                    <div className=\"grid grid-cols-2 gap-4\">\r\n                                                        <div className=\"flex items-center gap-2\">\r\n                                                            <input type=\"checkbox\" checked={newChecklist.teclado} onChange={e => setNewChecklist({ ...newChecklist, teclado: e.target.checked })} id=\"chk_teclado\" />\r\n                                                            <label htmlFor=\"chk_teclado\" className=\"text-sm\">Teclado</label>\r\n                                                        </div>\r\n                                                        <div className=\"flex items-center gap-2\">\r\n                                                            <input type=\"checkbox\" checked={newChecklist.mouse} onChange={e => setNewChecklist({ ...newChecklist, mouse: e.target.checked })} id=\"chk_mouse\" />\r\n                                                            <label htmlFor=\"chk_mouse\" className=\"text-sm\">Mouse</label>\r\n                                                        </div>\r\n                                                        <div className=\"flex items-center gap-2\">\r\n                                                            <input type=\"checkbox\" checked={newChecklist.monitor} onChange={e => setNewChecklist({ ...newChecklist, monitor: e.target.checked })} id=\"chk_monitor\" />\r\n                                                            <label htmlFor=\"chk_monitor\" className=\"text-sm\">Monitor</label>\r\n                                                        </div>\r\n                                                        <div className=\"flex items-center gap-2\">\r\n                                                            <input type=\"checkbox\" checked={newChecklist.cabos} onChange={e => setNewChecklist({ ...newChecklist, cabos: e.target.checked })} id=\"chk_cabos\" />\r\n                                                            <label htmlFor=\"chk_cabos\" className=\"text-sm\">Cabos</label>\r\n                                                        </div>\r\n                                                        <div className=\"flex items-center gap-2\">\r\n                                                            <input type=\"checkbox\" checked={newChecklist.software} onChange={e => setNewChecklist({ ...newChecklist, software: e.target.checked })} id=\"chk_software\" />\r\n                                                            <label htmlFor=\"chk_software\" className=\"text-sm\">Software</label>\r\n                                                        </div>\r\n                                                    </div>\r\n\r\n                                                    <div>\r\n                                                        <label className=\"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1\">Responsável</label>\r\n                                                        <input\r\n                                                            type=\"text\"\r\n                                                            value={user?.name || 'Usuário Desconhecido'}\r\n                                                            disabled\r\n                                                            className=\"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm bg-gray-100 dark:bg-gray-700 text-gray-500 cursor-not-allowed\"\r\n                                                        />\r\n                                                    </div>\r\n\r\n                                                    <div>\r\n                                                        <label className=\"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1\">Observações</label>\r\n                                                        <textarea\r\n                                                            value={newChecklist.observacoes}\r\n                                                            onChange={(e) => setNewChecklist({ ...newChecklist, observacoes: e.target.value })}\r\n                                                            className=\"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white outline-none resize-none h-20\"\r\n                                                            placeholder=\"Observações adicionais...\"\r\n                                                        />\r\n                                                    </div>\r\n\r\n                                                    <div className=\"flex justify-end gap-2\">\r\n                                                        <button\r\n                                                            type=\"button\"\r\n                                                            onClick={() => setShowAddChecklist(false)}\r\n                                                            className=\"px-3 py-1.5 text-xs font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg\"\r\n                                                        >\r\n                                                            Cancelar\r\n                                                        </button>\r\n                                                        <button\r\n                                                            type=\"submit\"\r\n                                                            className=\"flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-xs font-medium\"\r\n                                                        >\r\n                                                            <Save className=\"w-3 h-3\" />\r\n                                                            Salvar Checklist\r\n                                                        </button>\r\n                                                    </div>\r\n                                                </form>\r\n                                            </div>\r\n                                        )}\r\n\r\n                                        {filteredHistory.length === 0 ? (\r\n                                            <p className=\"text-center text-gray-500 py-8\">Nenhum checklist encontrado.</p>\r\n                                        ) : (\r\n                                            filteredHistory.map((record, idx) => (\r\n                                                <div key={idx} className=\"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700\">\r\n                                                    <div className=\"flex justify-between items-start mb-2\">\r\n                                                        <div className=\"flex items-center gap-2\">\r\n                                                            <Calendar className=\"w-4 h-4 text-indigo-500\" />\r\n                                                            <span className=\"font-medium text-gray-900 dark:text-white\">{formatDate(record.date)}</span>\r\n                                                            <span className=\"text-gray-400 text-sm\">• {record.time}</span>\r\n                                                        </div>\r\n                                                        {record.userId && record.userId !== user?.id.toString() && (\r\n                                                            <div className=\"flex items-center gap-1 text-xs text-orange-600 bg-orange-50 px-2 py-1 rounded-full\">\r\n                                                                <AlertTriangle className=\"w-3 h-3\" />\r\n                                                                Feito por: {record.userName || 'Outro usuário'}\r\n                                                            </div>\r\n                                                        )}\r\n                                                    </div>\r\n                                                    <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-2 text-sm mb-3\">\r\n                                                        <div className={`flex items-center gap-1 ${record.teclado ? 'text-green-600' : 'text-red-600'}`}>\r\n                                                            <CheckCircle className=\"w-3 h-3\" /> Teclado\r\n                                                        </div>\r\n                                                        <div className={`flex items-center gap-1 ${record.mouse ? 'text-green-600' : 'text-red-600'}`}>\r\n                                                            <CheckCircle className=\"w-3 h-3\" /> Mouse\r\n                                                        </div>\r\n                                                        <div className={`flex items-center gap-1 ${record.monitor ? 'text-green-600' : 'text-red-600'}`}>\r\n                                                            <CheckCircle className=\"w-3 h-3\" /> Monitor\r\n                                                        </div>\r\n                                                    </div>\r\n                                                    {record.observacoes && (\r\n                                                        <div className=\"text-sm text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-900 p-2 rounded\">\r\n                                                            \"{record.observacoes}\"\r\n                                                        </div>\r\n                                                    )}\r\n                                                </div>\r\n                                            ))\r\n                                        )}\r\n                                    </>\r\n                                ) : (\r\n                                    filteredLogs.length === 0 ? (\r\n                                        <p className=\"text-center text-gray-500 py-8\">Nenhum log encontrado.</p>\r\n                                    ) : (\r\n                                        filteredLogs.map((log, idx) => (\r\n                                            <div key={idx} className=\"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700\">\r\n                                                <div className=\"flex justify-between items-start mb-2\">\r\n                                                    <div className=\"flex items-center gap-2\">\r\n                                                        <Clock className=\"w-4 h-4 text-purple-500\" />\r\n                                                        <span className=\"font-medium text-gray-900 dark:text-white\">{formatDate(log.date)}</span>\r\n                                                        <span className={`text-xs px-2 py-0.5 rounded-full ${log.type === 'error' ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800'}`}>\r\n                                                            {log.type}\r\n                                                        </span>\r\n                                                    </div>\r\n                                                    <div className=\"flex items-center gap-2\">\r\n                                                        {log.userName && (\r\n                                                            <div className=\"flex items-center gap-1 text-xs text-gray-500 bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded-full\">\r\n                                                                <User className=\"w-3 h-3\" />\r\n                                                                {log.userName}\r\n                                                            </div>\r\n                                                        )}\r\n                                                    </div>\r\n                                                </div>\r\n                                                <p className=\"text-sm text-gray-700 dark:text-gray-300\">{log.description}</p>\r\n                                            </div>\r\n                                        ))\r\n                                    )\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n",
  "components/ErrorBoundary.tsx": "import React, { Component, ErrorInfo, ReactNode } from 'react';\r\n\r\ninterface Props {\r\n    children: ReactNode;\r\n}\r\n\r\ninterface State {\r\n    hasError: boolean;\r\n    error: Error | null;\r\n}\r\n\r\nexport class ErrorBoundary extends Component<Props, State> {\r\n    public state: State = {\r\n        hasError: false,\r\n        error: null\r\n    };\r\n\r\n    public static getDerivedStateFromError(error: Error): State {\r\n        return { hasError: true, error };\r\n    }\r\n\r\n    public componentDidCatch(error: Error, errorInfo: ErrorInfo) {\r\n        console.error('Uncaught error:', error, errorInfo);\r\n    }\r\n\r\n    public render() {\r\n        if (this.state.hasError) {\r\n            return (\r\n                <div className=\"min-h-screen flex items-center justify-center bg-red-50 p-4\">\r\n                    <div className=\"bg-white p-6 rounded-lg shadow-xl max-w-md w-full\">\r\n                        <h2 className=\"text-xl font-bold text-red-600 mb-4\">Algo deu errado</h2>\r\n                        <p className=\"text-gray-600 mb-4\">Ocorreu um erro inesperado na aplicação.</p>\r\n                        <pre className=\"bg-gray-100 p-3 rounded text-xs overflow-auto mb-4 text-red-800\">\r\n                            {this.state.error?.toString()}\r\n                        </pre>\r\n                        <button\r\n                            onClick={() => window.location.reload()}\r\n                            className=\"w-full py-2 px-4 bg-red-600 text-white rounded hover:bg-red-700 transition\"\r\n                        >\r\n                            Recarregar Página\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return this.props.children;\r\n    }\r\n}\r\n",
  "components/GroupManagement.tsx": "import React, { useState, useEffect } from 'react';\r\nimport { api } from '../services/api';\r\nimport { Plus, Trash2, Edit2, Shield, Users, User, Save, X, UserPlus, CheckSquare, Square } from 'lucide-react';\r\nimport { Group, User as UserType } from '../types';\r\n\r\nconst AVAILABLE_PERMISSIONS = [\r\n    { id: 'manage_users', label: 'Gerenciar Usuários' },\r\n    { id: 'manage_groups', label: 'Gerenciar Grupos' },\r\n    { id: 'manage_structure', label: 'Gerenciar Estrutura' },\r\n    { id: 'manage_inventory', label: 'Gerenciar Inventário' },\r\n    { id: 'manage_tasks', label: 'Gerenciar Tarefas' },\r\n    { id: 'view_reports', label: 'Visualizar Relatórios' },\r\n    { id: 'view_only', label: 'Leitor (Apenas Visualizar e Observações)' },\r\n    { id: 'create_tasks', label: 'Criar Tarefas' },\r\n];\r\n\r\ninterface GroupDetailsModalProps {\r\n    group: Group;\r\n    onClose: () => void;\r\n}\r\n\r\nfunction GroupDetailsModal({ group, onClose }: GroupDetailsModalProps) {\r\n    const [activeTab, setActiveTab] = useState<'members' | 'permissions'>('members');\r\n    const [users, setUsers] = useState<UserType[]>([]);\r\n\r\n    const fetchUsers = async () => {\r\n        try {\r\n            const usersData = await api.getUsers();\r\n            setUsers(usersData);\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch users\", error);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchUsers();\r\n    }, []);\r\n\r\n    const groupUsers = users.filter(u => u.groupId === group.id);\r\n\r\n    // Permissions State\r\n    const [permissions, setPermissions] = useState<string[]>(group.permissions || []);\r\n\r\n    // Member Add State\r\n    const [isAddingMember, setIsAddingMember] = useState(false);\r\n    const [selectedUserId, setSelectedUserId] = useState<number | ''>('');\r\n\r\n    const handleSavePermissions = async () => {\r\n        if (group.id) {\r\n            await api.updateGroup(group.id, { permissions });\r\n            alert('Permissões salvas com sucesso!');\r\n        }\r\n    };\r\n\r\n    const togglePermission = (permId: string) => {\r\n        setPermissions(prev =>\r\n            prev.includes(permId)\r\n                ? prev.filter(p => p !== permId)\r\n                : [...prev, permId]\r\n        );\r\n    };\r\n\r\n    const handleAddMember = async () => {\r\n        if (!selectedUserId) {\r\n            alert(\"Por favor, selecione um usuário.\");\r\n            return;\r\n        }\r\n        if (!group.id) {\r\n            alert(\"Erro: ID do grupo não encontrado.\");\r\n            return;\r\n        }\r\n\r\n        try {\r\n            console.log(`Adding user ${selectedUserId} to group ${group.id}`);\r\n            await api.updateUser(Number(selectedUserId), { groupId: group.id });\r\n            await fetchUsers(); // Wait for fetch to complete\r\n            setIsAddingMember(false);\r\n            setSelectedUserId('');\r\n            alert(\"Usuário adicionado com sucesso!\");\r\n        } catch (error) {\r\n            console.error(\"Failed to add member:\", error);\r\n            alert(\"Erro ao adicionar membro ao grupo. Verifique o console para mais detalhes.\");\r\n        }\r\n    };\r\n\r\n    const handleRemoveMember = async (userId: number) => {\r\n        if (confirm('Remover usuário deste grupo?')) {\r\n            try {\r\n                await api.updateUser(userId, { groupId: null as any });\r\n                await fetchUsers();\r\n                alert(\"Usuário removido do grupo.\");\r\n            } catch (error) {\r\n                console.error(\"Failed to remove member:\", error);\r\n                alert(\"Erro ao remover usuário do grupo.\");\r\n            }\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4 backdrop-blur-sm\">\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh]\">\r\n                <div className=\"p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center\">\r\n                    <div>\r\n                        <h2 className=\"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2\">\r\n                            <Shield className=\"w-5 h-5 text-indigo-500\" />\r\n                            {group.name}\r\n                        </h2>\r\n                        <p className=\"text-sm text-gray-500 dark:text-gray-400\">{group.description}</p>\r\n                    </div>\r\n                    <button onClick={onClose} className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\">\r\n                        <X className=\"w-6 h-6\" />\r\n                    </button>\r\n                </div>\r\n\r\n                <div className=\"flex border-b border-gray-200 dark:border-gray-700 px-6\">\r\n                    <button\r\n                        onClick={() => setActiveTab('members')}\r\n                        className={`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${activeTab === 'members' ? 'border-indigo-600 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700'}`}\r\n                    >\r\n                        Membros ({groupUsers.length})\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setActiveTab('permissions')}\r\n                        className={`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${activeTab === 'permissions' ? 'border-indigo-600 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700'}`}\r\n                    >\r\n                        Permissões\r\n                    </button>\r\n                </div>\r\n\r\n                <div className=\"p-6 overflow-y-auto flex-1 bg-gray-50 dark:bg-gray-900/50\">\r\n                    {activeTab === 'members' && (\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"flex justify-between items-center\">\r\n                                <h3 className=\"font-medium text-gray-900 dark:text-white\">Gerenciar Membros</h3>\r\n                                <button\r\n                                    onClick={() => setIsAddingMember(true)}\r\n                                    className=\"text-xs bg-indigo-600 text-white px-3 py-1.5 rounded-lg hover:bg-indigo-700 flex items-center gap-1\"\r\n                                >\r\n                                    <UserPlus className=\"w-3 h-3\" />\r\n                                    Adicionar\r\n                                </button>\r\n                            </div>\r\n\r\n                            {isAddingMember && (\r\n                                <div className=\"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 flex gap-2 items-end animate-in fade-in slide-in-from-top-2\">\r\n                                    <div className=\"flex-1\">\r\n                                        <label className=\"block text-xs font-medium text-gray-500 mb-1\">Selecione o Usuário</label>\r\n                                        <select\r\n                                            value={selectedUserId}\r\n                                            onChange={(e) => setSelectedUserId(Number(e.target.value))}\r\n                                            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white text-sm\"\r\n                                        >\r\n                                            <option value=\"\">Selecione...</option>\r\n                                            {users.filter(u => u.groupId !== group.id).map(u => (\r\n                                                <option key={u.id} value={u.id}>{u.name} ({u.email})</option>\r\n                                            ))}\r\n                                        </select>\r\n                                    </div>\r\n                                    <button onClick={handleAddMember} className=\"px-3 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700\">Confirmar</button>\r\n                                    <button onClick={() => setIsAddingMember(false)} className=\"px-3 py-2 bg-gray-200 text-gray-700 text-sm rounded-lg hover:bg-gray-300\">Cancelar</button>\r\n                                </div>\r\n                            )}\r\n\r\n                            <div className=\"space-y-2\">\r\n                                {groupUsers.length === 0 ? (\r\n                                    <p className=\"text-sm text-gray-500 italic text-center py-4\">Nenhum membro neste grupo.</p>\r\n                                ) : (\r\n                                    groupUsers.map(user => (\r\n                                        <div key={user.id} className=\"flex items-center justify-between p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\">\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                <div className=\"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden\">\r\n                                                    {user.avatar ? <img src={user.avatar} className=\"w-full h-full object-cover\" /> : <User className=\"w-4 h-4 text-gray-500\" />}\r\n                                                </div>\r\n                                                <div>\r\n                                                    <p className=\"text-sm font-medium text-gray-900 dark:text-white\">{user.name}</p>\r\n                                                    <p className=\"text-xs text-gray-500\">{user.email}</p>\r\n                                                </div>\r\n                                            </div>\r\n                                            <button onClick={() => user.id && handleRemoveMember(user.id)} className=\"text-red-500 hover:text-red-700 p-1 rounded hover:bg-red-50 dark:hover:bg-red-900/20\">\r\n                                                <X className=\"w-4 h-4\" />\r\n                                            </button>\r\n                                        </div>\r\n                                    ))\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {activeTab === 'permissions' && (\r\n                        <div className=\"space-y-6\">\r\n                            <div className=\"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-100 dark:border-yellow-900/50\">\r\n                                <p className=\"text-sm text-yellow-800 dark:text-yellow-200\">\r\n                                    Selecione as permissões que os membros deste grupo terão no sistema.\r\n                                </p>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\r\n                                {AVAILABLE_PERMISSIONS.map(perm => (\r\n                                    <div\r\n                                        key={perm.id}\r\n                                        onClick={() => togglePermission(perm.id)}\r\n                                        className={`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all ${permissions.includes(perm.id)\r\n                                            ? 'bg-indigo-50 border-indigo-200 dark:bg-indigo-900/20 dark:border-indigo-800'\r\n                                            : 'bg-white border-gray-200 dark:bg-gray-800 dark:border-gray-700 hover:border-indigo-300'\r\n                                            }`}\r\n                                    >\r\n                                        <div className={`w-5 h-5 rounded border flex items-center justify-center ${permissions.includes(perm.id)\r\n                                            ? 'bg-indigo-600 border-indigo-600 text-white'\r\n                                            : 'border-gray-400 bg-white dark:bg-gray-700'\r\n                                            }`}>\r\n                                            {permissions.includes(perm.id) && <CheckSquare className=\"w-3.5 h-3.5\" />}\r\n                                        </div>\r\n                                        <span className=\"text-sm font-medium text-gray-700 dark:text-gray-200\">{perm.label}</span>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n\r\n                            <div className=\"flex justify-end pt-4 border-t border-gray-200 dark:border-gray-700\">\r\n                                <button\r\n                                    onClick={handleSavePermissions}\r\n                                    className=\"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium text-sm\"\r\n                                >\r\n                                    <Save className=\"w-4 h-4\" />\r\n                                    Salvar Permissões\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport function GroupManagement() {\r\n    const [groups, setGroups] = useState<Group[]>([]);\r\n    const [users, setUsers] = useState<UserType[]>([]);\r\n\r\n    const fetchData = async () => {\r\n        try {\r\n            const [groupsData, usersData] = await Promise.all([\r\n                api.getGroups(),\r\n                api.getUsers()\r\n            ]);\r\n            setGroups(groupsData);\r\n            setUsers(usersData);\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch data\", error);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchData();\r\n    }, []);\r\n\r\n    // Form State\r\n    const [newGroupName, setNewGroupName] = useState('');\r\n    const [newGroupDesc, setNewGroupDesc] = useState('');\r\n\r\n    // Editing State\r\n    const [editingGroup, setEditingGroup] = useState<Group | null>(null);\r\n\r\n    // Modal State\r\n    const [selectedGroup, setSelectedGroup] = useState<Group | null>(null);\r\n\r\n    const handleAddGroup = async () => {\r\n        if (!newGroupName) return;\r\n        await api.createGroup({ name: newGroupName, description: newGroupDesc, permissions: [] });\r\n        setNewGroupName('');\r\n        setNewGroupDesc('');\r\n        fetchData();\r\n    };\r\n\r\n    const handleUpdateGroup = async () => {\r\n        if (!editingGroup || !editingGroup.id) return;\r\n        await api.updateGroup(editingGroup.id, {\r\n            name: editingGroup.name,\r\n            description: editingGroup.description\r\n        });\r\n        setEditingGroup(null);\r\n        fetchData();\r\n    };\r\n\r\n    const handleDeleteGroup = async (id: number) => {\r\n        if (confirm('Tem certeza? Usuários neste grupo perderão a associação.')) {\r\n            // We need to update users first.\r\n            // But we can't do a bulk update via API easily unless we add an endpoint.\r\n            // Or we iterate.\r\n            // Or we let the database handle it (foreign key set null? SQLite supports it if configured).\r\n            // But we didn't configure foreign keys in migrate.js explicitly with onDelete('SET NULL').\r\n            // So we should do it manually.\r\n            // Find users in group\r\n            const usersInGroup = users.filter(u => u.groupId === id);\r\n            await Promise.all(usersInGroup.map(u => api.updateUser(u.id, { groupId: null as any })));\r\n\r\n            await api.deleteGroup(id);\r\n            fetchData();\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <h2 className=\"text-xl font-bold text-gray-900 dark:text-white\">Gerenciamento de Grupos</h2>\r\n            </div>\r\n\r\n            <div className=\"space-y-4\">\r\n                {/* Add Form */}\r\n                <div className=\"flex gap-4 items-end bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg\">\r\n                    <div className=\"flex-1\">\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Nome do Grupo</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={newGroupName}\r\n                            onChange={(e) => setNewGroupName(e.target.value)}\r\n                            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                            placeholder=\"Ex: Técnicos\"\r\n                        />\r\n                    </div>\r\n                    <div className=\"flex-1\">\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Descrição</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={newGroupDesc}\r\n                            onChange={(e) => setNewGroupDesc(e.target.value)}\r\n                            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                            placeholder=\"Descrição das permissões...\"\r\n                        />\r\n                    </div>\r\n                    <button\r\n                        onClick={handleAddGroup}\r\n                        className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center gap-2\"\r\n                    >\r\n                        <Plus className=\"w-4 h-4\" />\r\n                        Adicionar\r\n                    </button>\r\n                </div>\r\n\r\n                {/* List */}\r\n                <div className=\"space-y-2\">\r\n                    {groups.map(group => {\r\n                        const groupUsers = users.filter(u => u.groupId === group.id);\r\n\r\n                        return (\r\n                            <div key={group.id} className=\"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden p-3 transition-all hover:shadow-md\">\r\n                                {editingGroup?.id === group.id ? (\r\n                                    <div className=\"flex gap-4 items-end\">\r\n                                        <div className=\"flex-1\">\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                value={editingGroup.name}\r\n                                                onChange={(e) => setEditingGroup({ ...editingGroup, name: e.target.value })}\r\n                                                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                                            />\r\n                                        </div>\r\n                                        <div className=\"flex-1\">\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                value={editingGroup.description || ''}\r\n                                                onChange={(e) => setEditingGroup({ ...editingGroup, description: e.target.value })}\r\n                                                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                                            />\r\n                                        </div>\r\n                                        <button onClick={handleUpdateGroup} className=\"p-2 bg-green-100 text-green-600 rounded-lg hover:bg-green-200\">\r\n                                            <Save className=\"w-4 h-4\" />\r\n                                        </button>\r\n                                        <button onClick={() => setEditingGroup(null)} className=\"p-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200\">\r\n                                            <X className=\"w-4 h-4\" />\r\n                                        </button>\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"flex items-center justify-between\">\r\n                                        <div\r\n                                            className=\"flex items-center gap-3 cursor-pointer flex-1\"\r\n                                            onClick={() => setSelectedGroup(group)}\r\n                                        >\r\n                                            <div className=\"p-2 bg-indigo-50 dark:bg-indigo-900/30 rounded-lg\">\r\n                                                <Shield className=\"w-5 h-5 text-indigo-500\" />\r\n                                            </div>\r\n                                            <div>\r\n                                                <span className=\"font-medium text-gray-900 dark:text-white block\">{group.name}</span>\r\n                                                <span className=\"text-xs text-gray-500\">{group.description} • {groupUsers.length} membros</span>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"flex gap-2\">\r\n                                            <button onClick={() => setEditingGroup(group)} className=\"text-indigo-500 hover:text-indigo-700 p-2 hover:bg-indigo-50 dark:hover:bg-indigo-900/30 rounded-lg transition-colors\">\r\n                                                <Edit2 className=\"w-4 h-4\" />\r\n                                            </button>\r\n                                            <button onClick={() => group.id && handleDeleteGroup(group.id)} className=\"text-red-500 hover:text-red-700 p-2 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors\">\r\n                                                <Trash2 className=\"w-4 h-4\" />\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n            </div>\r\n\r\n            {selectedGroup && (\r\n                <GroupDetailsModal\r\n                    group={selectedGroup}\r\n                    onClose={() => setSelectedGroup(null)}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n",
  "components/LoginPage.tsx": "import React, { useState } from 'react';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { Mail, Lock } from 'lucide-react';\r\n\r\nexport function LoginPage() {\r\n    const { login, isLoading } = useAuth();\r\n\r\n    const [email, setEmail] = useState('');\r\n    const [password, setPassword] = useState('');\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!email || !password) return;\r\n\r\n        const cleanEmail = email.trim().toLowerCase();\r\n        await login(cleanEmail, password);\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 flex flex-col justify-center py-12 sm:px-6 lg:px-8\">\r\n            <div className=\"sm:mx-auto sm:w-full sm:max-w-md\">\r\n\r\n                <div className=\"flex justify-center\">\r\n                    <img src=\"/logo.png\" alt=\"Logo\" className=\"w-16 h-16 rounded-xl shadow-lg\" />\r\n                </div>\r\n\r\n                <h2 className=\"mt-6 text-center text-3xl font-extrabold text-gray-900 dark:text-white\">\r\n                    LabManager AI\r\n                </h2>\r\n\r\n                <p className=\"mt-2 text-center text-sm text-gray-600 dark:text-gray-400\">\r\n                    Informe suas credenciais para acessar o sistema\r\n                </p>\r\n            </div>\r\n\r\n            <div className=\"mt-8 sm:mx-auto sm:w-full sm:max-w-md\">\r\n                <div className=\"bg-white dark:bg-gray-800 py-8 px-4 shadow sm:rounded-lg sm:px-10\">\r\n\r\n                    <form className=\"space-y-6\" onSubmit={handleSubmit}>\r\n\r\n                        {/* Email */}\r\n                        <div>\r\n                            <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">\r\n                                Email\r\n                            </label>\r\n\r\n                            <div className=\"mt-1 relative rounded-md shadow-sm\">\r\n                                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                                    <Mail className=\"h-5 w-5 text-gray-400\" />\r\n                                </div>\r\n\r\n                                <input\r\n                                    id=\"email\"\r\n                                    name=\"email\"\r\n                                    type=\"email\"\r\n                                    required\r\n                                    className=\"focus:ring-indigo-500 focus:border-indigo-500 block w-full pl-10 sm:text-sm border-gray-300 dark:border-gray-600 rounded-md py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                                    placeholder=\"seu@email.com\"\r\n                                    value={email}\r\n                                    onChange={(e) => setEmail(e.target.value)}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Senha */}\r\n                        <div>\r\n                            <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">\r\n                                Senha\r\n                            </label>\r\n\r\n                            <div className=\"mt-1 relative rounded-md shadow-sm\">\r\n                                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                                    <Lock className=\"h-5 w-5 text-gray-400\" />\r\n                                </div>\r\n\r\n                                <input\r\n                                    id=\"password\"\r\n                                    name=\"password\"\r\n                                    type=\"password\"\r\n                                    required\r\n                                    autoComplete=\"current-password\"\r\n                                    className=\"focus:ring-indigo-500 focus:border-indigo-500 block w-full pl-10 sm:text-sm border-gray-300 dark:border-gray-600 rounded-md py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                                    placeholder=\"••••••••\"\r\n                                    value={password}\r\n                                    onChange={(e) => setPassword(e.target.value)}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Botão Entrar */}\r\n                        <div>\r\n                            <button\r\n                                type=\"submit\"\r\n                                disabled={isLoading}\r\n                                className=\"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50\"\r\n                            >\r\n                                {isLoading ? \"Entrando...\" : \"Entrar\"}\r\n                            </button>\r\n                        </div>\r\n                    </form>\r\n\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n",
  "components/MobileNav.tsx": "import React from 'react';\r\nimport { LayoutDashboard, Monitor, QrCode, LogOut, Settings, CheckCircle, FileText } from 'lucide-react';\r\n\r\ninterface MobileNavProps {\r\n    activeTab: 'dashboard' | 'inventory' | 'settings' | 'tasks';\r\n    setActiveTab: (tab: 'dashboard' | 'inventory' | 'settings' | 'tasks') => void;\r\n    onScanClick: () => void;\r\n    onLogout: () => void;\r\n}\r\n\r\nexport function MobileNav({ activeTab, setActiveTab, onScanClick, onLogout }: MobileNavProps) {\r\n    return (\r\n        <div className=\"md:hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 z-50 pb-safe transition-colors duration-200\">\r\n            <div className=\"flex justify-around items-center h-16\">\r\n                <button\r\n                    onClick={() => setActiveTab('dashboard')}\r\n                    className={`flex flex-col items-center justify-center w-full h-full space-y-1 ${activeTab === 'dashboard' ? 'text-indigo-600 dark:text-indigo-400' : 'text-gray-500 dark:text-gray-400'}`}\r\n                >\r\n                    <LayoutDashboard className=\"w-6 h-6\" />\r\n                    <span className=\"text-[10px] font-medium\">Dashboard</span>\r\n                </button>\r\n\r\n                <button\r\n                    onClick={() => setActiveTab('inventory')}\r\n                    className={`flex flex-col items-center justify-center w-full h-full space-y-1 ${activeTab === 'inventory' ? 'text-indigo-600 dark:text-indigo-400' : 'text-gray-500 dark:text-gray-400'}`}\r\n                >\r\n                    <Monitor className=\"w-6 h-6\" />\r\n                    <span className=\"text-[10px] font-medium\">Inventário</span>\r\n                </button>\r\n\r\n\r\n\r\n                <button\r\n                    onClick={() => setActiveTab('tasks')}\r\n                    className={`flex flex-col items-center justify-center w-full h-full space-y-1 ${activeTab === 'tasks' ? 'text-indigo-600 dark:text-indigo-400' : 'text-gray-500 dark:text-gray-400'}`}\r\n                >\r\n                    <CheckCircle className=\"w-6 h-6\" />\r\n                    <span className=\"text-[10px] font-medium\">Tarefas</span>\r\n                </button>\r\n\r\n\r\n\r\n                <button\r\n                    onClick={() => setActiveTab('settings')}\r\n                    className={`flex flex-col items-center justify-center w-full h-full space-y-1 ${activeTab === 'settings' ? 'text-indigo-600 dark:text-indigo-400' : 'text-gray-500 dark:text-gray-400'}`}\r\n                >\r\n                    <Settings className=\"w-6 h-6\" />\r\n                    <span className=\"text-[10px] font-medium\">Config</span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n",
  "components/Reports.tsx": "import React, { useState, useMemo, useEffect } from 'react';\r\nimport { api } from '../services/api';\r\nimport { Printer, Calendar, FileText, Download, Filter } from 'lucide-react';\r\nimport { Device, CheckRecord } from '../types';\r\n\r\ntype Period = 'day' | 'week' | 'month' | 'semester' | 'year';\r\n\r\ninterface ReportItem {\r\n    date: string;\r\n    time: string;\r\n    deviceName: string;\r\n    labName: string;\r\n    userName: string;\r\n    status: string; // 'Completo' or 'Incompleto' (based on checks)\r\n    issues: string[];\r\n}\r\n\r\nexport function Reports() {\r\n    const [period, setPeriod] = useState<Period>('month');\r\n    const [devices, setDevices] = useState<Device[]>([]);\r\n\r\n    useEffect(() => {\r\n        api.getDevices().then(setDevices).catch(console.error);\r\n    }, []);\r\n\r\n    const getStartDate = (p: Period): Date => {\r\n        const now = new Date();\r\n        switch (p) {\r\n            case 'day': return new Date(now.setHours(0, 0, 0, 0));\r\n            case 'week': {\r\n                const d = new Date(now);\r\n                d.setDate(d.getDate() - 7);\r\n                return d;\r\n            }\r\n            case 'month': {\r\n                const d = new Date(now);\r\n                d.setMonth(d.getMonth() - 1);\r\n                return d;\r\n            }\r\n            case 'semester': {\r\n                const d = new Date(now);\r\n                d.setMonth(d.getMonth() - 6);\r\n                return d;\r\n            }\r\n            case 'year': {\r\n                const d = new Date(now);\r\n                d.setFullYear(d.getFullYear() - 1);\r\n                return d;\r\n            }\r\n        }\r\n    };\r\n\r\n    const reportData = useMemo(() => {\r\n        const startDate = getStartDate(period);\r\n        const items: ReportItem[] = [];\r\n\r\n        devices.forEach(device => {\r\n            if (device.checkHistory) {\r\n                device.checkHistory.forEach(check => {\r\n                    const checkDate = new Date(check.date);\r\n                    if (checkDate >= startDate) {\r\n                        const issues = [];\r\n                        if (!check.teclado) issues.push('Teclado');\r\n                        if (!check.mouse) issues.push('Mouse');\r\n                        if (!check.monitor) issues.push('Monitor');\r\n                        if (!check.cabos) issues.push('Cabos');\r\n                        if (!check.software) issues.push('Software');\r\n\r\n                        items.push({\r\n                            date: check.date,\r\n                            time: check.time,\r\n                            deviceName: device.name,\r\n                            labName: device.lab,\r\n                            userName: check.userName || 'Desconhecido',\r\n                            status: issues.length === 0 ? 'OK' : 'Problemas',\r\n                            issues\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n        });\r\n\r\n        return items.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\r\n    }, [devices, period]);\r\n\r\n    const handlePrint = () => {\r\n        window.print();\r\n    };\r\n\r\n    const formatDate = (dateStr: string) => {\r\n        const [year, month, day] = dateStr.split('-');\r\n        return `${day}/${month}/${year}`;\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 print:space-y-0 print:p-0\">\r\n            {/* Header - Hidden on Print */}\r\n            <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 print:hidden\">\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2\">\r\n                        <FileText className=\"w-6 h-6 text-indigo-600\" />\r\n                        Relatórios de Manutenção\r\n                    </h2>\r\n                    <p className=\"text-gray-500 dark:text-gray-400 mt-1\">\r\n                        Gere relatórios detalhados das verificações de laboratório.\r\n                    </p>\r\n                </div>\r\n                <button\r\n                    onClick={handlePrint}\r\n                    className=\"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 shadow-sm transition-colors\"\r\n                >\r\n                    <Printer className=\"w-4 h-4\" />\r\n                    Imprimir / Salvar PDF\r\n                </button>\r\n            </div>\r\n\r\n            {/* Filters - Hidden on Print */}\r\n            <div className=\"bg-white dark:bg-gray-800 p-4 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 print:hidden\">\r\n                <div className=\"flex items-center gap-2 mb-3 text-sm font-medium text-gray-700 dark:text-gray-300\">\r\n                    <Filter className=\"w-4 h-4\" />\r\n                    Filtrar por Período:\r\n                </div>\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                    {(['day', 'week', 'month', 'semester', 'year'] as Period[]).map((p) => (\r\n                        <button\r\n                            key={p}\r\n                            onClick={() => setPeriod(p)}\r\n                            className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${period === p\r\n                                ? 'bg-indigo-100 text-indigo-700 dark:bg-indigo-900/50 dark:text-indigo-300 border border-indigo-200 dark:border-indigo-800'\r\n                                : 'bg-gray-50 text-gray-600 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600'\r\n                                }`}\r\n                        >\r\n                            {p === 'day' && 'Hoje'}\r\n                            {p === 'week' && 'Última Semana'}\r\n                            {p === 'month' && 'Último Mês'}\r\n                            {p === 'semester' && 'Último Semestre'}\r\n                            {p === 'year' && 'Último Ano'}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Report Content - Visible on Print */}\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden print:shadow-none print:border-none\">\r\n                {/* Print Header */}\r\n                <div className=\"hidden print:block p-8 border-b border-gray-200\">\r\n                    <div className=\"flex justify-between items-center mb-6\">\r\n                        <h1 className=\"text-3xl font-bold text-gray-900\">Relatório de Verificações</h1>\r\n                        <div className=\"text-right\">\r\n                            <p className=\"text-sm text-gray-500\">Gerado em:</p>\r\n                            <p className=\"font-medium\">{new Date().toLocaleString()}</p>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex gap-8 text-sm text-gray-600\">\r\n                        <div>\r\n                            <span className=\"font-bold\">Período:</span> {\r\n                                period === 'day' ? 'Hoje' :\r\n                                    period === 'week' ? 'Última Semana' :\r\n                                        period === 'month' ? 'Último Mês' :\r\n                                            period === 'semester' ? 'Último Semestre' : 'Último Ano'\r\n                            }\r\n                        </div>\r\n                        <div>\r\n                            <span className=\"font-bold\">Total de Registros:</span> {reportData.length}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full text-left text-sm\">\r\n                        <thead className=\"bg-gray-50 dark:bg-gray-700/50 text-gray-700 dark:text-gray-300 font-medium border-b border-gray-200 dark:border-gray-700\">\r\n                            <tr>\r\n                                <th className=\"px-6 py-4\">Data/Hora</th>\r\n                                <th className=\"px-6 py-4\">Laboratório</th>\r\n                                <th className=\"px-6 py-4\">Equipamento</th>\r\n                                <th className=\"px-6 py-4\">Responsável</th>\r\n                                <th className=\"px-6 py-4\">Status</th>\r\n                                <th className=\"px-6 py-4\">Observações</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-gray-100 dark:divide-gray-700\">\r\n                            {reportData.length === 0 ? (\r\n                                <tr>\r\n                                    <td colSpan={6} className=\"px-6 py-8 text-center text-gray-500\">\r\n                                        Nenhum registro encontrado para este período.\r\n                                    </td>\r\n                                </tr>\r\n                            ) : (\r\n                                reportData.map((item, idx) => (\r\n                                    <tr key={idx} className=\"hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors\">\r\n                                        <td className=\"px-6 py-4 text-gray-600 dark:text-gray-400\">\r\n                                            {formatDate(item.date)} <span className=\"text-xs text-gray-400 ml-1\">{item.time}</span>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 font-medium text-gray-900 dark:text-white\">\r\n                                            {item.labName}\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 text-gray-600 dark:text-gray-400\">\r\n                                            {item.deviceName}\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4\">\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <div className=\"w-6 h-6 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center text-xs font-bold text-gray-600 dark:text-gray-300\">\r\n                                                    {item.userName.charAt(0)}\r\n                                                </div>\r\n                                                <span className=\"text-gray-700 dark:text-gray-300\">{item.userName}</span>\r\n                                            </div>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4\">\r\n                                            {item.status === 'OK' ? (\r\n                                                <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\">\r\n                                                    OK\r\n                                                </span>\r\n                                            ) : (\r\n                                                <div className=\"flex flex-col gap-1\">\r\n                                                    <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400 w-fit\">\r\n                                                        Problemas\r\n                                                    </span>\r\n                                                    <span className=\"text-xs text-red-600 dark:text-red-400\">\r\n                                                        {item.issues.join(', ')}\r\n                                                    </span>\r\n                                                </div>\r\n                                            )}\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 text-gray-500 dark:text-gray-400 max-w-xs truncate\">\r\n                                            -\r\n                                        </td>\r\n                                    </tr>\r\n                                ))\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n",
  "components/ScannerModal.tsx": "import React, { useEffect, useRef, useState } from 'react';\r\nimport { X, Camera, Search } from 'lucide-react';\r\nimport { Html5Qrcode } from 'html5-qrcode';\r\nimport { api } from '../services/api';\r\nimport { Device } from '../types';\r\n\r\ninterface ScannerModalProps {\r\n    onClose: () => void;\r\n    onScan: (deviceId: string) => void;\r\n}\r\n\r\nexport function ScannerModal({ onClose, onScan }: ScannerModalProps) {\r\n    const [error, setError] = useState<string>('');\r\n    const [manualId, setManualId] = useState('');\r\n    const [devices, setDevices] = useState<Device[]>([]);\r\n    const scannerRef = useRef<Html5Qrcode | null>(null);\r\n\r\n    useEffect(() => {\r\n        api.getDevices().then(setDevices).catch(console.error);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const startScanner = async () => {\r\n            try {\r\n                const html5QrCode = new Html5Qrcode(\"reader\");\r\n                scannerRef.current = html5QrCode;\r\n\r\n                const config = {\r\n                    fps: 10,\r\n                    qrbox: { width: 250, height: 250 }\r\n                };\r\n\r\n                const onSuccess = (decodedText: string) => {\r\n                    onScan(decodedText);\r\n                    html5QrCode.stop().catch(err => console.error(\"Failed to stop scanner\", err));\r\n                };\r\n\r\n                try {\r\n                    // Try environment camera first\r\n                    await html5QrCode.start({ facingMode: \"environment\" }, config, onSuccess, () => { });\r\n                } catch (envError) {\r\n                    console.warn(\"Environment camera failed, trying user camera...\", envError);\r\n                    try {\r\n                        // Fallback to user camera\r\n                        await html5QrCode.start({ facingMode: \"user\" }, config, onSuccess, () => { });\r\n                    } catch (userError: any) {\r\n                        console.error(\"All cameras failed:\", userError);\r\n                        setError(`Erro ao acessar câmera: ${userError?.message || 'Permissão negada ou dispositivo não encontrado'}`);\r\n                    }\r\n                }\r\n            } catch (err: any) {\r\n                console.error(\"Scanner init error:\", err);\r\n                setError(`Erro de inicialização: ${err?.message || 'Desconhecido'}`);\r\n            }\r\n        };\r\n\r\n        // Small delay to ensure DOM is ready\r\n        const timer = setTimeout(() => {\r\n            startScanner();\r\n        }, 100);\r\n\r\n        return () => {\r\n            clearTimeout(timer);\r\n            if (scannerRef.current && scannerRef.current.isScanning) {\r\n                scannerRef.current.stop().then(() => {\r\n                    scannerRef.current?.clear();\r\n                }).catch(err => console.error(\"Failed to stop scanner on cleanup\", err));\r\n            }\r\n        };\r\n    }, [onScan]);\r\n\r\n    const handleManualSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (manualId) {\r\n            onScan(manualId);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-90 z-50 flex flex-col items-center justify-center p-4\">\r\n            <div className=\"w-[95%] md:w-full max-w-md max-h-[90vh] overflow-y-auto bg-white dark:bg-gray-800 rounded-2xl overflow-hidden shadow-2xl relative\">\r\n                <button\r\n                    onClick={() => {\r\n                        if (scannerRef.current && scannerRef.current.isScanning) {\r\n                            scannerRef.current.stop().then(() => {\r\n                                scannerRef.current?.clear();\r\n                                onClose();\r\n                            }).catch(() => onClose());\r\n                        } else {\r\n                            onClose();\r\n                        }\r\n                    }}\r\n                    className=\"absolute top-4 right-4 z-10 p-2 bg-black/50 text-white rounded-full hover:bg-black/70\"\r\n                >\r\n                    <X className=\"w-6 h-6\" />\r\n                </button>\r\n\r\n                <div className=\"relative aspect-[3/4] bg-black flex items-center justify-center overflow-hidden\">\r\n                    {error ? (\r\n                        <div className=\"text-white text-center p-6\">\r\n                            <Camera className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\r\n                            <p>{error}</p>\r\n                        </div>\r\n                    ) : (\r\n                        <div id=\"reader\" className=\"w-full h-full\"></div>\r\n                    )}\r\n\r\n                    {/* Overlay is handled by html5-qrcode mostly, but we can keep a guide if needed. \r\n                        However, html5-qrcode renders its own video. \r\n                        We'll let it handle the video rendering in the #reader div.\r\n                    */}\r\n                </div>\r\n\r\n                <div className=\"p-6 bg-white dark:bg-gray-800\">\r\n                    <form onSubmit={handleManualSubmit} className=\"flex gap-2\">\r\n                        <div className=\"relative flex-1\">\r\n                            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\r\n                            <input\r\n                                type=\"text\"\r\n                                value={manualId}\r\n                                onChange={(e) => setManualId(e.target.value)}\r\n                                placeholder=\"Digitar código ou nome...\"\r\n                                className=\"w-full pl-9 pr-4 py-2 bg-gray-100 dark:bg-gray-700 border-none rounded-lg text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500\"\r\n                                list=\"device-list\"\r\n                            />\r\n                            <datalist id=\"device-list\">\r\n                                {devices.map(d => (\r\n                                    <option key={d.id} value={d.id}>{d.name} - {d.lab}</option>\r\n                                ))}\r\n                            </datalist>\r\n                        </div>\r\n                        <button\r\n                            type=\"submit\"\r\n                            className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700\"\r\n                        >\r\n                            Verificar\r\n                        </button>\r\n                    </form>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n",
  "components/SettingsLayout.tsx": "import React, { useState } from 'react';\r\nimport { Building2, Users, ChevronRight, LogOut, FileText } from 'lucide-react';\r\nimport { UserManagement } from './UserManagement';\r\nimport { StructureManagement } from './StructureManagement';\r\nimport { GroupManagement } from './GroupManagement';\r\nimport { Reports } from './Reports';\r\n\r\ninterface SettingsLayoutProps {\r\n    onLogout?: () => void;\r\n}\r\n\r\nexport function SettingsLayout({ onLogout }: SettingsLayoutProps) {\r\n    const [activeSection, setActiveSection] = useState<'structure' | 'users' | 'groups' | 'reports'>('structure');\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\r\n                <div className=\"flex space-x-1 bg-white dark:bg-gray-800 p-1 rounded-xl shadow-sm w-fit overflow-x-auto max-w-full\">\r\n                    <button\r\n                        onClick={() => setActiveSection('structure')}\r\n                        className={`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition whitespace-nowrap ${activeSection === 'structure'\r\n                            ? 'bg-indigo-50 text-indigo-600 dark:bg-indigo-900/30 dark:text-indigo-400'\r\n                            : 'text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700'\r\n                            }`}\r\n                    >\r\n                        <Building2 className=\"w-4 h-4\" />\r\n                        <span>Estrutura</span>\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setActiveSection('users')}\r\n                        className={`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition whitespace-nowrap ${activeSection === 'users'\r\n                            ? 'bg-indigo-50 text-indigo-600 dark:bg-indigo-900/30 dark:text-indigo-400'\r\n                            : 'text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700'\r\n                            }`}\r\n                    >\r\n                        <Users className=\"w-4 h-4\" />\r\n                        <span>Usuários</span>\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setActiveSection('groups')}\r\n                        className={`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition whitespace-nowrap ${activeSection === 'groups'\r\n                            ? 'bg-indigo-50 text-indigo-600 dark:bg-indigo-900/30 dark:text-indigo-400'\r\n                            : 'text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700'\r\n                            }`}\r\n                    >\r\n                        <Users className=\"w-4 h-4\" />\r\n                        <span>Grupos</span>\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setActiveSection('reports')}\r\n                        className={`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition whitespace-nowrap ${activeSection === 'reports'\r\n                            ? 'bg-indigo-50 text-indigo-600 dark:bg-indigo-900/30 dark:text-indigo-400'\r\n                            : 'text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700'\r\n                            }`}\r\n                    >\r\n                        <FileText className=\"w-4 h-4\" />\r\n                        <span>Relatórios</span>\r\n                    </button>\r\n                </div>\r\n\r\n                {onLogout && (\r\n                    <button\r\n                        onClick={onLogout}\r\n                        className=\"flex items-center space-x-2 px-4 py-2 bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 transition text-sm font-medium\"\r\n                    >\r\n                        <LogOut className=\"w-4 h-4\" />\r\n                        <span>Sair</span>\r\n                    </button>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6\">\r\n                {activeSection === 'structure' ? (\r\n                    <StructureManagement />\r\n                ) : activeSection === 'users' ? (\r\n                    <UserManagement />\r\n                ) : activeSection === 'groups' ? (\r\n                    <GroupManagement />\r\n                ) : (\r\n                    <Reports />\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n",
  "components/SignUpPage.tsx": "import React, { useState } from 'react';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { Monitor, Mail, Lock, User } from 'lucide-react';\r\n\r\ninterface SignUpPageProps {\r\n    onNavigateToLogin: () => void;\r\n}\r\n\r\nexport function SignUpPage({ onNavigateToLogin }: SignUpPageProps) {\r\n    const { register, isLoading } = useAuth();\r\n    const [name, setName] = useState('');\r\n    const [email, setEmail] = useState('');\r\n    const [password, setPassword] = useState('');\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!name || !email || !password) return;\r\n        await register(name, email, password);\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8\">\r\n            <div className=\"sm:mx-auto sm:w-full sm:max-w-md\">\r\n                <div className=\"flex justify-center text-indigo-600\">\r\n                    <Monitor className=\"w-12 h-12\" />\r\n                </div>\r\n                <h2 className=\"mt-6 text-center text-3xl font-extrabold text-gray-900\">\r\n                    Criar nova conta\r\n                </h2>\r\n                <p className=\"mt-2 text-center text-sm text-gray-600\">\r\n                    Gerencie seus laboratórios de forma inteligente\r\n                </p>\r\n            </div>\r\n\r\n            <div className=\"mt-8 sm:mx-auto sm:w-full sm:max-w-md\">\r\n                <div className=\"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10\">\r\n                    <form className=\"space-y-6\" onSubmit={handleSubmit}>\r\n                        <div>\r\n                            <label htmlFor=\"name\" className=\"block text-sm font-medium text-gray-700\">\r\n                                Nome Completo\r\n                            </label>\r\n                            <div className=\"mt-1 relative rounded-md shadow-sm\">\r\n                                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                                    <User className=\"h-5 w-5 text-gray-400\" />\r\n                                </div>\r\n                                <input\r\n                                    id=\"name\"\r\n                                    name=\"name\"\r\n                                    type=\"text\"\r\n                                    required\r\n                                    className=\"focus:ring-indigo-500 focus:border-indigo-500 block w-full pl-10 sm:text-sm border-gray-300 rounded-md py-2 border\"\r\n                                    placeholder=\"João Silva\"\r\n                                    value={name}\r\n                                    onChange={(e) => setName(e.target.value)}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700\">\r\n                                Email\r\n                            </label>\r\n                            <div className=\"mt-1 relative rounded-md shadow-sm\">\r\n                                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                                    <Mail className=\"h-5 w-5 text-gray-400\" />\r\n                                </div>\r\n                                <input\r\n                                    id=\"email\"\r\n                                    name=\"email\"\r\n                                    type=\"email\"\r\n                                    autoComplete=\"email\"\r\n                                    required\r\n                                    className=\"focus:ring-indigo-500 focus:border-indigo-500 block w-full pl-10 sm:text-sm border-gray-300 rounded-md py-2 border\"\r\n                                    placeholder=\"seu@email.com\"\r\n                                    value={email}\r\n                                    onChange={(e) => setEmail(e.target.value)}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-700\">\r\n                                Senha\r\n                            </label>\r\n                            <div className=\"mt-1 relative rounded-md shadow-sm\">\r\n                                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                                    <Lock className=\"h-5 w-5 text-gray-400\" />\r\n                                </div>\r\n                                <input\r\n                                    id=\"password\"\r\n                                    name=\"password\"\r\n                                    type=\"password\"\r\n                                    required\r\n                                    className=\"focus:ring-indigo-500 focus:border-indigo-500 block w-full pl-10 sm:text-sm border-gray-300 rounded-md py-2 border\"\r\n                                    placeholder=\"••••••••\"\r\n                                    value={password}\r\n                                    onChange={(e) => setPassword(e.target.value)}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <button\r\n                                type=\"submit\"\r\n                                disabled={isLoading}\r\n                                className=\"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                            >\r\n                                {isLoading ? 'Criando conta...' : 'Criar Conta'}\r\n                            </button>\r\n                        </div>\r\n                    </form>\r\n\r\n                    <div className=\"mt-6 text-center\">\r\n                        <p className=\"text-sm text-gray-600\">\r\n                            Já tem uma conta?{' '}\r\n                            <button\r\n                                onClick={onNavigateToLogin}\r\n                                className=\"font-medium text-indigo-600 hover:text-indigo-500\"\r\n                            >\r\n                                Fazer login\r\n                            </button>\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n",
  "components/StatCard.tsx": "import React from 'react';\r\nimport { LucideIcon } from 'lucide-react';\r\n\r\ninterface StatCardProps {\r\n  title: string;\r\n  value: number | string;\r\n  icon?: LucideIcon; // Icon is optional now as per design\r\n  color: string; // Tailwind class like 'bg-blue-50'\r\n  textColor: string; // Tailwind class like 'text-blue-600'\r\n}\r\n\r\nexport const StatCard: React.FC<StatCardProps> = ({ title, value, color, textColor }) => {\r\n  return (\r\n    <div className={`${color} rounded-xl p-6 flex flex-col justify-between h-32 transition-transform hover:scale-105`}>\r\n      <div>\r\n        <h3 className={`text-4xl font-bold ${textColor} mb-1`}>{value}</h3>\r\n        <p className=\"text-sm text-gray-600 font-medium\">{title}</p>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n",
  "components/StructureManagement.tsx": "import React, { useState, useEffect } from 'react';\r\nimport { api } from '../services/api';\r\nimport { Plus, Trash2, Edit2, ChevronRight, Building, MapPin, Monitor, Save, X, Laptop, AlertTriangle } from 'lucide-react';\r\nimport { Lab, DeviceStatus, Sede, Device } from '../types';\r\n\r\nexport function StructureManagement() {\r\n    const [sedes, setSedes] = useState<Sede[]>([]);\r\n    const [labs, setLabs] = useState<Lab[]>([]);\r\n    const [devices, setDevices] = useState<Device[]>([]);\r\n\r\n    const fetchData = async () => {\r\n        try {\r\n            const sedesData = await api.getSedes();\r\n            setSedes(sedesData);\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch sedes\", error);\r\n        }\r\n\r\n        try {\r\n            const labsData = await api.getLabs();\r\n            setLabs(labsData);\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch labs\", error);\r\n        }\r\n\r\n        try {\r\n            const devicesData = await api.getDevices();\r\n            setDevices(devicesData);\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch devices\", error);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchData();\r\n    }, []);\r\n\r\n    const [activeTab, setActiveTab] = useState<'sedes' | 'labs'>('sedes');\r\n\r\n    // Form State\r\n    const [newName, setNewName] = useState('');\r\n    const [selectedSedeId, setSelectedSedeId] = useState<number | ''>('');\r\n\r\n    // Editing State\r\n    const [editingLab, setEditingLab] = useState<Lab | null>(null);\r\n    const [editingSede, setEditingSede] = useState<Sede | null>(null);\r\n\r\n    // Device Management State\r\n    const [expandedLabId, setExpandedLabId] = useState<number | null>(null);\r\n    const [isAddingDevice, setIsAddingDevice] = useState(false);\r\n    const [newDevice, setNewDevice] = useState({\r\n        id: '',\r\n        brand: '',\r\n        model: '',\r\n        processor: '',\r\n        ram: '',\r\n        storage: '',\r\n        status: DeviceStatus.OPERATIONAL\r\n    });\r\n\r\n    const handleAdd = async () => {\r\n        if (!newName) return;\r\n\r\n        if (activeTab === 'sedes') {\r\n            await api.createSede({ name: newName });\r\n            setNewName('');\r\n            fetchData();\r\n        } else if (activeTab === 'labs') {\r\n            if (!selectedSedeId) {\r\n                alert('Selecione uma sede para o laboratório.');\r\n                return;\r\n            }\r\n            // Uniqueness Check\r\n            // We can check locally or rely on server error\r\n            const exists = labs.find(l => l.name === newName && l.sedeId === Number(selectedSedeId));\r\n\r\n            if (exists) {\r\n                alert('Já existe um laboratório com este nome nesta sede.');\r\n                return;\r\n            }\r\n\r\n            await api.createLab({ name: newName, sedeId: Number(selectedSedeId) });\r\n            setNewName('');\r\n            fetchData();\r\n        }\r\n    };\r\n\r\n    const handleUpdateLab = async () => {\r\n        if (!editingLab || !editingLab.id) return;\r\n        try {\r\n            const payload = {\r\n                name: editingLab.name,\r\n                sedeId: Number(editingLab.sedeId)\r\n            };\r\n            console.log(\"Updating lab with payload:\", payload);\r\n\r\n            await api.updateLab(editingLab.id, payload);\r\n            fetchData();\r\n            setEditingLab(null);\r\n        } catch (error: any) {\r\n            console.error(\"Failed to update lab\", error);\r\n            alert(`Erro ao atualizar laboratório: ${error.message || JSON.stringify(error)}`);\r\n        }\r\n    };\r\n\r\n    const handleUpdateSede = async () => {\r\n        if (!editingSede || !editingSede.id) return;\r\n        await api.updateSede(editingSede.id, { name: editingSede.name });\r\n        fetchData();\r\n        setEditingSede(null);\r\n    };\r\n\r\n    const handleDelete = async (id: number, type: 'sedes' | 'labs') => {\r\n        if (confirm('Tem certeza? Isso pode afetar itens dependentes.')) {\r\n            if (type === 'sedes') await api.deleteSede(id);\r\n            if (type === 'labs') await api.deleteLab(id);\r\n            fetchData();\r\n        }\r\n    };\r\n\r\n    const handleAddDevice = async (lab: Lab) => {\r\n        if (!newDevice.id || !newDevice.brand || !newDevice.model) {\r\n            alert(\"Preencha os campos obrigatórios.\");\r\n            return;\r\n        }\r\n\r\n        try {\r\n            // Check if updating or adding\r\n            const existing = devices.find(d => d.id === newDevice.id);\r\n\r\n            if (existing) {\r\n                // Update\r\n                // Note: If updating lab, we should pass labId if the backend supports it.\r\n                // For now, keeping existing behavior but passing labId if possible or just ignoring if updateDevice doesn't handle it yet.\r\n                await api.updateDevice(newDevice.id, {\r\n                    name: `${newDevice.brand} ${newDevice.model}`,\r\n                    brand: newDevice.brand,\r\n                    model: newDevice.model,\r\n                    processor: newDevice.processor,\r\n                    ram: newDevice.ram,\r\n                    storage: newDevice.storage,\r\n                    // lab: lab.name, // potentially deprecated in favor of labId\r\n                    status: newDevice.status,\r\n                    specs: `${newDevice.processor}, ${newDevice.ram}, ${newDevice.storage}`,\r\n                });\r\n            } else {\r\n                // Add\r\n                await api.addComputador({\r\n                    id: newDevice.id,\r\n                    brand: newDevice.brand,\r\n                    model: newDevice.model,\r\n                    processor: newDevice.processor,\r\n                    ram: newDevice.ram,\r\n                    storage: newDevice.storage,\r\n                    status: newDevice.status,\r\n                    labId: lab.id\r\n                });\r\n            }\r\n\r\n            fetchData();\r\n\r\n            setIsAddingDevice(false);\r\n            setNewDevice({\r\n                id: '',\r\n                brand: '',\r\n                model: '',\r\n                processor: '',\r\n                ram: '',\r\n                storage: '',\r\n                status: DeviceStatus.OPERATIONAL\r\n            });\r\n        } catch (error) {\r\n            console.error(error);\r\n            alert(\"Erro ao salvar dispositivo.\");\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <h2 className=\"text-xl font-bold text-gray-900 dark:text-white\">Estrutura Organizacional</h2>\r\n            </div>\r\n\r\n            <div className=\"flex border-b border-gray-200 dark:border-gray-700\">\r\n                <button\r\n                    onClick={() => setActiveTab('sedes')}\r\n                    className={`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${activeTab === 'sedes' ? 'border-indigo-600 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700'\r\n                        }`}\r\n                >\r\n                    Sedes\r\n                </button>\r\n                <button\r\n                    onClick={() => setActiveTab('labs')}\r\n                    className={`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${activeTab === 'labs' ? 'border-indigo-600 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700'\r\n                        }`}\r\n                >\r\n                    Laboratórios\r\n                </button>\r\n            </div>\r\n\r\n            <div className=\"space-y-4\">\r\n                {/* Add Form */}\r\n                <div className=\"flex gap-4 items-end bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg\">\r\n                    <div className=\"flex-1\">\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Nome</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={newName}\r\n                            onChange={(e) => setNewName(e.target.value)}\r\n                            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                            placeholder={`Nome da ${activeTab === 'sedes' ? 'Sede' : 'Laboratório'}`}\r\n                        />\r\n                    </div>\r\n\r\n                    {activeTab === 'labs' && (\r\n                        <div className=\"w-64\">\r\n                            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                Sede\r\n                            </label>\r\n                            <select\r\n                                value={selectedSedeId}\r\n                                onChange={(e) => setSelectedSedeId(Number(e.target.value))}\r\n                                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                            >\r\n                                <option value=\"\">Selecione...</option>\r\n                                {sedes.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}\r\n                            </select>\r\n                        </div>\r\n                    )}\r\n\r\n                    <button\r\n                        onClick={handleAdd}\r\n                        className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center gap-2\"\r\n                    >\r\n                        <Plus className=\"w-4 h-4\" />\r\n                        Adicionar\r\n                    </button>\r\n                </div>\r\n\r\n                {/* List */}\r\n                <div className=\"space-y-2\">\r\n                    {activeTab === 'sedes' && sedes.map(item => {\r\n                        const labCount = labs.filter(l => l.sedeId === item.id).length;\r\n                        return (\r\n                            <div key={item.id} className=\"flex items-center justify-between p-3 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg\">\r\n                                {editingSede?.id === item.id ? (\r\n                                    <div className=\"flex gap-2 flex-1\">\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={editingSede.name}\r\n                                            onChange={(e) => setEditingSede({ ...editingSede, name: e.target.value })}\r\n                                            className=\"flex-1 px-3 py-1 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                                        />\r\n                                        <button onClick={handleUpdateSede} className=\"p-1 text-green-600 hover:bg-green-50 rounded\"><Save className=\"w-4 h-4\" /></button>\r\n                                        <button onClick={() => setEditingSede(null)} className=\"p-1 text-gray-600 hover:bg-gray-50 rounded\"><X className=\"w-4 h-4\" /></button>\r\n                                    </div>\r\n                                ) : (\r\n                                    <>\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <Building className=\"w-5 h-5 text-gray-400\" />\r\n                                            <div>\r\n                                                <span className=\"font-medium text-gray-900 dark:text-white block\">{item.name}</span>\r\n                                                <span className=\"text-xs text-gray-500\">{labCount} laboratórios</span>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <button\r\n                                                onClick={() => {\r\n                                                    setSelectedSedeId(item.id!);\r\n                                                    setActiveTab('labs');\r\n                                                }}\r\n                                                className=\"p-1.5 text-indigo-600 hover:bg-indigo-50 rounded text-xs font-medium flex items-center gap-1\"\r\n                                                title=\"Adicionar Laboratório nesta Sede\"\r\n                                            >\r\n                                                <Plus className=\"w-3 h-3\" /> Lab\r\n                                            </button>\r\n                                            <button onClick={() => setEditingSede(item)} className=\"text-indigo-500 hover:text-indigo-700 p-1\">\r\n                                                <Edit2 className=\"w-4 h-4\" />\r\n                                            </button>\r\n                                            <button onClick={() => item.id && handleDelete(item.id, 'sedes')} className=\"text-red-500 hover:text-red-700 p-1\">\r\n                                                <Trash2 className=\"w-4 h-4\" />\r\n                                            </button>\r\n                                        </div>\r\n                                    </>\r\n                                )}\r\n                            </div>\r\n                        );\r\n                    })}\r\n\r\n                    {activeTab === 'labs' && labs\r\n                        .filter(l => !selectedSedeId || l.sedeId === Number(selectedSedeId))\r\n                        .map(item => {\r\n                            const labDevices = devices.filter(d => d.lab === item.name);\r\n                            const isExpanded = expandedLabId === item.id;\r\n\r\n                            return (\r\n                                <div key={item.id} className=\"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden\">\r\n                                    <div className=\"p-3\">\r\n                                        {editingLab?.id === item.id ? (\r\n                                            <div className=\"flex gap-4 items-end\">\r\n                                                <div className=\"flex-1\">\r\n                                                    <input\r\n                                                        type=\"text\"\r\n                                                        value={editingLab.name}\r\n                                                        onChange={(e) => setEditingLab({ ...editingLab, name: e.target.value })}\r\n                                                        className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                                                    />\r\n                                                </div>\r\n                                                <div className=\"w-64\">\r\n                                                    <select\r\n                                                        value={editingLab.sedeId || ''}\r\n                                                        onChange={(e) => setEditingLab({ ...editingLab, sedeId: Number(e.target.value) })}\r\n                                                        className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                                                    >\r\n                                                        <option value=\"\">Selecione...</option>\r\n                                                        {sedes.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}\r\n                                                    </select>\r\n                                                </div>\r\n                                                <button onClick={handleUpdateLab} className=\"p-2 bg-green-100 text-green-600 rounded-lg hover:bg-green-200\">\r\n                                                    <Save className=\"w-4 h-4\" />\r\n                                                </button>\r\n                                                <button onClick={() => setEditingLab(null)} className=\"p-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200\">\r\n                                                    <X className=\"w-4 h-4\" />\r\n                                                </button>\r\n                                            </div>\r\n                                        ) : (\r\n                                            <div className=\"flex items-center justify-between\">\r\n                                                <div\r\n                                                    className=\"flex items-center gap-3 cursor-pointer flex-1\"\r\n                                                    onClick={() => setExpandedLabId(isExpanded ? null : item.id!)}\r\n                                                >\r\n                                                    <ChevronRight className={`w-5 h-5 text-gray-400 transition-transform ${isExpanded ? 'rotate-90' : ''}`} />\r\n                                                    <Monitor className=\"w-5 h-5 text-gray-400\" />\r\n                                                    <div>\r\n                                                        <span className=\"font-medium text-gray-900 dark:text-white block\">{item.name}</span>\r\n                                                        <div className=\"flex items-center gap-1 text-sm text-gray-600 dark:text-gray-300 mt-1\">\r\n                                                            <Building className=\"w-3 h-3\" />\r\n                                                            {item.sedeId !== undefined && item.sedeId !== null ? (\r\n                                                                <span className=\"font-medium\">\r\n                                                                    {sedes.find(s => Number(s.id) === Number(item.sedeId))?.name || `Sede não encontrada (ID: ${item.sedeId})`}\r\n                                                                </span>\r\n                                                            ) : (\r\n                                                                <span className=\"text-yellow-600 dark:text-yellow-400 flex items-center gap-1\">\r\n                                                                    <AlertTriangle className=\"w-3 h-3\" /> Sede não definida\r\n                                                                </span>\r\n                                                            )}\r\n                                                            <span className=\"text-gray-400 mx-1\">•</span>\r\n                                                            <span>{labDevices.length} dispositivos</span>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                                <div className=\"flex gap-2\">\r\n                                                    <button onClick={() => setEditingLab(item)} className=\"text-indigo-500 hover:text-indigo-700\">\r\n                                                        <Edit2 className=\"w-4 h-4\" />\r\n                                                    </button>\r\n                                                    <button onClick={() => item.id && handleDelete(item.id, 'labs')} className=\"text-red-500 hover:text-red-700\">\r\n                                                        <Trash2 className=\"w-4 h-4\" />\r\n                                                    </button>\r\n                                                </div>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n\r\n                                    {isExpanded && (\r\n                                        <div className=\"border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 p-4\">\r\n                                            <div className=\"flex justify-between items-center mb-4\">\r\n                                                <h4 className=\"text-sm font-bold text-gray-700 dark:text-gray-300\">Dispositivos no Laboratório</h4>\r\n                                                <button\r\n                                                    onClick={() => setIsAddingDevice(true)}\r\n                                                    className=\"text-xs bg-indigo-600 text-white px-3 py-1.5 rounded-lg hover:bg-indigo-700 flex items-center gap-1\"\r\n                                                >\r\n                                                    <Plus className=\"w-3 h-3\" />\r\n                                                    Adicionar Computador\r\n                                                </button>\r\n                                            </div>\r\n\r\n                                            {isAddingDevice && (\r\n                                                <div className=\"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 mb-4\">\r\n                                                    <h5 className=\"text-sm font-bold mb-3 text-gray-900 dark:text-white\">Novo Dispositivo</h5>\r\n                                                    <div className=\"grid grid-cols-2 gap-3 mb-3\">\r\n                                                        <input\r\n                                                            placeholder=\"Patrimônio (ID)\"\r\n                                                            className=\"px-3 py-2 border rounded-lg text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\r\n                                                            value={newDevice.id}\r\n                                                            onChange={e => setNewDevice({ ...newDevice, id: e.target.value })}\r\n                                                        />\r\n                                                        <input\r\n                                                            placeholder=\"Marca\"\r\n                                                            className=\"px-3 py-2 border rounded-lg text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\r\n                                                            value={newDevice.brand}\r\n                                                            onChange={e => setNewDevice({ ...newDevice, brand: e.target.value })}\r\n                                                        />\r\n                                                        <input\r\n                                                            placeholder=\"Modelo\"\r\n                                                            className=\"px-3 py-2 border rounded-lg text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\r\n                                                            value={newDevice.model}\r\n                                                            onChange={e => setNewDevice({ ...newDevice, model: e.target.value })}\r\n                                                        />\r\n                                                        <input\r\n                                                            placeholder=\"Processador\"\r\n                                                            className=\"px-3 py-2 border rounded-lg text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\r\n                                                            value={newDevice.processor}\r\n                                                            onChange={e => setNewDevice({ ...newDevice, processor: e.target.value })}\r\n                                                        />\r\n                                                        <input\r\n                                                            placeholder=\"RAM\"\r\n                                                            className=\"px-3 py-2 border rounded-lg text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\r\n                                                            value={newDevice.ram}\r\n                                                            onChange={e => setNewDevice({ ...newDevice, ram: e.target.value })}\r\n                                                        />\r\n                                                        <input\r\n                                                            placeholder=\"Armazenamento\"\r\n                                                            className=\"px-3 py-2 border rounded-lg text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\r\n                                                            value={newDevice.storage}\r\n                                                            onChange={e => setNewDevice({ ...newDevice, storage: e.target.value })}\r\n                                                        />\r\n                                                    </div>\r\n                                                    <div className=\"flex justify-end gap-2\">\r\n                                                        <button\r\n                                                            onClick={() => setIsAddingDevice(false)}\r\n                                                            className=\"px-3 py-1.5 text-gray-600 text-sm hover:bg-gray-100 rounded-lg\"\r\n                                                        >\r\n                                                            Cancelar\r\n                                                        </button>\r\n                                                        <button\r\n                                                            onClick={() => handleAddDevice(item)}\r\n                                                            className=\"px-3 py-1.5 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700\"\r\n                                                        >\r\n                                                            Salvar\r\n                                                        </button>\r\n                                                    </div>\r\n                                                </div>\r\n                                            )}\r\n\r\n                                            <div className=\"space-y-2\">\r\n                                                {labDevices.length === 0 ? (\r\n                                                    <p className=\"text-sm text-gray-500 italic\">Nenhum dispositivo neste laboratório.</p>\r\n                                                ) : (\r\n                                                    labDevices.map(device => (\r\n                                                        <div key={device.id} className=\"flex items-center justify-between p-2 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700\">\r\n                                                            <div className=\"flex items-center gap-3\">\r\n                                                                <Laptop className=\"w-4 h-4 text-gray-400\" />\r\n                                                                <div>\r\n                                                                    <p className=\"text-sm font-medium text-gray-900 dark:text-white\">{device.name}</p>\r\n                                                                    <p className=\"text-xs text-gray-500\">ID: {device.id} • {device.status}</p>\r\n                                                                </div>\r\n                                                            </div>\r\n                                                            <div className=\"flex gap-2\">\r\n                                                                <button\r\n                                                                    onClick={() => {\r\n                                                                        setNewDevice({\r\n                                                                            id: device.id,\r\n                                                                            brand: device.brand,\r\n                                                                            model: device.model,\r\n                                                                            processor: device.processor,\r\n                                                                            ram: device.ram,\r\n                                                                            storage: device.storage,\r\n                                                                            status: device.status\r\n                                                                        });\r\n                                                                        setIsAddingDevice(true);\r\n                                                                        // We need a way to know we are editing, maybe add a state or just use the ID existence check in handleAdd (but handleAdd checks for duplicates).\r\n                                                                        // Ideally we should have a separate handleUpdate or modify handleAdd.\r\n                                                                        // For simplicity in this iteration, I'll delete and re-add if ID matches, OR better, update handleAdd to support updates.\r\n                                                                        // Actually, let's just use the form to populate and let the user \"Save\" which currently adds.\r\n                                                                        // I will modify handleAddDevice to check if it exists and update if so, or add a specific update mode.\r\n                                                                        // Let's add a state `isEditingDevice` to track this.\r\n                                                                    }}\r\n                                                                    className=\"text-indigo-500 hover:text-indigo-700\"\r\n                                                                >\r\n                                                                    <Edit2 className=\"w-3 h-3\" />\r\n                                                                </button>\r\n                                                                <button\r\n                                                                    onClick={async () => {\r\n                                                                        if (confirm('Tem certeza que deseja excluir este dispositivo?')) {\r\n                                                                            await api.deleteDevice(device.id);\r\n                                                                            fetchData();\r\n                                                                        }\r\n                                                                    }}\r\n                                                                    className=\"text-red-500 hover:text-red-700\"\r\n                                                                >\r\n                                                                    <Trash2 className=\"w-3 h-3\" />\r\n                                                                </button>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    ))\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            );\r\n                        })}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n",
  "components/TaskManagement.tsx": "import React, { useState, useEffect } from 'react';\r\nimport { api } from '../services/api';\r\nimport { Task, User, Sede, Lab, Device } from '../types';\r\nimport { Plus, Trash2, CheckSquare, Square, User as UserIcon, Clock, CheckCircle, AlertCircle } from 'lucide-react';\r\n\r\nexport function TaskManagement() {\r\n    const [tasks, setTasks] = useState<Task[]>([]);\r\n    const [users, setUsers] = useState<User[]>([]);\r\n    const [sedes, setSedes] = useState<Sede[]>([]);\r\n    const [labs, setLabs] = useState<Lab[]>([]);\r\n    const [devices, setDevices] = useState<Device[]>([]);\r\n\r\n    const fetchData = async () => {\r\n        try {\r\n            const [tasksData, usersData, sedesData, labsData, devicesData] = await Promise.all([\r\n                api.getTasks(),\r\n                api.getUsers(),\r\n                api.getSedes(),\r\n                api.getLabs(),\r\n                api.getDevices()\r\n            ]);\r\n            setTasks(tasksData);\r\n            setUsers(usersData);\r\n            setSedes(sedesData);\r\n            setLabs(labsData);\r\n            setDevices(devicesData);\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch data\", error);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchData();\r\n    }, []);\r\n\r\n    const [showNewTaskForm, setShowNewTaskForm] = useState(false);\r\n    const [newTaskTitle, setNewTaskTitle] = useState('');\r\n\r\n    // Scoping State\r\n    const [scopeType, setScopeType] = useState<'none' | 'sede' | 'lab' | 'device'>('none');\r\n    const [selectedScopeId, setSelectedScopeId] = useState('');\r\n\r\n    const handleCreateTask = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!newTaskTitle.trim()) return;\r\n\r\n        let descriptionSuffix = '';\r\n        if (scopeType !== 'none' && selectedScopeId) {\r\n            if (scopeType === 'sede') {\r\n                const sede = sedes.find(s => s.id?.toString() === selectedScopeId);\r\n                descriptionSuffix = `\\n\\n[Escopo: Sede - ${sede?.name}]`;\r\n            } else if (scopeType === 'lab') {\r\n                const lab = labs.find(l => l.id?.toString() === selectedScopeId);\r\n                descriptionSuffix = `\\n\\n[Escopo: Laboratório - ${lab?.name}]`;\r\n            } else if (scopeType === 'device') {\r\n                const device = devices.find(d => d.id === selectedScopeId);\r\n                descriptionSuffix = `\\n\\n[Escopo: Equipamento - ${device?.name} (${device?.id})]`;\r\n            }\r\n        }\r\n\r\n        await api.createTask({\r\n            title: newTaskTitle,\r\n            description: descriptionSuffix.trim(),\r\n            status: 'pending',\r\n            createdAt: new Date().toISOString(),\r\n            updatedAt: new Date().toISOString(),\r\n            checklist: []\r\n        });\r\n        fetchData();\r\n\r\n        setNewTaskTitle('');\r\n        setScopeType('none');\r\n        setSelectedScopeId('');\r\n        setShowNewTaskForm(false);\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex justify-between items-center\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-bold text-gray-900 dark:text-white\">Gerenciamento de Tarefas</h2>\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400\">Crie e gerencie tarefas e checklists para a equipe.</p>\r\n                </div>\r\n                <button\r\n                    onClick={() => setShowNewTaskForm(true)}\r\n                    className=\"flex items-center space-x-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition text-sm font-medium shadow-sm\"\r\n                >\r\n                    <Plus className=\"w-4 h-4\" />\r\n                    <span>Nova Tarefa</span>\r\n                </button>\r\n            </div>\r\n\r\n            {showNewTaskForm && (\r\n                <div className=\"bg-white dark:bg-gray-800 p-4 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 animate-in fade-in slide-in-from-top-2\">\r\n                    <form onSubmit={handleCreateTask} className=\"space-y-4\">\r\n                        <div className=\"flex gap-2\">\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"Título da nova tarefa...\"\r\n                                className=\"flex-1 px-4 py-2 bg-gray-50 dark:bg-gray-700 border-none rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none text-gray-900 dark:text-white\"\r\n                                value={newTaskTitle}\r\n                                onChange={(e) => setNewTaskTitle(e.target.value)}\r\n                                autoFocus\r\n                            />\r\n                        </div>\r\n\r\n                        {/* Scope Selection */}\r\n                        <div className=\"flex flex-wrap gap-4 items-center p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg\">\r\n                            <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Vincular a:</span>\r\n                            <div className=\"flex gap-2\">\r\n                                <label className=\"flex items-center gap-1 cursor-pointer\">\r\n                                    <input type=\"radio\" name=\"scope\" checked={scopeType === 'none'} onChange={() => setScopeType('none')} />\r\n                                    <span className=\"text-sm\">Geral</span>\r\n                                </label>\r\n                                <label className=\"flex items-center gap-1 cursor-pointer\">\r\n                                    <input type=\"radio\" name=\"scope\" checked={scopeType === 'sede'} onChange={() => setScopeType('sede')} />\r\n                                    <span className=\"text-sm\">Sede</span>\r\n                                </label>\r\n                                <label className=\"flex items-center gap-1 cursor-pointer\">\r\n                                    <input type=\"radio\" name=\"scope\" checked={scopeType === 'lab'} onChange={() => setScopeType('lab')} />\r\n                                    <span className=\"text-sm\">Laboratório</span>\r\n                                </label>\r\n                                <label className=\"flex items-center gap-1 cursor-pointer\">\r\n                                    <input type=\"radio\" name=\"scope\" checked={scopeType === 'device'} onChange={() => setScopeType('device')} />\r\n                                    <span className=\"text-sm\">Equipamento</span>\r\n                                </label>\r\n                            </div>\r\n\r\n                            {scopeType !== 'none' && (\r\n                                <select\r\n                                    className=\"px-3 py-1.5 rounded-lg border-none text-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500\"\r\n                                    value={selectedScopeId}\r\n                                    onChange={(e) => setSelectedScopeId(e.target.value)}\r\n                                    required\r\n                                >\r\n                                    <option value=\"\">Selecione...</option>\r\n                                    {scopeType === 'sede' && sedes.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}\r\n                                    {scopeType === 'lab' && labs.map(l => <option key={l.id} value={l.id}>{l.name}</option>)}\r\n                                    {scopeType === 'device' && devices.map(d => <option key={d.id} value={d.id}>{d.name} ({d.id})</option>)}\r\n                                </select>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"flex justify-end gap-2\">\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={() => setShowNewTaskForm(false)}\r\n                                className=\"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 font-medium text-sm\"\r\n                            >\r\n                                Cancelar\r\n                            </button>\r\n                            <button\r\n                                type=\"submit\"\r\n                                className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium text-sm\"\r\n                            >\r\n                                Criar\r\n                            </button>\r\n                        </div>\r\n                    </form>\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                {tasks.map(task => (\r\n                    <TaskCard key={task.id} task={task} users={users} onUpdate={fetchData} />\r\n                ))}\r\n            </div>\r\n\r\n            {tasks.length === 0 && !showNewTaskForm && (\r\n                <div className=\"text-center py-12 bg-white dark:bg-gray-800 rounded-2xl border border-dashed border-gray-300 dark:border-gray-700\">\r\n                    <CheckSquare className=\"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3\" />\r\n                    <p className=\"text-gray-500 dark:text-gray-400\">Nenhuma tarefa criada ainda.</p>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction TaskCard({ task, users, onUpdate }: { task: Task, users: any[], onUpdate: () => void }) {\r\n    // Local state for immediate UI updates, debounced save to DB\r\n    const [localTask, setLocalTask] = useState(task);\r\n    const [newChecklistItem, setNewChecklistItem] = useState('');\r\n\r\n    // Update local state when prop changes (e.g. from other updates)\r\n    useEffect(() => {\r\n        setLocalTask(task);\r\n    }, [task]);\r\n\r\n    // Autosave effect\r\n    useEffect(() => {\r\n        const timer = setTimeout(async () => {\r\n            if (JSON.stringify(task) !== JSON.stringify(localTask)) {\r\n                await api.updateTask(task.id!, {\r\n                    ...localTask,\r\n                    updatedAt: new Date().toISOString()\r\n                });\r\n                onUpdate();\r\n            }\r\n        }, 1000); // 1 second debounce\r\n\r\n        return () => clearTimeout(timer);\r\n    }, [localTask, task, onUpdate]);\r\n\r\n    const updateField = (field: keyof Task, value: any) => {\r\n        setLocalTask(prev => ({ ...prev, [field]: value }));\r\n    };\r\n\r\n    const addChecklistItem = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!newChecklistItem.trim()) return;\r\n\r\n        const newItem = {\r\n            id: Math.random().toString(36).substr(2, 9),\r\n            text: newChecklistItem,\r\n            completed: false\r\n        };\r\n\r\n        const updatedChecklist = [...(localTask.checklist || []), newItem];\r\n        updateField('checklist', updatedChecklist);\r\n        setNewChecklistItem('');\r\n    };\r\n\r\n    const toggleChecklistItem = (itemId: string) => {\r\n        const updatedChecklist = (localTask.checklist || []).map(item =>\r\n            item.id === itemId ? { ...item, completed: !item.completed } : item\r\n        );\r\n        updateField('checklist', updatedChecklist);\r\n    };\r\n\r\n    const deleteChecklistItem = (itemId: string) => {\r\n        const updatedChecklist = (localTask.checklist || []).filter(item => item.id !== itemId);\r\n        updateField('checklist', updatedChecklist);\r\n    };\r\n\r\n    const handleDeleteTask = async () => {\r\n        if (confirm('Tem certeza que deseja excluir esta tarefa?')) {\r\n            await api.deleteTask(task.id!);\r\n            onUpdate();\r\n        }\r\n    };\r\n\r\n    const getStatusColor = (status: string) => {\r\n        switch (status) {\r\n            case 'done': return 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400';\r\n            case 'in_progress': return 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400';\r\n            default: return 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col h-full transition-all hover:shadow-md\">\r\n            <div className=\"p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-start gap-3\">\r\n                <div className=\"flex-1\">\r\n                    <input\r\n                        type=\"text\"\r\n                        value={localTask.title}\r\n                        onChange={(e) => updateField('title', e.target.value)}\r\n                        className=\"w-full font-bold text-gray-900 dark:text-white bg-transparent border-none focus:ring-0 p-0 placeholder-gray-400\"\r\n                        placeholder=\"Título da tarefa\"\r\n                    />\r\n                </div>\r\n                <button\r\n                    onClick={handleDeleteTask}\r\n                    className=\"text-gray-400 hover:text-red-500 transition-colors\"\r\n                >\r\n                    <Trash2 className=\"w-4 h-4\" />\r\n                </button>\r\n            </div>\r\n\r\n            <div className=\"p-4 flex-1 space-y-4\">\r\n                {/* Description */}\r\n                <div>\r\n                    <label className=\"text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1 block\">Descrição</label>\r\n                    <textarea\r\n                        value={localTask.description}\r\n                        onChange={(e) => updateField('description', e.target.value)}\r\n                        className=\"w-full text-sm text-gray-600 dark:text-gray-300 bg-gray-50 dark:bg-gray-900/50 rounded-lg p-2 border-none focus:ring-1 focus:ring-indigo-500 resize-none h-20\"\r\n                        placeholder=\"O que precisa ser feito...\"\r\n                    />\r\n                </div>\r\n\r\n                {/* Status & Assignee */}\r\n                <div className=\"grid grid-cols-2 gap-3\">\r\n                    <div>\r\n                        <label className=\"text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1 block\">Status</label>\r\n                        <select\r\n                            value={localTask.status}\r\n                            onChange={(e) => updateField('status', e.target.value)}\r\n                            className={`w-full text-xs font-medium rounded-lg p-2 border-none focus:ring-1 focus:ring-indigo-500 cursor-pointer ${getStatusColor(localTask.status)}`}\r\n                        >\r\n                            <option value=\"pending\">Pendente</option>\r\n                            <option value=\"in_progress\">Em Progresso</option>\r\n                            <option value=\"done\">Concluído</option>\r\n                        </select>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1 block\">Responsável</label>\r\n                        <div className=\"relative\">\r\n                            <select\r\n                                value={localTask.assignedTo || ''}\r\n                                onChange={(e) => {\r\n                                    const userId = e.target.value;\r\n                                    const user = users.find(u => u.id?.toString() === userId);\r\n                                    setLocalTask(prev => ({\r\n                                        ...prev,\r\n                                        assignedTo: userId,\r\n                                        assignedName: user?.name\r\n                                    }));\r\n                                }}\r\n                                className=\"w-full text-xs text-gray-700 dark:text-gray-200 bg-gray-50 dark:bg-gray-700 rounded-lg p-2 border-none focus:ring-1 focus:ring-indigo-500 cursor-pointer appearance-none\"\r\n                            >\r\n                                <option value=\"\">Ninguém</option>\r\n                                {users.map(user => (\r\n                                    <option key={user.id} value={user.id}>{user.name}</option>\r\n                                ))}\r\n                            </select>\r\n                            <UserIcon className=\"absolute right-2 top-1/2 transform -translate-y-1/2 w-3 h-3 text-gray-400 pointer-events-none\" />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Checklist */}\r\n                <div>\r\n                    <div className=\"flex justify-between items-center mb-2\">\r\n                        <label className=\"text-xs font-semibold text-gray-400 uppercase tracking-wider\">Checklist</label>\r\n                        <span className=\"text-xs text-gray-400\">\r\n                            {(localTask.checklist || []).filter(i => i.completed).length}/{(localTask.checklist || []).length}\r\n                        </span>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2 mb-3\">\r\n                        {(localTask.checklist || []).map(item => (\r\n                            <div key={item.id} className=\"flex items-center gap-2 group\">\r\n                                <button\r\n                                    onClick={() => toggleChecklistItem(item.id)}\r\n                                    className={`flex-shrink-0 ${item.completed ? 'text-green-500' : 'text-gray-300 hover:text-gray-400'}`}\r\n                                >\r\n                                    {item.completed ? <CheckSquare className=\"w-4 h-4\" /> : <Square className=\"w-4 h-4\" />}\r\n                                </button>\r\n                                <span className={`flex-1 text-sm ${item.completed ? 'text-gray-400 line-through' : 'text-gray-700 dark:text-gray-200'}`}>\r\n                                    {item.text}\r\n                                </span>\r\n                                <button\r\n                                    onClick={() => deleteChecklistItem(item.id)}\r\n                                    className=\"text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                                >\r\n                                    <Trash2 className=\"w-3 h-3\" />\r\n                                </button>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n\r\n                    <form onSubmit={addChecklistItem} className=\"flex gap-2\">\r\n                        <input\r\n                            type=\"text\"\r\n                            value={newChecklistItem}\r\n                            onChange={(e) => setNewChecklistItem(e.target.value)}\r\n                            placeholder=\"Adicionar item...\"\r\n                            className=\"flex-1 text-sm bg-transparent border-b border-gray-200 dark:border-gray-700 focus:border-indigo-500 outline-none py-1 text-gray-700 dark:text-gray-200 placeholder-gray-400\"\r\n                        />\r\n                        <button\r\n                            type=\"submit\"\r\n                            disabled={!newChecklistItem.trim()}\r\n                            className=\"text-indigo-600 dark:text-indigo-400 disabled:opacity-50 text-xs font-medium\"\r\n                        >\r\n                            Adicionar\r\n                        </button>\r\n                    </form>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"p-3 bg-gray-50 dark:bg-gray-900/30 border-t border-gray-100 dark:border-gray-700 text-xs text-gray-400 flex justify-between items-center rounded-b-xl\">\r\n                <span>Criado em {new Date(localTask.createdAt).toLocaleDateString()}</span>\r\n                {localTask.assignedName && (\r\n                    <span className=\"flex items-center gap-1\">\r\n                        <UserIcon className=\"w-3 h-3\" />\r\n                        {localTask.assignedName}\r\n                    </span>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n",
  "components/UserManagement.tsx": "import React, { useState, useEffect } from 'react';\r\nimport { api } from '../services/api';\r\nimport { User } from '../types';\r\nimport { Trash2, Plus, Shield, ShieldAlert, Lock, Ban, CheckCircle, KeyRound } from 'lucide-react';\r\n\r\nexport function UserManagement() {\r\n    const [users, setUsers] = useState<User[]>([]);\r\n    const fetchData = async () => {\r\n        try {\r\n            const usersData = await api.getUsers();\r\n            setUsers(usersData);\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch users\", error);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchData();\r\n    }, []);\r\n\r\n    const [isAdding, setIsAdding] = useState(false);\r\n    const [newUser, setNewUser] = useState({\r\n        name: '',\r\n        email: '',\r\n        password: '',\r\n        role: 'user' as 'admin' | 'user',\r\n        forceChangePassword: true\r\n    });\r\n\r\n    const [resetPasswordId, setResetPasswordId] = useState<number | null>(null);\r\n    const [newPassword, setNewPassword] = useState('');\r\n\r\n    const handleAddUser = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!newUser.name || !newUser.email || !newUser.password) {\r\n            alert(\"Por favor, preencha todos os campos obrigatórios (Nome, Email, Senha).\");\r\n            return;\r\n        }\r\n\r\n        try {\r\n            await api.createUser({\r\n                name: newUser.name,\r\n                email: newUser.email,\r\n                password: newUser.password,\r\n                role: newUser.role,\r\n                forceChangePassword: newUser.forceChangePassword,\r\n                isBlocked: false,\r\n                avatar: `https://ui-avatars.com/api/?name=${newUser.name}&background=random`\r\n            });\r\n            setIsAdding(false);\r\n            setNewUser({ name: '', email: '', password: '', role: 'user', forceChangePassword: true });\r\n            fetchData();\r\n        } catch (error: any) {\r\n            console.error(\"Error creating user:\", error);\r\n            alert(`Erro ao criar usuário: ${error.message || 'O email pode já estar em uso.'}`);\r\n        }\r\n    };\r\n\r\n    const handleDeleteUser = async (id: number) => {\r\n        if (confirm('Tem certeza que deseja excluir este usuário?')) {\r\n            await api.deleteUser(id);\r\n            fetchData();\r\n        }\r\n    };\r\n\r\n    const toggleBlockUser = async (user: any) => {\r\n        await api.updateUser(user.id, { isBlocked: !user.isBlocked });\r\n        fetchData();\r\n    };\r\n\r\n    const handleResetPassword = async () => {\r\n        if (resetPasswordId && newPassword) {\r\n            await api.updateUser(resetPasswordId, {\r\n                password: newPassword,\r\n                forceChangePassword: true\r\n            });\r\n            setResetPasswordId(null);\r\n            setNewPassword('');\r\n            alert('Senha redefinida com sucesso. O usuário deverá alterá-la no próximo login.');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex justify-between items-center\">\r\n                <h2 className=\"text-xl font-bold text-gray-900 dark:text-white\">Gerenciamento de Usuários</h2>\r\n                <button\r\n                    onClick={() => setIsAdding(!isAdding)}\r\n                    className=\"flex items-center space-x-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition\"\r\n                >\r\n                    <Plus className=\"w-4 h-4\" />\r\n                    <span>Novo Usuário</span>\r\n                </button>\r\n            </div>\r\n\r\n            {isAdding && (\r\n                <div className=\"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700\">\r\n                    <h3 className=\"text-lg font-medium mb-4 text-gray-900 dark:text-white\">Adicionar Novo Usuário</h3>\r\n                    <form onSubmit={handleAddUser} className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Nome</label>\r\n                            <input\r\n                                type=\"text\"\r\n                                required\r\n                                className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                                value={newUser.name}\r\n                                onChange={e => setNewUser({ ...newUser, name: e.target.value })}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Email</label>\r\n                            <input\r\n                                type=\"email\"\r\n                                required\r\n                                className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                                value={newUser.email}\r\n                                onChange={e => setNewUser({ ...newUser, email: e.target.value })}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Senha Inicial</label>\r\n                            <input\r\n                                type=\"password\"\r\n                                required\r\n                                className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                                value={newUser.password}\r\n                                onChange={e => setNewUser({ ...newUser, password: e.target.value })}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Função</label>\r\n                            <select\r\n                                className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                                value={newUser.role}\r\n                                onChange={e => setNewUser({ ...newUser, role: e.target.value as 'admin' | 'user' })}\r\n                            >\r\n                                <option value=\"user\">Usuário Comum</option>\r\n                                <option value=\"admin\">Administrador</option>\r\n                            </select>\r\n                        </div>\r\n\r\n                        <div className=\"flex items-center mt-6\">\r\n                            <label className=\"flex items-center space-x-2 cursor-pointer\">\r\n                                <input\r\n                                    type=\"checkbox\"\r\n                                    checked={newUser.forceChangePassword}\r\n                                    onChange={e => setNewUser({ ...newUser, forceChangePassword: e.target.checked })}\r\n                                    className=\"w-4 h-4 text-indigo-600 rounded focus:ring-indigo-500\"\r\n                                />\r\n                                <span className=\"text-sm text-gray-700 dark:text-gray-300\">Exigir troca de senha no primeiro login</span>\r\n                            </label>\r\n                        </div>\r\n                        <div className=\"md:col-span-2 flex justify-end space-x-3 mt-2\">\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={() => setIsAdding(false)}\r\n                                className=\"px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg\"\r\n                            >\r\n                                Cancelar\r\n                            </button>\r\n                            <button\r\n                                type=\"submit\"\r\n                                className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700\"\r\n                            >\r\n                                Salvar Usuário\r\n                            </button>\r\n                        </div>\r\n                    </form>\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden\">\r\n                <table className=\"w-full text-left border-collapse\">\r\n                    <thead>\r\n                        <tr className=\"border-b border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50\">\r\n                            <th className=\"px-6 py-4 text-xs font-bold text-gray-400 uppercase tracking-wider\">Usuário</th>\r\n\r\n                            <th className=\"px-6 py-4 text-xs font-bold text-gray-400 uppercase tracking-wider\">Status</th>\r\n                            <th className=\"px-6 py-4 text-xs font-bold text-gray-400 uppercase tracking-wider text-right\">Ações</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-gray-50 dark:divide-gray-700\">\r\n                        {users.map(user => (\r\n                            <tr key={user.id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\">\r\n                                <td className=\"px-6 py-4\">\r\n                                    <div className=\"flex items-center space-x-3\">\r\n                                        <div className=\"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center overflow-hidden\">\r\n                                            {user.avatar ? (\r\n                                                <img src={user.avatar} alt={user.name} className=\"w-full h-full object-cover\" />\r\n                                            ) : (\r\n                                                <span className=\"font-bold text-gray-600 dark:text-gray-300\">{user.name.charAt(0)}</span>\r\n                                            )}\r\n                                        </div>\r\n                                        <div>\r\n                                            <p className=\"font-medium text-gray-900 dark:text-white\">{user.name}</p>\r\n                                            <p className=\"text-xs text-gray-500\">{user.email}</p>\r\n                                        </div>\r\n                                    </div>\r\n                                </td>\r\n\r\n                                <td className=\"px-6 py-4\">\r\n                                    <div className=\"flex flex-col gap-1\">\r\n                                        <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium w-fit ${user.role === 'admin'\r\n                                            ? 'bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300'\r\n                                            : 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300'\r\n                                            }`}>\r\n                                            {user.role === 'admin' ? 'Admin' : 'User'}\r\n                                        </span>\r\n                                        {user.isBlocked && (\r\n                                            <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300 w-fit\">\r\n                                                Bloqueado\r\n                                            </span>\r\n                                        )}\r\n                                    </div>\r\n                                </td>\r\n                                <td className=\"px-6 py-4 text-right\">\r\n                                    <div className=\"flex justify-end space-x-2\">\r\n                                        <button\r\n                                            onClick={() => setResetPasswordId(user.id!)}\r\n                                            className=\"p-1.5 text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 transition\"\r\n                                            title=\"Redefinir Senha\"\r\n                                        >\r\n                                            <KeyRound className=\"w-4 h-4\" />\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={() => toggleBlockUser(user)}\r\n                                            className={`p-1.5 transition ${user.isBlocked ? 'text-red-600 dark:text-red-400' : 'text-gray-400 hover:text-red-600 dark:hover:text-red-400'}`}\r\n                                            title={user.isBlocked ? \"Desbloquear\" : \"Bloquear\"}\r\n                                        >\r\n                                            {user.isBlocked ? <Ban className=\"w-4 h-4\" /> : <Shield className=\"w-4 h-4\" />}\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={() => user.id && handleDeleteUser(user.id)}\r\n                                            className=\"p-1.5 text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition\"\r\n                                            title=\"Excluir\"\r\n                                        >\r\n                                            <Trash2 className=\"w-4 h-4\" />\r\n                                        </button>\r\n                                    </div>\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n\r\n            {/* Reset Password Modal */}\r\n            {resetPasswordId && (\r\n                <div className=\"fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4 backdrop-blur-sm\">\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-sm p-6\">\r\n                        <h3 className=\"text-lg font-bold mb-4 text-gray-900 dark:text-white\">Redefinir Senha</h3>\r\n                        <p className=\"text-sm text-gray-500 mb-4\">Digite a nova senha para o usuário.</p>\r\n                        <input\r\n                            type=\"password\"\r\n                            className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg mb-4 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                            placeholder=\"Nova senha\"\r\n                            value={newPassword}\r\n                            onChange={e => setNewPassword(e.target.value)}\r\n                        />\r\n                        <div className=\"flex justify-end space-x-2\">\r\n                            <button\r\n                                onClick={() => { setResetPasswordId(null); setNewPassword(''); }}\r\n                                className=\"px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg\"\r\n                            >\r\n                                Cancelar\r\n                            </button>\r\n                            <button\r\n                                onClick={handleResetPassword}\r\n                                className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700\"\r\n                            >\r\n                                Salvar\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n",
  "components/UserStatusSidebar.tsx": "import React, { useState, useEffect } from 'react';\r\nimport { api } from '../services/api';\r\nimport { Circle } from 'lucide-react';\r\n\r\nimport { User } from '../types';\r\n\r\ninterface UserStatusSidebarProps {\r\n    onUserClick?: (user: User) => void;\r\n}\r\n\r\nexport function UserStatusSidebar({ onUserClick }: UserStatusSidebarProps) {\r\n    const [users, setUsers] = useState<User[]>([]);\r\n\r\n    useEffect(() => {\r\n        const fetchUsers = async () => {\r\n            try {\r\n                const data = await api.getUsers();\r\n                setUsers(data);\r\n            } catch (error) {\r\n                console.error(\"Failed to fetch users\", error);\r\n            }\r\n        };\r\n\r\n        fetchUsers();\r\n        // Optional: Poll for updates\r\n        const interval = setInterval(fetchUsers, 10000);\r\n        return () => clearInterval(interval);\r\n    }, []);\r\n\r\n    const onlineUsers = users.filter(u => u.status === 'online' || !u.status); // Default to online if undefined\r\n    const busyUsers = users.filter(u => u.status === 'busy');\r\n    const offlineUsers = users.filter(u => u.status === 'offline');\r\n\r\n    const UserItem = ({ user }: { user: User }) => (\r\n        <button\r\n            onClick={() => onUserClick?.(user)}\r\n            className=\"w-full flex items-center space-x-2 hover:bg-gray-50 dark:hover:bg-gray-700/50 p-1 rounded-lg transition-colors text-left\"\r\n        >\r\n            <div className=\"relative\">\r\n                <div className=\"w-6 h-6 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center overflow-hidden\">\r\n                    {user.avatar ? (\r\n                        <img src={user.avatar} alt={user.name} className=\"w-full h-full object-cover\" />\r\n                    ) : (\r\n                        <span className=\"text-xs font-bold text-gray-600 dark:text-gray-300\">{user.name.charAt(0)}</span>\r\n                    )}\r\n                </div>\r\n                <div className={`absolute bottom-0 right-0 w-2 h-2 rounded-full border border-white dark:border-gray-800 ${user.status === 'busy' ? 'bg-red-500' :\r\n                    user.status === 'offline' ? 'bg-gray-500' :\r\n                        'bg-green-500'\r\n                    }`}></div>\r\n            </div>\r\n            <span className=\"text-sm text-gray-600 dark:text-gray-300 truncate w-24\">{user.name}</span>\r\n        </button>\r\n    );\r\n\r\n    return (\r\n        <div className=\"p-4 border-t border-gray-100 dark:border-gray-700\">\r\n            <div className=\"mb-4\">\r\n                <h3 className=\"text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3\">\r\n                    Usuários\r\n                </h3>\r\n\r\n                <div className=\"space-y-4\">\r\n                    {/* Online */}\r\n                    {onlineUsers.length > 0 && (\r\n                        <div>\r\n                            <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-2 flex items-center justify-between\">\r\n                                <span>Online</span>\r\n                                <span className=\"bg-green-100 text-green-800 text-[10px] px-1.5 py-0.5 rounded-full dark:bg-green-900 dark:text-green-200\">{onlineUsers.length}</span>\r\n                            </p>\r\n                            <div className=\"space-y-1\">\r\n                                {onlineUsers.map(user => <UserItem key={user.id} user={user as User} />)}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Busy */}\r\n                    {busyUsers.length > 0 && (\r\n                        <div>\r\n                            <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-2 flex items-center justify-between\">\r\n                                <span>Não Perturbe</span>\r\n                                <span className=\"bg-red-100 text-red-800 text-[10px] px-1.5 py-0.5 rounded-full dark:bg-red-900 dark:text-red-200\">{busyUsers.length}</span>\r\n                            </p>\r\n                            <div className=\"space-y-1\">\r\n                                {busyUsers.map(user => <UserItem key={user.id} user={user as User} />)}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Offline */}\r\n                    {offlineUsers.length > 0 && (\r\n                        <div>\r\n                            <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-2 flex items-center justify-between\">\r\n                                <span>Offline</span>\r\n                                <span className=\"bg-gray-100 text-gray-800 text-[10px] px-1.5 py-0.5 rounded-full dark:bg-gray-700 dark:text-gray-300\">{offlineUsers.length}</span>\r\n                            </p>\r\n                            <div className=\"space-y-1\">\r\n                                {offlineUsers.map(user => <UserItem key={user.id} user={user as User} />)}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n\r\n        </div>\r\n    );\r\n}\r\n",
  "constants.ts": "import { Device, DeviceStatus, LabName } from './types';\r\n\r\nexport const MOCK_DEVICES: Device[] = [\r\n  {\r\n    id: 'PAT-001',\r\n    name: 'Dell Inspiron 15',\r\n    brand: 'Dell',\r\n    model: 'Inspiron 15',\r\n    processor: 'i5 11th Gen',\r\n    ram: '8GB',\r\n    storage: '256GB SSD',\r\n    lab: 'Laboratório A (Ciências)',\r\n    status: DeviceStatus.OPERATIONAL,\r\n    specs: 'i5 11th Gen, 8GB RAM',\r\n    lastCheck: '2023-10-25',\r\n    logs: [],\r\n    checkHistory: []\r\n  },\r\n  {\r\n    id: 'PAT-002',\r\n    name: 'Dell Inspiron 15',\r\n    brand: 'Dell',\r\n    model: 'Inspiron 15',\r\n    processor: 'i5 11th Gen',\r\n    ram: '8GB',\r\n    storage: '256GB SSD',\r\n    lab: 'Laboratório A (Ciências)',\r\n    status: DeviceStatus.MAINTENANCE,\r\n    specs: 'i5 11th Gen, 8GB RAM',\r\n    lastCheck: '2023-10-24',\r\n    logs: [\r\n      { id: 1, date: '2023-10-24', description: 'Teclado falhando na letra A', type: 'maintenance' }\r\n    ],\r\n    checkHistory: []\r\n  },\r\n  {\r\n    id: 'PAT-003',\r\n    name: 'Lenovo ThinkPad',\r\n    brand: 'Lenovo',\r\n    model: 'ThinkPad E14',\r\n    processor: 'Ryzen 5',\r\n    ram: '16GB',\r\n    storage: '512GB SSD',\r\n    lab: 'Laboratório B (Informática)',\r\n    status: DeviceStatus.OPERATIONAL,\r\n    specs: 'Ryzen 5, 16GB RAM',\r\n    lastCheck: '2023-10-26',\r\n    logs: [],\r\n    checkHistory: []\r\n  },\r\n  {\r\n    id: 'PAT-004',\r\n    name: 'Lenovo ThinkPad',\r\n    brand: 'Lenovo',\r\n    model: 'ThinkPad E14',\r\n    processor: 'Ryzen 5',\r\n    ram: '16GB',\r\n    storage: '512GB SSD',\r\n    lab: 'Laboratório B (Informática)',\r\n    status: DeviceStatus.BROKEN,\r\n    specs: 'Ryzen 5, 16GB RAM',\r\n    lastCheck: '2023-10-20',\r\n    logs: [\r\n      { id: 2, date: '2023-10-20', description: 'Tela azul constante ao iniciar', type: 'error' }\r\n    ],\r\n    checkHistory: []\r\n  },\r\n  {\r\n    id: 'PAT-005',\r\n    name: 'Positivo Master',\r\n    brand: 'Positivo',\r\n    model: 'Master',\r\n    processor: 'i3 10th Gen',\r\n    ram: '4GB',\r\n    storage: '1TB HDD',\r\n    lab: 'Laboratório C (Robótica)',\r\n    status: DeviceStatus.OPERATIONAL,\r\n    specs: 'i3 10th Gen, 4GB RAM',\r\n    lastCheck: '2023-10-26',\r\n    logs: [],\r\n    checkHistory: []\r\n  },\r\n  {\r\n    id: 'PAT-006',\r\n    name: 'Positivo Master',\r\n    brand: 'Positivo',\r\n    model: 'Master',\r\n    processor: 'i3 10th Gen',\r\n    ram: '4GB',\r\n    storage: '1TB HDD',\r\n    lab: 'Laboratório C (Robótica)',\r\n    status: DeviceStatus.MISSING,\r\n    specs: 'i3 10th Gen, 4GB RAM',\r\n    lastCheck: '2023-09-15',\r\n    logs: [\r\n      { id: 3, date: '2023-09-15', description: 'Não encontrado na bancada 4', type: 'info' }\r\n    ],\r\n    checkHistory: []\r\n  },\r\n  {\r\n    id: 'PAT-007',\r\n    name: 'Dell Inspiron 15',\r\n    brand: 'Dell',\r\n    model: 'Inspiron 15',\r\n    processor: 'i5 11th Gen',\r\n    ram: '8GB',\r\n    storage: '256GB SSD',\r\n    lab: 'Laboratório A (Ciências)',\r\n    status: DeviceStatus.OPERATIONAL,\r\n    specs: 'i5 11th Gen, 8GB RAM',\r\n    lastCheck: '2023-10-25',\r\n    logs: [],\r\n    checkHistory: []\r\n  },\r\n  {\r\n    id: 'PAT-008',\r\n    name: 'Lenovo ThinkPad',\r\n    brand: 'Lenovo',\r\n    model: 'ThinkPad E14',\r\n    processor: 'Ryzen 5',\r\n    ram: '16GB',\r\n    storage: '512GB SSD',\r\n    lab: 'Laboratório B (Informática)',\r\n    status: DeviceStatus.MAINTENANCE,\r\n    specs: 'Ryzen 5, 16GB RAM',\r\n    lastCheck: '2023-10-22',\r\n    logs: [\r\n      { id: 4, date: '2023-10-22', description: 'Cooler fazendo barulho alto', type: 'maintenance' }\r\n    ],\r\n    checkHistory: []\r\n  }\r\n];\r\n",
  "contexts/AuthContext.tsx": "import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\r\nimport { supabase } from '../services/supabase';\r\nimport { api } from '../services/api';\r\nimport { User } from '../types';\r\n\r\ninterface AuthContextType {\r\n    user: User | null;\r\n    isLoading: boolean;\r\n    login: (email: string, password: string) => Promise<void>;\r\n    register: (name: string, email: string, password: string) => Promise<void>;\r\n    logout: () => Promise<void>;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport function AuthProvider({ children }: { children: ReactNode }) {\r\n    const [user, setUser] = useState<User | null>(null);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n\r\n    // Carrega sessão ativa do Supabase\r\n    useEffect(() => {\r\n        supabase.auth.getSession().then(async ({ data }) => {\r\n            const session = data.session;\r\n            if (session?.user) {\r\n                const authId = session.user.id;\r\n\r\n                const { data: profile } = await supabase\r\n                    .from(\"users\")\r\n                    .select(\"*\")\r\n                    .eq(\"auth_id\", authId)\r\n                    .single();\r\n\r\n                if (profile) setUser(profile);\r\n            }\r\n            setIsLoading(false);\r\n        });\r\n\r\n        // Escuta mudanças de login/logout\r\n        const { data: listener } = supabase.auth.onAuthStateChange(\r\n            async (event, session) => {\r\n                if (session?.user) {\r\n                    const { data: profile } = await supabase\r\n                        .from(\"users\")\r\n                        .select(\"*\")\r\n                        .eq(\"auth_id\", session.user.id)\r\n                        .single();\r\n\r\n                    if (profile) setUser(profile);\r\n                } else {\r\n                    setUser(null);\r\n                }\r\n            }\r\n        );\r\n\r\n        return () => {\r\n            listener.subscription.unsubscribe();\r\n        };\r\n    }, []);\r\n\r\n    // LOGIN\r\n    const login = async (email: string, password: string) => {\r\n        setIsLoading(true);\r\n        try {\r\n            const { data, error } = await supabase.auth.signInWithPassword({\r\n                email,\r\n                password,\r\n            });\r\n\r\n            if (error) throw error;\r\n\r\n            const { user: authUser } = data;\r\n\r\n            const { data: profile, error: profileError } = await supabase\r\n                .from(\"users\")\r\n                .select(\"*\")\r\n                .eq(\"auth_id\", authUser.id)\r\n                .single();\r\n\r\n            if (profileError) throw profileError;\r\n\r\n            setUser(profile);\r\n\r\n        } catch (err: any) {\r\n            alert(err.message || \"Erro ao fazer login.\");\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    // CADASTRO\r\n    const register = async (name: string, email: string, password: string) => {\r\n        setIsLoading(true);\r\n        try {\r\n            const { data, error } = await supabase.auth.signUp({\r\n                email,\r\n                password\r\n            });\r\n\r\n            if (error) throw error;\r\n\r\n            const authUser = data.user;\r\n\r\n            const avatarUrl = `https://ui-avatars.com/api/?name=${name}`;\r\n\r\n            const { error: insertError } = await supabase\r\n                .from(\"users\")\r\n                .insert({\r\n                    auth_id: authUser.id,\r\n                    email,\r\n                    name,\r\n                    avatar: avatarUrl,\r\n                    role: \"user\"\r\n                });\r\n\r\n            if (insertError) throw insertError;\r\n\r\n            alert(\"Cadastro feito com sucesso! Agora faça login 😊\");\r\n\r\n        } catch (err: any) {\r\n            alert(err.message || \"Erro ao cadastrar.\");\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const logout = async () => {\r\n        await supabase.auth.signOut();\r\n        setUser(null);\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider value={{ user, isLoading, login, register, logout }}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n}\r\n\r\nexport function useAuth() {\r\n    const context = useContext(AuthContext);\r\n    if (!context) throw new Error(\"useAuth must be used inside AuthProvider\");\r\n    return context;\r\n}\r\n",
  "contexts/ThemeContext.tsx": "import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\r\n\r\ntype Theme = 'light' | 'dark';\r\n\r\ninterface ThemeContextType {\r\n    theme: Theme;\r\n    toggleTheme: () => void;\r\n}\r\n\r\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\r\n\r\nexport function ThemeProvider({ children }: { children: ReactNode }) {\r\n    const [theme, setTheme] = useState<Theme>('light');\r\n\r\n    useEffect(() => {\r\n        const storedTheme = localStorage.getItem('labmanager_theme') as Theme;\r\n        if (storedTheme) {\r\n            setTheme(storedTheme);\r\n        } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {\r\n            setTheme('dark');\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        localStorage.setItem('labmanager_theme', theme);\r\n        if (theme === 'dark') {\r\n            document.documentElement.classList.add('dark');\r\n        } else {\r\n            document.documentElement.classList.remove('dark');\r\n        }\r\n    }, [theme]);\r\n\r\n    const toggleTheme = () => {\r\n        setTheme(prev => prev === 'light' ? 'dark' : 'light');\r\n    };\r\n\r\n    return (\r\n        <ThemeContext.Provider value={{ theme, toggleTheme }}>\r\n            {children}\r\n        </ThemeContext.Provider>\r\n    );\r\n}\r\n\r\nexport function useTheme() {\r\n    const context = useContext(ThemeContext);\r\n    if (context === undefined) {\r\n        throw new Error('useTheme must be used within a ThemeProvider');\r\n    }\r\n    return context;\r\n}\r\n",
  "index.html": "<!DOCTYPE html>\r\n<html lang=\"en\">\r\n  <head>\r\n    <meta charset=\"UTF-8\" />\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\r\n    <title>LabManager AI</title>\r\n    <script src=\"https://cdn.tailwindcss.com\"></script>\r\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap\" rel=\"stylesheet\">\r\n    <style>\r\n      body {\r\n        font-family: 'Inter', sans-serif;\r\n        background-color: #f3f4f6;\r\n      }\r\n    </style>\r\n  <script type=\"importmap\">\r\n{\r\n  \"imports\": {\r\n    \"react-dom/\": \"https://aistudiocdn.com/react-dom@^19.2.0/\",\r\n    \"react/\": \"https://aistudiocdn.com/react@^19.2.0/\",\r\n    \"react\": \"https://aistudiocdn.com/react@^19.2.0\",\r\n    \"@google/genai\": \"https://aistudiocdn.com/@google/genai@^1.30.0\",\r\n    \"lucide-react\": \"https://aistudiocdn.com/lucide-react@^0.554.0\",\r\n    \"recharts\": \"https://aistudiocdn.com/recharts@^3.5.0\"\r\n  }\r\n}\r\n</script>\r\n<link rel=\"stylesheet\" href=\"/index.css\">\r\n</head>\r\n  <body>\r\n    <div id=\"root\"></div>\r\n  <script type=\"module\" src=\"/index.tsx\"></script>\r\n</body>\r\n</html>",
  "index.tsx": "import React from 'react';\r\nimport ReactDOM from 'react-dom/client';\r\nimport App from './App';\r\n\r\nconst rootElement = document.getElementById('root');\r\nif (!rootElement) {\r\n  throw new Error(\"Could not find root element to mount to\");\r\n}\r\n\r\nconst root = ReactDOM.createRoot(rootElement);\r\nroot.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>\r\n);",
  "metadata.json": "{\r\n  \"name\": \"LabManager AI\",\r\n  \"description\": \"A comprehensive dashboard for managing school computer labs, tracking inventory, running checklists, and analyzing hardware issues using AI.\",\r\n  \"requestFramePermissions\": []\r\n}",
  "package.json": "{\r\n  \"name\": \"labmanager-ai\",\r\n  \"private\": true,\r\n  \"version\": \"0.0.0\",\r\n  \"type\": \"module\",\r\n  \"scripts\": {\r\n    \"dev\": \"vite\",\r\n    \"build\": \"vite build\",\r\n    \"preview\": \"vite preview\"\r\n  },\r\n  \"dependencies\": {\r\n    \"@google/genai\": \"^1.30.0\",\r\n    \"@supabase/supabase-js\": \"^2.84.0\",\r\n    \"cors\": \"^2.8.5\",\r\n    \"dexie\": \"^4.2.1\",\r\n    \"dexie-react-hooks\": \"^4.2.0\",\r\n    \"express\": \"^5.1.0\",\r\n    \"html5-qrcode\": \"^2.3.8\",\r\n    \"knex\": \"^3.1.0\",\r\n    \"lucide-react\": \"^0.554.0\",\r\n    \"nodemon\": \"^3.1.11\",\r\n    \"react\": \"^19.2.0\",\r\n    \"react-dom\": \"^19.2.0\",\r\n    \"recharts\": \"^3.5.0\",\r\n    \"sqlite3\": \"^5.1.7\",\r\n    \"xlsx\": \"^0.18.5\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"@types/node\": \"^22.14.0\",\r\n    \"@types/react\": \"^19.2.7\",\r\n    \"@vitejs/plugin-react\": \"^5.0.0\",\r\n    \"typescript\": \"~5.8.2\",\r\n    \"vite\": \"^6.2.0\"\r\n  }\r\n}\r\n",
  "README.md": "<div align=\"center\">\r\n<img width=\"1200\" height=\"475\" alt=\"GHBanner\" src=\"https://github.com/user-attachments/assets/0aa67016-6eaf-458a-adb2-6e31a0763ed6\" />\r\n</div>\r\n\r\n# Run and deploy your AI Studio app\r\n\r\nThis contains everything you need to run your app locally.\r\n\r\nView your app in AI Studio: https://ai.studio/apps/drive/1rUB_Qb_xoEMCT5ZmtOY3ZhPSOrOTw6F8\r\n\r\n## Run Locally\r\n\r\n**Prerequisites:**  Node.js\r\n\r\n\r\n1. Install dependencies:\r\n   `npm install`\r\n2. Set the `GEMINI_API_KEY` in [.env.local](.env.local) to your Gemini API key\r\n3. Run the app:\r\n   `npm run dev`\r\n# Labinventory\r\n# Labinventory\r\n",
  "server/database.js": "import knex from 'knex';\r\n\r\nexport const db = knex({\r\n    client: 'sqlite3',\r\n    connection: {\r\n        filename: './labmanager.sqlite'\r\n    },\r\n    useNullAsDefault: true\r\n});\r\n",
  "server/index.js": "import express from 'express';\r\nimport cors from 'cors';\r\nimport { db } from './database.js';\r\n\r\nconst app = express();\r\napp.use(express.json());\r\napp.use(cors());\r\n\r\n// --- Users ---\r\napp.get('/users', async (req, res) => {\r\n    try {\r\n        const users = await db('users');\r\n        res.json(users);\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\napp.post('/users', async (req, res) => {\r\n    try {\r\n        const ids = await db('users').insert(req.body);\r\n        res.json({ id: ids[0] });\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\napp.put('/users/:id', async (req, res) => {\r\n    try {\r\n        await db('users').where({ id: req.params.id }).update(req.body);\r\n        res.json({ success: true });\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\napp.delete('/users/:id', async (req, res) => {\r\n    try {\r\n        await db('users').where({ id: req.params.id }).del();\r\n        res.json({ success: true });\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\napp.post('/login', async (req, res) => {\r\n    try {\r\n        const { email, password } = req.body;\r\n        const user = await db('users').where({ email, password }).first();\r\n        if (user) {\r\n            res.json(user);\r\n        } else {\r\n            res.status(401).json({ error: 'Invalid credentials' });\r\n        }\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\n// --- Sedes ---\r\napp.get('/sedes', async (req, res) => {\r\n    try {\r\n        const sedes = await db('sedes');\r\n        res.json(sedes);\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\napp.post('/sedes', async (req, res) => {\r\n    try {\r\n        const ids = await db('sedes').insert(req.body);\r\n        res.json({ id: ids[0] });\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\napp.put('/sedes/:id', async (req, res) => {\r\n    try {\r\n        await db('sedes').where({ id: req.params.id }).update(req.body);\r\n        res.json({ success: true });\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\napp.delete('/sedes/:id', async (req, res) => {\r\n    try {\r\n        await db('sedes').where({ id: req.params.id }).del();\r\n        res.json({ success: true });\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\n// --- Labs ---\r\napp.get('/labs', async (req, res) => {\r\n    try {\r\n        const labs = await db('labs');\r\n        res.json(labs);\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\napp.post('/labs', async (req, res) => {\r\n    try {\r\n        const ids = await db('labs').insert(req.body);\r\n        res.json({ id: ids[0] });\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\napp.put('/labs/:id', async (req, res) => {\r\n    try {\r\n        await db('labs').where({ id: req.params.id }).update(req.body);\r\n        res.json({ success: true });\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\napp.delete('/labs/:id', async (req, res) => {\r\n    try {\r\n        await db('labs').where({ id: req.params.id }).del();\r\n        res.json({ success: true });\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\n// --- Devices ---\r\napp.get('/devices', async (req, res) => {\r\n    try {\r\n        const devices = await db('devices');\r\n        // Fetch logs for each device to match Dexie structure if needed, \r\n        // but better to fetch logs separately or join.\r\n        // For now, let's keep it simple and maybe fetch logs on demand or join.\r\n        // The Dexie structure had logs embedded. \r\n        // Let's fetch logs and attach them for compatibility if needed, or just return devices.\r\n        // The frontend expects `logs` array in device object?\r\n        // Let's check `Device` type in `types.ts` later. \r\n        // For now, let's attach logs.\r\n        for (let device of devices) {\r\n            device.logs = await db('logs').where({ deviceId: device.id });\r\n        }\r\n        res.json(devices);\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\napp.post('/devices', async (req, res) => {\r\n    try {\r\n        const { logs, ...deviceData } = req.body;\r\n        await db('devices').insert(deviceData);\r\n        if (logs && logs.length > 0) {\r\n            // Insert logs\r\n            // Ensure logs have deviceId\r\n            const logsToInsert = logs.map(l => ({ ...l, deviceId: deviceData.id }));\r\n            await db('logs').insert(logsToInsert);\r\n        }\r\n        res.json({ success: true });\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\napp.put('/devices/:id', async (req, res) => {\r\n    try {\r\n        const { logs, ...deviceData } = req.body;\r\n        await db('devices').where({ id: req.params.id }).update(deviceData);\r\n        // Handle logs update? Usually logs are just added.\r\n        // If we replace logs, we delete old ones and add new ones.\r\n        // But logs are usually append-only.\r\n        // Let's assume for now we don't update logs via device update often, or we handle it separately.\r\n        res.json({ success: true });\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\napp.delete('/devices/:id', async (req, res) => {\r\n    try {\r\n        await db('devices').where({ id: req.params.id }).del();\r\n        await db('logs').where({ deviceId: req.params.id }).del();\r\n        res.json({ success: true });\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\n// --- Groups ---\r\napp.get('/groups', async (req, res) => {\r\n    try {\r\n        const groups = await db('groups');\r\n        res.json(groups);\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\napp.post('/groups', async (req, res) => {\r\n    try {\r\n        const ids = await db('groups').insert(req.body);\r\n        res.json({ id: ids[0] });\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\napp.put('/groups/:id', async (req, res) => {\r\n    try {\r\n        await db('groups').where({ id: req.params.id }).update(req.body);\r\n        res.json({ success: true });\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\napp.delete('/groups/:id', async (req, res) => {\r\n    try {\r\n        await db('groups').where({ id: req.params.id }).del();\r\n        res.json({ success: true });\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\n// --- Tasks ---\r\napp.get('/tasks', async (req, res) => {\r\n    try {\r\n        const tasks = await db('tasks');\r\n        res.json(tasks);\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\napp.post('/tasks', async (req, res) => {\r\n    try {\r\n        const ids = await db('tasks').insert(req.body);\r\n        res.json({ id: ids[0] });\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\napp.put('/tasks/:id', async (req, res) => {\r\n    try {\r\n        await db('tasks').where({ id: req.params.id }).update(req.body);\r\n        res.json({ success: true });\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\napp.delete('/tasks/:id', async (req, res) => {\r\n    try {\r\n        await db('tasks').where({ id: req.params.id }).del();\r\n        res.json({ success: true });\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\n// --- Messages ---\r\napp.get('/messages', async (req, res) => {\r\n    try {\r\n        const messages = await db('messages');\r\n        res.json(messages);\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\napp.post('/messages', async (req, res) => {\r\n    try {\r\n        const ids = await db('messages').insert(req.body);\r\n        res.json({ id: ids[0] });\r\n    } catch (e) {\r\n        res.status(500).json({ error: e.message });\r\n    }\r\n});\r\n\r\n\r\nconst PORT = 3000;\r\napp.listen(PORT, () => {\r\n    console.log(`Server running on http://localhost:${PORT}`);\r\n});\r\n",
  "server/migrate.js": "import { db } from './database.js';\r\n\r\nasync function migrate() {\r\n    console.log(\"Iniciando migração...\");\r\n\r\n    // Users\r\n    if (!(await db.schema.hasTable('users'))) {\r\n        await db.schema.createTable('users', table => {\r\n            table.increments('id').primary();\r\n            table.string('name');\r\n            table.string('email').unique();\r\n            table.string('password');\r\n            table.string('avatar');\r\n            table.string('role');\r\n            table.integer('groupId');\r\n            table.boolean('isBlocked');\r\n            table.boolean('forceChangePassword');\r\n            table.string('status');\r\n        });\r\n        console.log(\"Tabela 'users' criada.\");\r\n    }\r\n\r\n    // Sedes\r\n    if (!(await db.schema.hasTable('sedes'))) {\r\n        await db.schema.createTable('sedes', table => {\r\n            table.increments('id').primary();\r\n            table.string('name');\r\n        });\r\n        console.log(\"Tabela 'sedes' criada.\");\r\n    }\r\n\r\n    // Labs\r\n    if (!(await db.schema.hasTable('labs'))) {\r\n        await db.schema.createTable('labs', table => {\r\n            table.increments('id').primary();\r\n            table.string('name');\r\n            table.integer('sedeId');\r\n        });\r\n        console.log(\"Tabela 'labs' criada.\");\r\n    }\r\n\r\n    // Devices\r\n    if (!(await db.schema.hasTable('devices'))) {\r\n        await db.schema.createTable('devices', table => {\r\n            table.string('id').primary();\r\n            table.string('name');\r\n            table.string('brand');\r\n            table.string('model');\r\n            table.string('processor');\r\n            table.string('ram');\r\n            table.string('storage');\r\n            table.string('lab');\r\n            table.string('status');\r\n            table.string('specs');\r\n            table.string('lastCheck');\r\n        });\r\n        console.log(\"Tabela 'devices' criada.\");\r\n    }\r\n\r\n    // Logs\r\n    if (!(await db.schema.hasTable('logs'))) {\r\n        await db.schema.createTable('logs', table => {\r\n            table.increments('id').primary();\r\n            table.string('deviceId');\r\n            table.string('date');\r\n            table.string('description');\r\n            table.string('type');\r\n        });\r\n        console.log(\"Tabela 'logs' criada.\");\r\n    }\r\n\r\n    // Groups\r\n    if (!(await db.schema.hasTable('groups'))) {\r\n        await db.schema.createTable('groups', table => {\r\n            table.increments('id').primary();\r\n            table.string('name');\r\n            table.string('description');\r\n        });\r\n        console.log(\"Tabela 'groups' criada.\");\r\n    }\r\n\r\n    // Tasks\r\n    if (!(await db.schema.hasTable('tasks'))) {\r\n        await db.schema.createTable('tasks', table => {\r\n            table.increments('id').primary();\r\n            table.string('title');\r\n            table.string('description');\r\n            table.string('status');\r\n            table.string('priority');\r\n            table.string('dueDate');\r\n            table.integer('assignedTo');\r\n            table.integer('createdBy');\r\n        });\r\n        console.log(\"Tabela 'tasks' criada.\");\r\n    }\r\n\r\n    // Messages\r\n    if (!(await db.schema.hasTable('messages'))) {\r\n        await db.schema.createTable('messages', table => {\r\n            table.increments('id').primary();\r\n            table.integer('senderId');\r\n            table.integer('receiverId');\r\n            table.string('content');\r\n            table.string('timestamp');\r\n            table.boolean('read');\r\n        });\r\n        console.log(\"Tabela 'messages' criada.\");\r\n    }\r\n\r\n    console.log(\"Migração concluída!\");\r\n    process.exit();\r\n}\r\n\r\nmigrate();\r\n",
  "server/seed.js": "import { db } from './database.js';\r\n\r\nasync function seed() {\r\n    console.log(\"Iniciando seed...\");\r\n\r\n    // Clear existing data\r\n    await db('users').del();\r\n    await db('sedes').del();\r\n    await db('labs').del();\r\n    await db('devices').del();\r\n    await db('groups').del();\r\n\r\n    // Seed Sedes\r\n    const sedeId = await db('sedes').insert({ name: 'Matriz' }, ['id']);\r\n    const sedeSulId = await db('sedes').insert({ name: 'Filial Zona Sul' }, ['id']);\r\n\r\n    // SQLite returns array of objects with id if specified, or just array of ids depending on version/config.\r\n    // Knex with sqlite3 usually returns [id] for single insert or array of ids.\r\n    // Let's handle it safely.\r\n    const getID = (result) => result[0]?.id || result[0];\r\n\r\n    const s1 = getID(sedeId);\r\n    const s2 = getID(sedeSulId);\r\n\r\n    // Seed Labs\r\n    await db('labs').insert([\r\n        { name: 'Laboratório A (Ciências)', sedeId: s1 },\r\n        { name: 'Laboratório B (Informática)', sedeId: s1 },\r\n        { name: 'Laboratório C (Robótica)', sedeId: s1 },\r\n        { name: 'Laboratório Steve Jobs (1º Andar)', sedeId: s1 },\r\n        { name: 'Laboratório Bill Gates (1º Andar)', sedeId: s1 },\r\n        { name: 'Laboratório Sam Altman (1º Andar)', sedeId: s1 },\r\n        { name: 'Laboratório Mark Zuckerberg (10º Andar)', sedeId: s2 },\r\n        { name: 'Laboratório Lary Page (10º Andar)', sedeId: s2 },\r\n        { name: 'Laboratório Philip Kotler (10º Andar)', sedeId: s2 },\r\n        { name: 'Laboratório Jack Ma (10º Andar)', sedeId: s2 },\r\n        { name: 'Laboratório Sergey Brin (1º Andar)', sedeId: s1 }\r\n    ]);\r\n\r\n    // Seed Groups\r\n    const adminGroupId = await db('groups').insert({ name: 'Administradores', description: 'Acesso total ao sistema' }, ['id']);\r\n    await db('groups').insert({ name: 'Técnicos', description: 'Acesso a inventário e manutenção' });\r\n    await db('groups').insert({ name: 'Professores', description: 'Visualização de laboratórios' });\r\n\r\n    const g1 = getID(adminGroupId);\r\n\r\n    // Seed Users\r\n    await db('users').insert({\r\n        name: 'Admin',\r\n        email: 'ph134406@gmail.com',\r\n        password: 'Digital@25',\r\n        role: 'admin',\r\n        groupId: g1,\r\n        avatar: 'https://ui-avatars.com/api/?name=Admin&background=random',\r\n        isBlocked: false,\r\n        forceChangePassword: false,\r\n        status: 'online'\r\n    });\r\n\r\n    // Seed Devices\r\n    await db('devices').insert([\r\n        {\r\n            id: 'PAT-001',\r\n            name: 'Dell Inspiron 15',\r\n            brand: 'Dell',\r\n            model: 'Inspiron 15',\r\n            processor: 'i5 11th Gen',\r\n            ram: '8GB',\r\n            storage: '256GB SSD',\r\n            lab: 'Laboratório A (Ciências)',\r\n            status: 'operational',\r\n            specs: 'i5 11th Gen, 8GB RAM',\r\n            lastCheck: '2023-10-25'\r\n        },\r\n        {\r\n            id: 'PAT-002',\r\n            name: 'Lenovo ThinkPad',\r\n            brand: 'Lenovo',\r\n            model: 'ThinkPad E14',\r\n            processor: 'Ryzen 5',\r\n            ram: '16GB',\r\n            storage: '512GB SSD',\r\n            lab: 'Laboratório B (Informática)',\r\n            status: 'maintenance',\r\n            specs: 'Ryzen 5, 16GB RAM',\r\n            lastCheck: '2023-10-24'\r\n        },\r\n        {\r\n            id: 'PAT-003',\r\n            name: 'HP ProDesk',\r\n            brand: 'HP',\r\n            model: 'ProDesk 400',\r\n            processor: 'i7 10th Gen',\r\n            ram: '16GB',\r\n            storage: '1TB HDD',\r\n            lab: 'Laboratório C (Robótica)',\r\n            status: 'operational',\r\n            specs: 'i7 10th Gen, 16GB RAM',\r\n            lastCheck: '2023-10-26'\r\n        }\r\n    ]);\r\n\r\n    // Seed Logs for PAT-002\r\n    await db('logs').insert({\r\n        deviceId: 'PAT-002',\r\n        date: '2023-10-24',\r\n        description: 'Teclado com defeito',\r\n        type: 'maintenance'\r\n    });\r\n\r\n    console.log(\"Seed concluído!\");\r\n    process.exit();\r\n}\r\n\r\nseed();\r\n",
  "services/api.ts": "import { supabase } from './supabase';\r\nimport { Device, User, Lab, Sede, Group, Task, Message, Log } from '../types';\r\n\r\nexport const api = {\r\n    // Users\r\n    getUsers: async () => {\r\n        const { data, error } = await supabase\r\n            .from('users')\r\n            .select('*');\r\n        if (error) throw error;\r\n        return data as User[];\r\n    },\r\n    createUser: async (user: Partial<User>) => {\r\n        // Remove fields that might not exist in the Supabase schema or shouldn't be set directly\r\n        const { forceChangePassword, password, ...userData } = user;\r\n        const { data, error } = await supabase.from('users').insert(userData).select().single();\r\n        if (error) throw error;\r\n        return data as { id: number | string };\r\n    },\r\n    updateUser: async (id: number | string, user: Partial<User>) => {\r\n        const { forceChangePassword, password, ...userData } = user;\r\n        const { error } = await supabase.from('users').update(userData).eq('id', id);\r\n        if (error) throw error;\r\n        return { success: true };\r\n    },\r\n    deleteUser: async (id: number | string) => {\r\n        const { error } = await supabase.from('users').delete().eq('id', id);\r\n        if (error) throw error;\r\n        return { success: true };\r\n    },\r\n    login: async (credentials: { email: string; password?: string }) => {\r\n        console.log(\"Attempting login for:\", credentials.email);\r\n        const { data: authData, error } = await supabase.auth.signInWithPassword({\r\n            email: credentials.email,\r\n            password: credentials.password || '',\r\n        });\r\n\r\n        if (error) {\r\n            console.error(\"Supabase Auth Error:\", error);\r\n            throw error;\r\n        }\r\n\r\n        // Carregar usuário\r\n        let { data: userProfile, error: profileError } = await supabase\r\n            .from('users')\r\n            .select('*')\r\n            .eq('email', credentials.email)\r\n            .single();\r\n\r\n        if (profileError || !userProfile) {\r\n            console.warn(\"User profile not found, creating one...\", profileError);\r\n\r\n            // Create missing profile\r\n            const { data: newProfile, error: createError } = await supabase\r\n                .from('users')\r\n                .insert({\r\n                    auth_id: authData.user.id, // Link to Auth User\r\n                    email: credentials.email,\r\n                    name: authData.user.user_metadata?.name || credentials.email.split('@')[0],\r\n                    role: 'user',\r\n                    avatar: authData.user.user_metadata?.avatar || `https://ui-avatars.com/api/?name=${credentials.email}`,\r\n                    status: 'online'\r\n                })\r\n                .select()\r\n                .single();\r\n\r\n            if (createError) {\r\n                console.error(\"Failed to create user profile:\", createError);\r\n                throw new Error('User profile not found and could not be created.');\r\n            }\r\n            userProfile = newProfile;\r\n        }\r\n\r\n        return userProfile as User;\r\n    },\r\n    register: async (user: Partial<User> & { password?: string }) => {\r\n        // 1. Create Auth User\r\n        const { data: authData, error: authError } = await supabase.auth.signUp({\r\n            email: user.email!,\r\n            password: user.password!,\r\n            options: {\r\n                data: {\r\n                    name: user.name,\r\n                    avatar: user.avatar\r\n                }\r\n            }\r\n        });\r\n\r\n        if (authError) throw authError;\r\n\r\n        // 2. Create Public User Record\r\n        // Remove fields that shouldn't be manually set or don't exist in public schema\r\n        const { password, ...userData } = user;\r\n\r\n        const { data, error } = await supabase\r\n            .from('users')\r\n            .insert({\r\n                ...userData,\r\n                auth_id: authData.user?.id, // Link to Auth User\r\n                status: 'offline'\r\n            })\r\n            .select()\r\n            .single();\r\n\r\n        if (error) {\r\n            // If user creation fails, we might want to cleanup auth user, but for now just throw\r\n            console.error(\"Error creating public user record:\", error);\r\n            throw error;\r\n        }\r\n\r\n        return data as { id: number | string };\r\n    },\r\n\r\n    // Sedes\r\n    getSedes: async () => {\r\n        const { data, error } = await supabase.from(\"sedes\").select(\"*\");\r\n        if (error) throw error;\r\n\r\n        return data.map(s => ({\r\n            id: s.id,\r\n            name: s.name\r\n        }));\r\n    },\r\n    createSede: async (sede: Partial<Sede>) => {\r\n        const { data, error } = await supabase.from('sedes').insert(sede).select().single();\r\n        if (error) throw error;\r\n        return data as { id: number };\r\n    },\r\n    updateSede: async (id: number, sede: Partial<Sede>) => {\r\n        const { error } = await supabase.from('sedes').update(sede).eq('id', id);\r\n        if (error) throw error;\r\n        return { success: true };\r\n    },\r\n    deleteSede: async (id: number) => {\r\n        const { error } = await supabase.from('sedes').delete().eq('id', id);\r\n        if (error) throw error;\r\n        return { success: true };\r\n    },\r\n\r\n    // Labs\r\n    getLabs: async () => {\r\n        const { data, error } = await supabase.from(\"labs\").select(\"*\");\r\n        if (error) throw error;\r\n\r\n        return data.map(l => ({\r\n            id: l.id,\r\n            name: l.name,\r\n            sedeId: l.sedeid    // <---- muito importante\r\n        }));\r\n    },\r\n    createLab: async (lab: Partial<Lab>) => {\r\n        const dbLab = {\r\n            name: lab.name,\r\n            sedeid: lab.sedeId\r\n        };\r\n        const { data, error } = await supabase.from('labs').insert(dbLab).select().single();\r\n        if (error) throw error;\r\n        return { ...data, sedeId: data.sedeid } as { id: number; sedeId: number };\r\n    },\r\n    updateLab: async (id: number, lab: Partial<Lab>) => {\r\n        const dbLab: any = {};\r\n        if (lab.name) dbLab.name = lab.name;\r\n        if (lab.sedeId) dbLab.sedeid = lab.sedeId;\r\n\r\n        const { error } = await supabase.from('labs').update(dbLab).eq('id', id);\r\n        if (error) throw error;\r\n        return { success: true };\r\n    },\r\n    deleteLab: async (id: number) => {\r\n        const { error } = await supabase.from('labs').delete().eq('id', id);\r\n        if (error) throw error;\r\n        return { success: true };\r\n    },\r\n\r\n    // Devices (now computadores)\r\n    getDevices: async () => {\r\n        const { data, error } = await supabase.from(\"computadores\").select(\"*\");\r\n        if (error) throw error;\r\n\r\n        return data.map((d: any) => ({\r\n            id: d.id,\r\n            brand: d.brand,\r\n            model: d.model,\r\n            processor: d.processor,\r\n            ram: d.ram,\r\n            storage: d.storage,\r\n            status: d.status,\r\n            labId: d.labid,\r\n            createdAt: d.created_at?.split(\"T\")[0] ?? null\r\n        }));\r\n    },\r\n    // Replaces createDevice and addComputador\r\n    addComputador: async (data: any) => {\r\n        const deviceData = {\r\n            id: data.id,\r\n            brand: data.brand,\r\n            model: data.model,\r\n            processor: data.processor,\r\n            ram: data.ram,\r\n            storage: data.storage,\r\n            status: data.status,\r\n            labid: data.labId\r\n        };\r\n\r\n        const { error } = await supabase.from(\"computadores\").insert(deviceData);\r\n        if (error) throw error;\r\n\r\n        return { success: true };\r\n    },\r\n    updateDevice: async (id: string, device: any) => {\r\n        const updateData: any = {};\r\n\r\n        if (device.brand) updateData.brand = device.brand;\r\n        if (device.model) updateData.model = device.model;\r\n        if (device.processor) updateData.processor = device.processor;\r\n        if (device.ram) updateData.ram = device.ram;\r\n        if (device.storage) updateData.storage = device.storage;\r\n        if (device.status) updateData.status = device.status;\r\n        if (device.labId) updateData.labid = device.labId;\r\n\r\n        const { error } = await supabase.from(\"computadores\").update(updateData).eq(\"id\", id);\r\n        if (error) throw error;\r\n\r\n        return { success: true };\r\n    },\r\n    deleteDevice: async (id: string) => {\r\n        const { error } = await supabase.from('computadores').delete().eq('id', id);\r\n        if (error) throw error;\r\n        return { success: true };\r\n    },\r\n\r\n    // Groups\r\n    getGroups: async () => {\r\n        const { data, error } = await supabase.from('groups').select('*');\r\n        if (error) throw error;\r\n        return data as Group[];\r\n    },\r\n    createGroup: async (group: Partial<Group>) => {\r\n        const { data, error } = await supabase.from('groups').insert(group).select().single();\r\n        if (error) throw error;\r\n        return data as { id: number };\r\n    },\r\n    updateGroup: async (id: number, group: Partial<Group>) => {\r\n        const { error } = await supabase.from('groups').update(group).eq('id', id);\r\n        if (error) throw error;\r\n        return { success: true };\r\n    },\r\n    deleteGroup: async (id: number) => {\r\n        const { error } = await supabase.from('groups').delete().eq('id', id);\r\n        if (error) throw error;\r\n        return { success: true };\r\n    },\r\n\r\n    // Tasks\r\n    getTasks: async () => {\r\n        const { data, error } = await supabase.from('tasks').select('*');\r\n        if (error) throw error;\r\n        return data as Task[];\r\n    },\r\n    createTask: async (task: Partial<Task>) => {\r\n        const { data, error } = await supabase.from('tasks').insert(task).select().single();\r\n        if (error) throw error;\r\n        return data as { id: number };\r\n    },\r\n    updateTask: async (id: number, task: Partial<Task>) => {\r\n        const { error } = await supabase.from('tasks').update(task).eq('id', id);\r\n        if (error) throw error;\r\n        return { success: true };\r\n    },\r\n    deleteTask: async (id: number) => {\r\n        const { error } = await supabase.from('tasks').delete().eq('id', id);\r\n        if (error) throw error;\r\n        return { success: true };\r\n    },\r\n\r\n    // Messages\r\n    getMessages: async () => {\r\n        const { data, error } = await supabase.from('messages').select('*');\r\n        if (error) throw error;\r\n        return data as Message[];\r\n    },\r\n    createMessage: async (message: Partial<Message>) => {\r\n        const { data, error } = await supabase.from('messages').insert(message).select().single();\r\n        if (error) throw error;\r\n        return data as { id: number };\r\n    },\r\n\r\n    // SUBTASKS\r\n    getSubtasks: async (taskId: number) => {\r\n        const { data, error } = await supabase\r\n            .from(\"subtasks\")\r\n            .select(\"*\")\r\n            .eq(\"task_id\", taskId)\r\n            .order(\"id\");\r\n\r\n        if (error) throw error;\r\n        return data;\r\n    },\r\n\r\n    createSubtask: async (taskId: number, title: string) => {\r\n        const { data, error } = await supabase\r\n            .from(\"subtasks\")\r\n            .insert({ task_id: taskId, title })\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n        return data;\r\n    },\r\n\r\n    updateSubtask: async (id: number, updates: any) => {\r\n        const { error } = await supabase.from(\"subtasks\").update(updates).eq(\"id\", id);\r\n        if (error) throw error;\r\n    },\r\n\r\n    deleteSubtask: async (id: number) => {\r\n        const { error } = await supabase.from(\"subtasks\").delete().eq(\"id\", id);\r\n        if (error) throw error;\r\n    },\r\n\r\n    // COMMENTS\r\n    getComments: async (taskId: number) => {\r\n        const { data, error } = await supabase\r\n            .from(\"task_comments\")\r\n            .select(\"*, users(name, avatar)\")\r\n            .eq(\"task_id\", taskId)\r\n            .order(\"id\");\r\n\r\n        if (error) throw error;\r\n        return data;\r\n    },\r\n\r\n    addComment: async (taskId: number, userId: number | string, content: string) => {\r\n        const { data, error } = await supabase\r\n            .from(\"task_comments\")\r\n            .insert({ task_id: taskId, user_id: userId, content })\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n        return data;\r\n    },\r\n\r\n    // ATTACHMENTS\r\n    uploadAttachment: async (taskId: number, file: File) => {\r\n        const filePath = `${taskId}/${Date.now()}-${file.name}`;\r\n\r\n        const { error: uploadErr } = await supabase.storage\r\n            .from(\"task_attachments\")\r\n            .upload(filePath, file);\r\n\r\n        if (uploadErr) throw uploadErr;\r\n\r\n        const publicUrl = supabase.storage\r\n            .from(\"task_attachments\")\r\n            .getPublicUrl(filePath).data.publicUrl;\r\n\r\n        const { data, error } = await supabase\r\n            .from(\"task_attachments\")\r\n            .insert({\r\n                task_id: taskId,\r\n                file_name: file.name,\r\n                file_url: publicUrl,\r\n                file_type: file.type,\r\n            })\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n        return data;\r\n    },\r\n\r\n    getTaskAttachments: async (taskId: number) => {\r\n        const { data, error } = await supabase\r\n            .from(\"task_attachments\")\r\n            .select(\"*\")\r\n            .eq(\"task_id\", taskId);\r\n\r\n        if (error) throw error;\r\n        return data;\r\n    }\r\n};\r\n",
  "services/geminiService.ts": "import { GoogleGenAI } from \"@google/genai\";\r\n\r\nconst apiKey = process.env.API_KEY || '';\r\nconst ai = new GoogleGenAI({ apiKey });\r\n\r\nexport const analyzeMaintenanceIssue = async (issueDescription: string, deviceModel: string): Promise<string> => {\r\n  if (!apiKey) {\r\n    return \"API Key is missing. Cannot perform AI analysis.\";\r\n  }\r\n\r\n  try {\r\n    const prompt = `\r\n      Você é um técnico de TI especialista nível sênior.\r\n      Analise o seguinte problema relatado em um computador escolar:\r\n      Modelo: ${deviceModel}\r\n      Problema: \"${issueDescription}\"\r\n\r\n      Por favor, forneça uma resposta curta e estruturada com:\r\n      1. Diagnóstico provável (1 frase).\r\n      2. Três passos recomendados para solução.\r\n      3. Peças que podem precisar de substituição (se houver).\r\n      \r\n      Mantenha o tom profissional e direto.\r\n    `;\r\n\r\n    const response = await ai.models.generateContent({\r\n      model: 'gemini-2.5-flash',\r\n      contents: prompt,\r\n    });\r\n\r\n    return response.text || \"Não foi possível gerar uma análise.\";\r\n  } catch (error) {\r\n    console.error(\"Gemini Analysis Error:\", error);\r\n    return \"Erro ao conectar com o serviço de IA.\";\r\n  }\r\n};\r\n",
  "services/supabase.ts": "import { createClient } from '@supabase/supabase-js'\r\n\r\nexport const supabase = createClient(\r\n    import.meta.env.VITE_SUPABASE_URL,\r\n    import.meta.env.VITE_SUPABASE_ANON_KEY\r\n);\r\n",
  "tailwind.config.js": "/** @type {import('tailwindcss').Config} */\r\nexport default {\r\n    content: [\r\n        \"./index.html\",\r\n        \"./src/**/*.{js,ts,jsx,tsx}\",\r\n        \"./components/**/*.{js,ts,jsx,tsx}\",\r\n        \"./contexts/**/*.{js,ts,jsx,tsx}\",\r\n        \"./**/*.{js,ts,jsx,tsx}\",\r\n    ],\r\n    darkMode: 'class',\r\n    theme: {\r\n        extend: {},\r\n    },\r\n    plugins: [],\r\n}\r\n",
  "tsconfig.json": "{\r\n  \"compilerOptions\": {\r\n    \"target\": \"ES2022\",\r\n    \"experimentalDecorators\": true,\r\n    \"useDefineForClassFields\": false,\r\n    \"module\": \"ESNext\",\r\n    \"lib\": [\r\n      \"ES2022\",\r\n      \"DOM\",\r\n      \"DOM.Iterable\"\r\n    ],\r\n    \"skipLibCheck\": true,\r\n    \"types\": [\r\n      \"node\"\r\n    ],\r\n    \"moduleResolution\": \"bundler\",\r\n    \"isolatedModules\": true,\r\n    \"moduleDetection\": \"force\",\r\n    \"allowJs\": true,\r\n    \"jsx\": \"react-jsx\",\r\n    \"paths\": {\r\n      \"@/*\": [\r\n        \"./*\"\r\n      ]\r\n    },\r\n    \"allowImportingTsExtensions\": true,\r\n    \"noEmit\": true\r\n  },\r\n  \"include\": [\r\n    \"**/*.ts\",\r\n    \"**/*.tsx\"\r\n  ],\r\n  \"exclude\": [\r\n    \"node_modules\"\r\n  ]\r\n}",
  "types.ts": "// =========================\r\n//  DEVICE STATUS (PORTUGUÊS)\r\n// =========================\r\nexport enum DeviceStatus {\r\n  OPERATIONAL = 'Operacional',\r\n  MAINTENANCE = 'Manutenção',\r\n  BROKEN = 'Quebrado',\r\n  MISSING = 'Desaparecido'\r\n}\r\n\r\n// =========================\r\n//  SEDES\r\n// =========================\r\nexport interface Sede {\r\n  id?: number;\r\n  name: string;\r\n}\r\n\r\n// =========================\r\n//  LABORATÓRIOS\r\n//  (ligados à tabela sedes)\r\n// =========================\r\nexport interface Lab {\r\n  id?: number;\r\n  name: string;\r\n  sedeId: number;\r\n}\r\n\r\n// =========================\r\n//  GRUPOS\r\n// =========================\r\nexport interface Group {\r\n  id?: number;\r\n  name: string;\r\n  description?: string;\r\n  permissions?: string[];\r\n}\r\n\r\n// =========================\r\n//  LOGS DE MANUTENÇÃO\r\n//  (Frontend Only — não existe no Supabase\r\n//  mas é usado na UI)\r\n// =========================\r\nexport interface MaintenanceLog {\r\n  id: string;\r\n  date: string;\r\n  description: string;\r\n  reportedBy: string;\r\n}\r\n\r\n// =========================\r\n//  CHECKLIST\r\n// =========================\r\nexport interface CheckRecord {\r\n  date: string;\r\n  time: string;\r\n  teclado: boolean;\r\n  mouse: boolean;\r\n  monitor: boolean;\r\n  cabos: boolean;\r\n  software: boolean;\r\n  observacoes: string;\r\n  userId?: string;\r\n  userName?: string;\r\n}\r\n\r\n// =========================\r\n//  DEVICE (Computadores)\r\n// =========================\r\n// IMPORTANTE:\r\n// A tabela `computadores` do Supabase não possui:\r\n// - name\r\n// - specs\r\n// - logs\r\n// - checkHistory\r\n//\r\n// MAS o frontend usa esses campos.\r\n// Portanto, eles são gerados pela API automaticamente\r\n// para manter compatibilidade.\r\nexport interface Device {\r\n  id: string;          // patrimônio\r\n  name: string;        // gerado pela API → `${brand} ${model}`\r\n  brand: string;\r\n  model: string;\r\n  processor: string;\r\n  ram: string;\r\n  storage: string;\r\n\r\n  // IMPORTANTE:\r\n  // o banco usa labId (integer)\r\n  // o frontend usa lab (string com nome)\r\n  lab: string;\r\n  labId?: number; // Added to match API return\r\n\r\n  status: DeviceStatus;\r\n  specs: string;        // gerado → `${processor}, ${ram}, ${storage}`\r\n  lastCheck: string;    // vindo de created_at\r\n\r\n  // usados na UI\r\n  logs: Log[];\r\n  checkHistory?: CheckRecord[];\r\n\r\n  isStarred?: boolean;\r\n}\r\n\r\n// =========================\r\n//  LOG (UI Only)\r\n// =========================\r\nexport interface Log {\r\n  id: number;\r\n  date: string;\r\n  description: string;\r\n  type: 'maintenance' | 'error' | 'info';\r\n  userId?: string;\r\n  userName?: string;\r\n}\r\n\r\n// =========================\r\n//  USER\r\n// =========================\r\nexport interface User {\r\n  id: number | string;\r\n  name: string;\r\n  email: string;\r\n  password?: string;\r\n  avatar?: string;\r\n  role: 'admin' | 'user';\r\n  isBlocked?: boolean;\r\n  forceChangePassword?: boolean;\r\n  status?: 'online' | 'busy' | 'offline';\r\n}\r\n\r\n// =========================\r\n//  TASK\r\n// =========================\r\nexport interface Task {\r\n  id?: number;\r\n  title: string;\r\n  description: string;\r\n  status: 'pending' | 'in_progress' | 'done';\r\n  assignedTo?: string;\r\n  assignedName?: string;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  checklist?: { id: string; text: string; completed: boolean }[];\r\n}\r\n\r\n// =========================\r\n//  MESSAGE\r\n// =========================\r\nexport interface Message {\r\n  id?: number;\r\n  senderId: string;\r\n  receiverId: string;\r\n  content: string;\r\n  timestamp: string;\r\n  read: boolean;\r\n}\r\n\r\n// =========================\r\n//  DASHBOARD STATS\r\n// =========================\r\nexport interface DashboardStats {\r\n  total: number;\r\n  operational: number;\r\n  maintenance: number;\r\n  broken: number;\r\n}\r\n",
  "vite.config.ts": "import path from 'path';\r\nimport { defineConfig, loadEnv } from 'vite';\r\nimport react from '@vitejs/plugin-react';\r\n\r\nexport default defineConfig(({ mode }) => {\r\n  const env = loadEnv(mode, '.', '');\r\n  return {\r\n    server: {\r\n      port: 5173,\r\n      host: '0.0.0.0',\r\n    },\r\n    plugins: [react()],\r\n    define: {\r\n      'process.env.API_KEY': JSON.stringify(env.GEMINI_API_KEY),\r\n      'process.env.GEMINI_API_KEY': JSON.stringify(env.GEMINI_API_KEY)\r\n    },\r\n    resolve: {\r\n      alias: {\r\n        '@': path.resolve(__dirname, '.'),\r\n      }\r\n    }\r\n  };\r\n});\r\n"
}